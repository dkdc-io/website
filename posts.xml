<?xml version="1.0" encoding="UTF-8"?>
<rss  xmlns:atom="http://www.w3.org/2005/Atom" 
      xmlns:media="http://search.yahoo.com/mrss/" 
      xmlns:content="http://purl.org/rss/1.0/modules/content/" 
      xmlns:dc="http://purl.org/dc/elements/1.1/" 
      version="2.0">
<channel>
<title>dkdc.io</title>
<link>https://dkdc.io/posts.html</link>
<atom:link href="https://dkdc.io/posts.xml" rel="self" type="application/rss+xml"/>
<description>Code by Cody</description>
<generator>quarto-1.6.37</generator>
<lastBuildDate>Tue, 26 Nov 2024 00:00:00 GMT</lastBuildDate>
<item>
  <title>fast, simple, persistent state management with Python (Ibis)</title>
  <dc:creator>Cody </dc:creator>
  <link>https://dkdc.io/posts/fast-simple-state/</link>
  <description><![CDATA[ 




<p><strong><em>Using SQLite and DuckDB (via Ibis) to manage perisistent state in Python.</em></strong></p>
<section id="dkdc-state" class="level2">
<h2 class="anchored" data-anchor-id="dkdc-state">dkdc-state</h2>
<p>In this post, we’ll look at the what and why of <a href="https://github.com/dkdc-io/dkdc-state">dkdc-state</a>:</p>
<div id="32e264f3" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> dkdc_state <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> State, ibis</span>
<span id="cb1-2"></span>
<span id="cb1-3">ibis.options.interactive <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span></span>
<span id="cb1-4"></span>
<span id="cb1-5">state <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> State()</span>
<span id="cb1-6">state._clear() <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># for demonstration purposes, clear all tables</span></span>
<span id="cb1-7">state</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>&lt;dkdc_state.main.State at 0x107ed6ab0&gt;</code></pre>
</div>
</div>
<p>The State class itself isn’t very interesting, but we extend it to implement a number of other stateful Python libraries. Looking at the source code:</p>
<div id="dcada059" class="cell" data-execution_count="2">
<details class="code-fold">
<summary>State class code code</summary>
<div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> website.utils <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> get_class_source</span>
<span id="cb3-2"></span>
<span id="cb3-3">get_class_source(State)</span></code></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="2">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace"><span style="background-color: #272822">                                                                                                                   
 </span><span style="color: #66d9ef; text-decoration-color: #66d9ef; background-color: #272822">class</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> </span><span style="color: #a6e22e; text-decoration-color: #a6e22e; background-color: #272822">State</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">:</span><span style="background-color: #272822">                                                                                                      </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">    </span><span style="color: #959077; text-decoration-color: #959077; background-color: #272822"># initialization</span><span style="background-color: #272822">                                                                                              </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">    </span><span style="color: #66d9ef; text-decoration-color: #66d9ef; background-color: #272822">def</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> </span><span style="color: #a6e22e; text-decoration-color: #a6e22e; background-color: #272822">__init__</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">(self, dbpath: str </span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">=</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> </span><span style="color: #e6db74; text-decoration-color: #e6db74; background-color: #272822">"data.db"</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">):</span><span style="background-color: #272822">                                                                  </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">        self</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">.</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">dbpath </span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">=</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> dbpath</span><span style="background-color: #272822">                                                                                      </span>
<span style="background-color: #272822">                                                                                                                   </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">        self</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">.</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">wcon, self</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">.</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">rcon </span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">=</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> self</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">.</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">_cons()</span><span style="background-color: #272822">                                                                       </span>
<span style="background-color: #272822">                                                                                                                   </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">    </span><span style="color: #959077; text-decoration-color: #959077; background-color: #272822"># reference implementation -- to be overridden</span><span style="background-color: #272822">                                                                </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">    </span><span style="color: #66d9ef; text-decoration-color: #66d9ef; background-color: #272822">def</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> </span><span style="color: #a6e22e; text-decoration-color: #a6e22e; background-color: #272822">_cons</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">(self) </span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">-&gt;</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> (ibis</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">.</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">BaseBackend, ibis</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">.</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">BaseBackend):</span><span style="background-color: #272822">                                                      </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">        </span><span style="color: #959077; text-decoration-color: #959077; background-color: #272822"># create write connection</span><span style="background-color: #272822">                                                                                 </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">        wcon </span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">=</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> ibis</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">.</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">sqlite</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">.</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">connect(self</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">.</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">dbpath)</span><span style="background-color: #272822">                                                                   </span>
<span style="background-color: #272822">                                                                                                                   </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">        </span><span style="color: #959077; text-decoration-color: #959077; background-color: #272822"># create tables in write connection</span><span style="background-color: #272822">                                                                       </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">        </span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">...</span><span style="background-color: #272822">                                                                                                       </span>
<span style="background-color: #272822">                                                                                                                   </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">        </span><span style="color: #959077; text-decoration-color: #959077; background-color: #272822"># create read connection</span><span style="background-color: #272822">                                                                                  </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">        rcon </span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">=</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> ibis</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">.</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">duckdb</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">.</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">connect()</span><span style="background-color: #272822">                                                                              </span>
<span style="background-color: #272822">                                                                                                                   </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">        </span><span style="color: #959077; text-decoration-color: #959077; background-color: #272822"># create tables in read connection</span><span style="background-color: #272822">                                                                        </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">        </span><span style="color: #66d9ef; text-decoration-color: #66d9ef; background-color: #272822">for</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> table_name </span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">in</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> wcon</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">.</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">list_tables():</span><span style="background-color: #272822">                                                                     </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">            rcon</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">.</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">read_sqlite(self</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">.</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">dbpath, table_name</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">=</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">table_name)</span><span style="background-color: #272822">                                                  </span>
<span style="background-color: #272822">                                                                                                                   </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">        </span><span style="color: #959077; text-decoration-color: #959077; background-color: #272822"># return connections</span><span style="background-color: #272822">                                                                                      </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">        </span><span style="color: #66d9ef; text-decoration-color: #66d9ef; background-color: #272822">return</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> wcon, rcon</span><span style="background-color: #272822">                                                                                         </span>
<span style="background-color: #272822">                                                                                                                   </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">    </span><span style="color: #66d9ef; text-decoration-color: #66d9ef; background-color: #272822">def</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> </span><span style="color: #a6e22e; text-decoration-color: #a6e22e; background-color: #272822">_clear</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">(self, table_names: str </span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">|</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> list[str] </span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">=</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> </span><span style="color: #66d9ef; text-decoration-color: #66d9ef; background-color: #272822">None</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">):</span><span style="background-color: #272822">                                                        </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">        </span><span style="color: #959077; text-decoration-color: #959077; background-color: #272822"># if table_names is None, clear all tables</span><span style="background-color: #272822">                                                                </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">        table_names </span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">=</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> self</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">.</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">wcon</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">.</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">list_tables() </span><span style="color: #66d9ef; text-decoration-color: #66d9ef; background-color: #272822">if</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> table_names </span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">is</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> </span><span style="color: #66d9ef; text-decoration-color: #66d9ef; background-color: #272822">None</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> </span><span style="color: #66d9ef; text-decoration-color: #66d9ef; background-color: #272822">else</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> table_names</span><span style="background-color: #272822">                             </span>
<span style="background-color: #272822">                                                                                                                   </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">        </span><span style="color: #959077; text-decoration-color: #959077; background-color: #272822"># if table_names is a string, convert to a list</span><span style="background-color: #272822">                                                           </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">        </span><span style="color: #66d9ef; text-decoration-color: #66d9ef; background-color: #272822">if</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> isinstance(table_names, str):</span><span style="background-color: #272822">                                                                          </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">            table_names </span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">=</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> [table_names]</span><span style="background-color: #272822">                                                                           </span>
<span style="background-color: #272822">                                                                                                                   </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">        </span><span style="color: #959077; text-decoration-color: #959077; background-color: #272822"># drop views and tables</span><span style="background-color: #272822">                                                                                   </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">        </span><span style="color: #66d9ef; text-decoration-color: #66d9ef; background-color: #272822">for</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> table_name </span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">in</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> table_names:</span><span style="background-color: #272822">                                                                            </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">            self</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">.</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">rcon</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">.</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">drop_view(table_name)</span><span style="background-color: #272822">                                                                       </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">            self</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">.</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">wcon</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">.</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">drop_table(table_name)</span><span style="background-color: #272822">                                                                      </span>
<span style="background-color: #272822">                                                                                                                   </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">        </span><span style="color: #959077; text-decoration-color: #959077; background-color: #272822"># reset connections (recreate tables)</span><span style="background-color: #272822">                                                                     </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">        self</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">.</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">wcon, self</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">.</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">rcon </span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">=</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> self</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">.</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">_cons()</span><span style="background-color: #272822">                                                                       </span>
<span style="background-color: #272822">                                                                                                                   
</span></pre>
</div>
</div>
<p>We define a <code>__init__</code> method that calls a <code>_cons</code> method that sets up a write connection (SQLite) and read connection (DuckDB) with Ibis. A standard <code>_clear</code> method is defined to drop the tables (and corresponding views). That’s it!</p>
<p>To create a fast, simple, persistent state management system we simply need to extend the State class, implement the table creation in the <code>_cons</code> method, and add methods to interact with the state.</p>
<section id="dkdc-todo" class="level3">
<h3 class="anchored" data-anchor-id="dkdc-todo">dkdc-todo</h3>
<p>Let’s look at <a href="https://github.com/dkdc-io/dkdc-todo">dkdc-todo</a> as an example:</p>
<div id="289c8dba" class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> dkdc_todo <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> Todo</span>
<span id="cb4-2"></span>
<span id="cb4-3">todo <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> Todo(dbpath<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"data.db"</span>)</span>
<span id="cb4-4">todo</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="3">
<pre><code>&lt;dkdc_todo.main.Todo at 0x11732a180&gt;</code></pre>
</div>
</div>
<p>We can view the table (and thus the schema):</p>
<div id="8a361e67" class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1">todo.t()</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="4">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">┏━━━━━━━━━━━━━━┳━━━━━━━━┳━━━━━━━━━┳━━━━━━━━━┳━━━━━━━━┳━━━━━━━━━━┳━━━━━━━━┳━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃<span style="font-weight: bold"> idx          </span>┃<span style="font-weight: bold"> id     </span>┃<span style="font-weight: bold"> user_id </span>┃<span style="font-weight: bold"> subject </span>┃<span style="font-weight: bold"> body   </span>┃<span style="font-weight: bold"> priority </span>┃<span style="font-weight: bold"> status </span>┃<span style="font-weight: bold"> description </span>┃<span style="font-weight: bold"> labels        </span>┃
┡━━━━━━━━━━━━━━╇━━━━━━━━╇━━━━━━━━━╇━━━━━━━━━╇━━━━━━━━╇━━━━━━━━━━╇━━━━━━━━╇━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">timestamp(6)</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>  │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>  │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">int64</span>    │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>      │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">array&lt;string&gt;</span> │
└──────────────┴────────┴─────────┴─────────┴────────┴──────────┴────────┴─────────────┴───────────────┘
</pre>
</div>
</div>
<p>Then append items to the table:</p>
<div id="7ae22ec6" class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1">todo.append_todo(<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">id</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"test"</span>, user_id<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">None</span>, subject<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">None</span>, body<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"do your homework"</span>)</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="5">
<pre><code>{'idx': datetime.datetime(2024, 11, 25, 17, 8, 43, 385111),
 'id': 'test',
 'user_id': None,
 'subject': None,
 'body': 'do your homework',
 'priority': 100,
 'status': None,
 'description': None,
 'labels': None}</code></pre>
</div>
</div>
<p>At this point we see our record:</p>
<div id="9cb58519" class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb9" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1">todo.t()</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="6">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━┳━━━━━━━━━┳━━━━━━━━━┳━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━┳━━━━━━━━┳━━━━━━━━━━━━━┳━━━━━━━━┓
┃<span style="font-weight: bold"> idx                        </span>┃<span style="font-weight: bold"> id     </span>┃<span style="font-weight: bold"> user_id </span>┃<span style="font-weight: bold"> subject </span>┃<span style="font-weight: bold"> body             </span>┃<span style="font-weight: bold"> priority </span>┃<span style="font-weight: bold"> status </span>┃<span style="font-weight: bold"> description </span>┃<span style="font-weight: bold"> labels </span>┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━╇━━━━━━━━━╇━━━━━━━━━╇━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━╇━━━━━━━━╇━━━━━━━━━━━━━╇━━━━━━━━┩
│ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">timestamp(6)</span>               │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>  │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>  │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>           │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">int64</span>    │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>      │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">array…</span> │
├────────────────────────────┼────────┼─────────┼─────────┼──────────────────┼──────────┼────────┼─────────────┼────────┤
│ <span style="color: #800080; text-decoration-color: #800080">2024-11-25 17:08:43.385111</span> │ <span style="color: #008000; text-decoration-color: #008000">test  </span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">NULL</span>    │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">NULL</span>    │ <span style="color: #008000; text-decoration-color: #008000">do your homework</span> │      <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">100</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">NULL</span>   │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">NULL</span>        │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">NULL</span>   │
└────────────────────────────┴────────┴─────────┴─────────┴──────────────────┴──────────┴────────┴─────────────┴────────┘
</pre>
</div>
</div>
<p>Importantly, dkdc-state tables are intended to be append-only. Once <code>append_*</code> (confusingly named here) is called, you must use <code>update_*</code> to update the record (with the same id).</p>
<p>To demonstrate this, let’s update that record:</p>
<div id="f6f8ea45" class="cell" data-execution_count="7">
<div class="sourceCode cell-code" id="cb10" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1">todo.update_todo(<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">id</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"test"</span>, user_id<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">None</span>, subject<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">None</span>, body<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"do your homework!"</span>)</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="7">
<pre><code>{'idx': datetime.datetime(2024, 11, 25, 17, 8, 43, 436369),
 'id': 'test',
 'user_id': None,
 'subject': None,
 'body': 'do your homework!',
 'priority': 100,
 'status': None,
 'description': None,
 'labels': None}</code></pre>
</div>
</div>
<p>Then view our table:</p>
<div id="662343ad" class="cell" data-execution_count="8">
<div class="sourceCode cell-code" id="cb12" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1">todo.t()</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="8">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━┳━━━━━━━━━┳━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━┳━━━━━━━━┳━━━━━━━━━━━━━┳━━━━━━━━┓
┃<span style="font-weight: bold"> idx                        </span>┃<span style="font-weight: bold"> id     </span>┃<span style="font-weight: bold"> user_id </span>┃<span style="font-weight: bold"> subject </span>┃<span style="font-weight: bold"> body              </span>┃<span style="font-weight: bold"> priority </span>┃<span style="font-weight: bold"> status </span>┃<span style="font-weight: bold"> description </span>┃<span style="font-weight: bold"> labels </span>┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━╇━━━━━━━━━╇━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━╇━━━━━━━━╇━━━━━━━━━━━━━╇━━━━━━━━┩
│ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">timestamp(6)</span>               │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>  │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>  │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>            │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">int64</span>    │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>      │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">array…</span> │
├────────────────────────────┼────────┼─────────┼─────────┼───────────────────┼──────────┼────────┼─────────────┼────────┤
│ <span style="color: #800080; text-decoration-color: #800080">2024-11-25 17:08:43.436369</span> │ <span style="color: #008000; text-decoration-color: #008000">test  </span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">NULL</span>    │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">NULL</span>    │ <span style="color: #008000; text-decoration-color: #008000">do your homework!</span> │      <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">100</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">NULL</span>   │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">NULL</span>        │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">NULL</span>   │
└────────────────────────────┴────────┴─────────┴─────────┴───────────────────┴──────────┴────────┴─────────────┴────────┘
</pre>
</div>
</div>
<p>There’s only 1 row! The second rows is in there, the table code is just set to only show the latest version of each record.</p>
<p>Let’s look at the underlying table:</p>
<div id="a24c29d9" class="cell" data-execution_count="9">
<div class="sourceCode cell-code" id="cb13" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1">todo.wcon.table(todo.todos_table_name)</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="9">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━┳━━━━━━━━━┳━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━┳━━━━━━━━┳━━━━━━━━━━━━━┳━━━━━━━━┓
┃<span style="font-weight: bold"> idx                        </span>┃<span style="font-weight: bold"> id     </span>┃<span style="font-weight: bold"> user_id </span>┃<span style="font-weight: bold"> subject </span>┃<span style="font-weight: bold"> body              </span>┃<span style="font-weight: bold"> priority </span>┃<span style="font-weight: bold"> status </span>┃<span style="font-weight: bold"> description </span>┃<span style="font-weight: bold"> labels </span>┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━╇━━━━━━━━━╇━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━╇━━━━━━━━╇━━━━━━━━━━━━━╇━━━━━━━━┩
│ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">timestamp</span>                  │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>  │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>  │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>            │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">int64</span>    │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>      │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span> │
├────────────────────────────┼────────┼─────────┼─────────┼───────────────────┼──────────┼────────┼─────────────┼────────┤
│ <span style="color: #800080; text-decoration-color: #800080">2024-11-25 17:08:43.385111</span> │ <span style="color: #008000; text-decoration-color: #008000">test  </span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">NULL</span>    │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">NULL</span>    │ <span style="color: #008000; text-decoration-color: #008000">do your homework </span> │      <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">100</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">NULL</span>   │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">NULL</span>        │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">NULL</span>   │
│ <span style="color: #800080; text-decoration-color: #800080">2024-11-25 17:08:43.436369</span> │ <span style="color: #008000; text-decoration-color: #008000">test  </span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">NULL</span>    │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">NULL</span>    │ <span style="color: #008000; text-decoration-color: #008000">do your homework!</span> │      <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">100</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">NULL</span>   │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">NULL</span>        │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">NULL</span>   │
└────────────────────────────┴────────┴─────────┴─────────┴───────────────────┴──────────┴────────┴─────────────┴────────┘
</pre>
</div>
</div>
<p>And we see both rows. You can add other convenience methods to the state class as needed:</p>
<div id="980ac592" class="cell" data-execution_count="10">
<div class="sourceCode cell-code" id="cb14" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1">todo.get_todo(<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">id</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"test"</span>)</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="10">
<pre><code>{'idx': datetime.datetime(2024, 11, 25, 17, 8, 43, 436369),
 'id': 'test',
 'user_id': None,
 'subject': None,
 'body': 'do your homework!',
 'priority': 100,
 'status': None,
 'description': None,
 'labels': None}</code></pre>
</div>
</div>
<p>Taking a look at the source code:</p>
<div id="6e7d6a54" class="cell" data-execution_count="11">
<details class="code-fold">
<summary>Todo class code code</summary>
<div class="sourceCode cell-code" id="cb16" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1">get_class_source(Todo)</span></code></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="11">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace"><span style="background-color: #272822">                                                                                                                   
 </span><span style="color: #66d9ef; text-decoration-color: #66d9ef; background-color: #272822">class</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> </span><span style="color: #a6e22e; text-decoration-color: #a6e22e; background-color: #272822">Todo</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">(State):</span><span style="background-color: #272822">                                                                                                </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">    </span><span style="color: #66d9ef; text-decoration-color: #66d9ef; background-color: #272822">def</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> </span><span style="color: #a6e22e; text-decoration-color: #a6e22e; background-color: #272822">__init__</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">(self, dbpath: str </span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">=</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> </span><span style="color: #66d9ef; text-decoration-color: #66d9ef; background-color: #272822">None</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">):</span><span style="background-color: #272822">                                                                       </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">        </span><span style="color: #66d9ef; text-decoration-color: #66d9ef; background-color: #272822">if</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> dbpath </span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">is</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> </span><span style="color: #66d9ef; text-decoration-color: #66d9ef; background-color: #272822">None</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">:</span><span style="background-color: #272822">                                                                                        </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">            dbpath </span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">=</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> os</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">.</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">path</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">.</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">join(get_dkdc_dir(), </span><span style="color: #e6db74; text-decoration-color: #e6db74; background-color: #272822">"todo.db"</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">)</span><span style="background-color: #272822">                                                      </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">        super()</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">.</span><span style="color: #a6e22e; text-decoration-color: #a6e22e; background-color: #272822">__init__</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">(dbpath</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">=</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">dbpath)</span><span style="background-color: #272822">                                                                           </span>
<span style="background-color: #272822">                                                                                                                   </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">    </span><span style="color: #66d9ef; text-decoration-color: #66d9ef; background-color: #272822">def</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> </span><span style="color: #a6e22e; text-decoration-color: #a6e22e; background-color: #272822">_cons</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">(self) </span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">-&gt;</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> (ibis</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">.</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">BaseBackend, ibis</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">.</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">BaseBackend):</span><span style="background-color: #272822">                                                      </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">        </span><span style="color: #959077; text-decoration-color: #959077; background-color: #272822"># create write connection</span><span style="background-color: #272822">                                                                                 </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">        wcon </span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">=</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> ibis</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">.</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">sqlite</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">.</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">connect(self</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">.</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">dbpath)</span><span style="background-color: #272822">                                                                   </span>
<span style="background-color: #272822">                                                                                                                   </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">        </span><span style="color: #959077; text-decoration-color: #959077; background-color: #272822"># create tables in write connection</span><span style="background-color: #272822">                                                                       </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">        </span><span style="color: #959077; text-decoration-color: #959077; background-color: #272822">## todos data</span><span style="background-color: #272822">                                                                                             </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">        self</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">.</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">todos_table_name </span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">=</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> </span><span style="color: #e6db74; text-decoration-color: #e6db74; background-color: #272822">"todos"</span><span style="background-color: #272822">                                                                           </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">        schema </span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">=</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> ibis</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">.</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">schema(</span><span style="background-color: #272822">                                                                                     </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">            {</span><span style="background-color: #272822">                                                                                                     </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">                </span><span style="color: #e6db74; text-decoration-color: #e6db74; background-color: #272822">"idx"</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">: dt</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">.</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">timestamp,</span><span style="background-color: #272822">                                                                              </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">                </span><span style="color: #e6db74; text-decoration-color: #e6db74; background-color: #272822">"id"</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">: str,</span><span style="background-color: #272822">                                                                                        </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">                </span><span style="color: #e6db74; text-decoration-color: #e6db74; background-color: #272822">"user_id"</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">: str,</span><span style="background-color: #272822">                                                                                   </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">                </span><span style="color: #e6db74; text-decoration-color: #e6db74; background-color: #272822">"subject"</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">: str,</span><span style="background-color: #272822">                                                                                   </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">                </span><span style="color: #e6db74; text-decoration-color: #e6db74; background-color: #272822">"body"</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">: str,</span><span style="background-color: #272822">                                                                                      </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">                </span><span style="color: #e6db74; text-decoration-color: #e6db74; background-color: #272822">"priority"</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">: int,</span><span style="background-color: #272822">                                                                                  </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">                </span><span style="color: #e6db74; text-decoration-color: #e6db74; background-color: #272822">"status"</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">: str,</span><span style="background-color: #272822">                                                                                    </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">                </span><span style="color: #e6db74; text-decoration-color: #e6db74; background-color: #272822">"description"</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">: str,</span><span style="background-color: #272822">                                                                               </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">                </span><span style="color: #e6db74; text-decoration-color: #e6db74; background-color: #272822">"labels"</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">: str,  </span><span style="color: #959077; text-decoration-color: #959077; background-color: #272822"># comma-separated list of labels</span><span style="background-color: #272822">                                                  </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">            }</span><span style="background-color: #272822">                                                                                                     </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">        )</span><span style="background-color: #272822">                                                                                                         </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">        </span><span style="color: #66d9ef; text-decoration-color: #66d9ef; background-color: #272822">if</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> self</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">.</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">todos_table_name </span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">not</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> </span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">in</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> wcon</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">.</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">list_tables():</span><span style="background-color: #272822">                                                       </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">            wcon</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">.</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">create_table(self</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">.</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">todos_table_name, schema</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">=</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">schema)</span><span style="background-color: #272822">                                               </span>
<span style="background-color: #272822">                                                                                                                   </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">        </span><span style="color: #959077; text-decoration-color: #959077; background-color: #272822"># create read connection</span><span style="background-color: #272822">                                                                                  </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">        rcon </span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">=</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> ibis</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">.</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">duckdb</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">.</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">connect()</span><span style="background-color: #272822">                                                                              </span>
<span style="background-color: #272822">                                                                                                                   </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">        </span><span style="color: #959077; text-decoration-color: #959077; background-color: #272822"># create tables in read connection</span><span style="background-color: #272822">                                                                        </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">        </span><span style="color: #66d9ef; text-decoration-color: #66d9ef; background-color: #272822">for</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> table_name </span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">in</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> wcon</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">.</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">list_tables():</span><span style="background-color: #272822">                                                                     </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">            rcon</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">.</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">read_sqlite(self</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">.</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">dbpath, table_name</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">=</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">table_name)</span><span style="background-color: #272822">                                                  </span>
<span style="background-color: #272822">                                                                                                                   </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">        </span><span style="color: #66d9ef; text-decoration-color: #66d9ef; background-color: #272822">return</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> wcon, rcon</span><span style="background-color: #272822">                                                                                         </span>
<span style="background-color: #272822">                                                                                                                   </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">    </span><span style="color: #959077; text-decoration-color: #959077; background-color: #272822"># tables</span><span style="background-color: #272822">                                                                                                      </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">    </span><span style="color: #66d9ef; text-decoration-color: #66d9ef; background-color: #272822">def</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> </span><span style="color: #a6e22e; text-decoration-color: #a6e22e; background-color: #272822">todos_t</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">(self, user_id: str </span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">=</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> </span><span style="color: #66d9ef; text-decoration-color: #66d9ef; background-color: #272822">None</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">):</span><span style="background-color: #272822">                                                                       </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">        </span><span style="color: #959077; text-decoration-color: #959077; background-color: #272822"># get todos data</span><span style="background-color: #272822">                                                                                          </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">        t </span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">=</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> self</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">.</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">rcon</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">.</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">table(self</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">.</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">todos_table_name)</span><span style="background-color: #272822">                                                                </span>
<span style="background-color: #272822">                                                                                                                   </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">        </span><span style="color: #959077; text-decoration-color: #959077; background-color: #272822"># filter by user_id</span><span style="background-color: #272822">                                                                                       </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">        </span><span style="color: #66d9ef; text-decoration-color: #66d9ef; background-color: #272822">if</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> user_id:</span><span style="background-color: #272822">                                                                                               </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">            t </span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">=</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> t</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">.</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">filter(t[</span><span style="color: #e6db74; text-decoration-color: #e6db74; background-color: #272822">"user_id"</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">] </span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">==</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> user_id)</span><span style="background-color: #272822">                                                                 </span>
<span style="background-color: #272822">                                                                                                                   </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">        </span><span style="color: #959077; text-decoration-color: #959077; background-color: #272822"># get only the latest metadata</span><span style="background-color: #272822">                                                                            </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">        t </span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">=</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> (</span><span style="background-color: #272822">                                                                                                     </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">            t</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">.</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">mutate(</span><span style="background-color: #272822">                                                                                             </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">                rank</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">=</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">ibis</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">.</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">row_number()</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">.</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">over(</span><span style="background-color: #272822">                                                                      </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">                    ibis</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">.</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">window(</span><span style="background-color: #272822">                                                                                  </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">                        group_by</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">=</span><span style="color: #e6db74; text-decoration-color: #e6db74; background-color: #272822">"id"</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">,</span><span style="background-color: #272822">                                                                            </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">                        order_by</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">=</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">ibis</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">.</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">desc(</span><span style="color: #e6db74; text-decoration-color: #e6db74; background-color: #272822">"idx"</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">),</span><span style="background-color: #272822">                                                                </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">                    )</span><span style="background-color: #272822">                                                                                             </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">                )</span><span style="background-color: #272822">                                                                                                 </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">            )</span><span style="background-color: #272822">                                                                                                     </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">            </span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">.</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">filter(ibis</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">.</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">_[</span><span style="color: #e6db74; text-decoration-color: #e6db74; background-color: #272822">"rank"</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">] </span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">==</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> </span><span style="color: #ae81ff; text-decoration-color: #ae81ff; background-color: #272822">0</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">)</span><span style="background-color: #272822">                                                                          </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">            </span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">.</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">drop(</span><span style="color: #e6db74; text-decoration-color: #e6db74; background-color: #272822">"rank"</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">)</span><span style="background-color: #272822">                                                                                         </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">        )</span><span style="background-color: #272822">                                                                                                         </span>
<span style="background-color: #272822">                                                                                                                   </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">        </span><span style="color: #959077; text-decoration-color: #959077; background-color: #272822"># comma-separated lists to arrays</span><span style="background-color: #272822">                                                                         </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">        t </span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">=</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> t</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">.</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">mutate(labels</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">=</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">t[</span><span style="color: #e6db74; text-decoration-color: #e6db74; background-color: #272822">"labels"</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">]</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">.</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">split(</span><span style="color: #e6db74; text-decoration-color: #e6db74; background-color: #272822">","</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">))</span><span style="background-color: #272822">                                                               </span>
<span style="background-color: #272822">                                                                                                                   </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">        </span><span style="color: #959077; text-decoration-color: #959077; background-color: #272822"># order</span><span style="background-color: #272822">                                                                                                   </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">        t </span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">=</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> t</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">.</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">order_by(ibis</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">.</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">asc(</span><span style="color: #e6db74; text-decoration-color: #e6db74; background-color: #272822">"priority"</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">), ibis</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">.</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">desc(</span><span style="color: #e6db74; text-decoration-color: #e6db74; background-color: #272822">"idx"</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">))</span><span style="background-color: #272822">                                                    </span>
<span style="background-color: #272822">                                                                                                                   </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">        </span><span style="color: #959077; text-decoration-color: #959077; background-color: #272822"># return the data</span><span style="background-color: #272822">                                                                                         </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">        </span><span style="color: #66d9ef; text-decoration-color: #66d9ef; background-color: #272822">return</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> t</span><span style="background-color: #272822">                                                                                                  </span>
<span style="background-color: #272822">                                                                                                                   </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">    </span><span style="color: #959077; text-decoration-color: #959077; background-color: #272822"># contains</span><span style="background-color: #272822">                                                                                                    </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">    </span><span style="color: #66d9ef; text-decoration-color: #66d9ef; background-color: #272822">def</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> </span><span style="color: #a6e22e; text-decoration-color: #a6e22e; background-color: #272822">contains_todo</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">(self, id: str, user_id: str </span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">=</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> </span><span style="color: #66d9ef; text-decoration-color: #66d9ef; background-color: #272822">None</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">) </span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">-&gt;</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> bool:</span><span style="background-color: #272822">                                                </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">        t </span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">=</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> self</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">.</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">todos_t(user_id</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">=</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">user_id)</span><span style="background-color: #272822">                                                                         </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">        </span><span style="color: #66d9ef; text-decoration-color: #66d9ef; background-color: #272822">return</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> t</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">.</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">filter(t[</span><span style="color: #e6db74; text-decoration-color: #e6db74; background-color: #272822">"id"</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">] </span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">==</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> id)</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">.</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">count()</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">.</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">to_pyarrow()</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">.</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">as_py() </span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">&gt;</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> </span><span style="color: #ae81ff; text-decoration-color: #ae81ff; background-color: #272822">0</span><span style="background-color: #272822">                                           </span>
<span style="background-color: #272822">                                                                                                                   </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">    </span><span style="color: #959077; text-decoration-color: #959077; background-color: #272822"># get record</span><span style="background-color: #272822">                                                                                                  </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">    </span><span style="color: #66d9ef; text-decoration-color: #66d9ef; background-color: #272822">def</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> </span><span style="color: #a6e22e; text-decoration-color: #a6e22e; background-color: #272822">get_todos</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">(self, user_id: str </span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">=</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> </span><span style="color: #66d9ef; text-decoration-color: #66d9ef; background-color: #272822">None</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">):</span><span style="background-color: #272822">                                                                     </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">        t </span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">=</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> self</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">.</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">todos_t(user_id</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">=</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">user_id)</span><span style="background-color: #272822">                                                                         </span>
<span style="background-color: #272822">                                                                                                                   </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">        </span><span style="color: #66d9ef; text-decoration-color: #66d9ef; background-color: #272822">return</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> t</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">.</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">to_pyarrow()</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">.</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">to_pylist()</span><span style="background-color: #272822">                                                                         </span>
<span style="background-color: #272822">                                                                                                                   </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">    </span><span style="color: #66d9ef; text-decoration-color: #66d9ef; background-color: #272822">def</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> </span><span style="color: #a6e22e; text-decoration-color: #a6e22e; background-color: #272822">get_todo</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">(self, id: str, user_id: str </span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">=</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> </span><span style="color: #66d9ef; text-decoration-color: #66d9ef; background-color: #272822">None</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">):</span><span style="background-color: #272822">                                                             </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">        t </span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">=</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> self</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">.</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">todos_t(user_id</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">=</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">user_id)</span><span style="background-color: #272822">                                                                         </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">        </span><span style="color: #66d9ef; text-decoration-color: #66d9ef; background-color: #272822">return</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> t</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">.</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">filter(t[</span><span style="color: #e6db74; text-decoration-color: #e6db74; background-color: #272822">"id"</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">] </span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">==</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> id)</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">.</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">to_pyarrow()</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">.</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">to_pylist()[</span><span style="color: #ae81ff; text-decoration-color: #ae81ff; background-color: #272822">0</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">]</span><span style="background-color: #272822">                                                </span>
<span style="background-color: #272822">                                                                                                                   </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">    </span><span style="color: #959077; text-decoration-color: #959077; background-color: #272822"># append record</span><span style="background-color: #272822">                                                                                               </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">    </span><span style="color: #66d9ef; text-decoration-color: #66d9ef; background-color: #272822">def</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> </span><span style="color: #a6e22e; text-decoration-color: #a6e22e; background-color: #272822">append_todo</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">(</span><span style="background-color: #272822">                                                                                              </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">        self,</span><span style="background-color: #272822">                                                                                                     </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">        id: str,</span><span style="background-color: #272822">                                                                                                  </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">        user_id: str,</span><span style="background-color: #272822">                                                                                             </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">        subject: str,</span><span style="background-color: #272822">                                                                                             </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">        body: str,</span><span style="background-color: #272822">                                                                                                </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">        priority: int </span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">=</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> </span><span style="color: #ae81ff; text-decoration-color: #ae81ff; background-color: #272822">100</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">,</span><span style="background-color: #272822">                                                                                      </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">        status: str </span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">=</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> </span><span style="color: #66d9ef; text-decoration-color: #66d9ef; background-color: #272822">None</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">,</span><span style="background-color: #272822">                                                                                       </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">        description: str </span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">=</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> </span><span style="color: #66d9ef; text-decoration-color: #66d9ef; background-color: #272822">None</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">,</span><span style="background-color: #272822">                                                                                  </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">        labels: list[str] </span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">=</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> </span><span style="color: #66d9ef; text-decoration-color: #66d9ef; background-color: #272822">None</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">,</span><span style="background-color: #272822">                                                                                 </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">    ):</span><span style="background-color: #272822">                                                                                                            </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">        </span><span style="color: #66d9ef; text-decoration-color: #66d9ef; background-color: #272822">if</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> self</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">.</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">contains_todo(id</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">=</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">id):</span><span style="background-color: #272822">                                                                             </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">            </span><span style="color: #66d9ef; text-decoration-color: #66d9ef; background-color: #272822">raise</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> </span><span style="color: #a6e22e; text-decoration-color: #a6e22e; background-color: #272822">ValueError</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">(</span><span style="color: #e6db74; text-decoration-color: #e6db74; background-color: #272822">f"todo {</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">id</span><span style="color: #e6db74; text-decoration-color: #e6db74; background-color: #272822">} already exists"</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">)</span><span style="background-color: #272822">                                                         </span>
<span style="background-color: #272822">                                                                                                                   </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">        data </span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">=</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> {</span><span style="background-color: #272822">                                                                                                  </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">            </span><span style="color: #e6db74; text-decoration-color: #e6db74; background-color: #272822">"idx"</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">: [now()],</span><span style="background-color: #272822">                                                                                       </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">            </span><span style="color: #e6db74; text-decoration-color: #e6db74; background-color: #272822">"id"</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">: [id],</span><span style="background-color: #272822">                                                                                           </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">            </span><span style="color: #e6db74; text-decoration-color: #e6db74; background-color: #272822">"user_id"</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">: [user_id],</span><span style="background-color: #272822">                                                                                 </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">            </span><span style="color: #e6db74; text-decoration-color: #e6db74; background-color: #272822">"subject"</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">: [subject],</span><span style="background-color: #272822">                                                                                 </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">            </span><span style="color: #e6db74; text-decoration-color: #e6db74; background-color: #272822">"body"</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">: [body],</span><span style="background-color: #272822">                                                                                       </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">            </span><span style="color: #e6db74; text-decoration-color: #e6db74; background-color: #272822">"priority"</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">: [priority],</span><span style="background-color: #272822">                                                                               </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">            </span><span style="color: #e6db74; text-decoration-color: #e6db74; background-color: #272822">"status"</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">: [status],</span><span style="background-color: #272822">                                                                                   </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">            </span><span style="color: #e6db74; text-decoration-color: #e6db74; background-color: #272822">"description"</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">: [description],</span><span style="background-color: #272822">                                                                         </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">            </span><span style="color: #e6db74; text-decoration-color: #e6db74; background-color: #272822">"labels"</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">: [</span><span style="color: #e6db74; text-decoration-color: #e6db74; background-color: #272822">","</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">.</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">join(labels) </span><span style="color: #66d9ef; text-decoration-color: #66d9ef; background-color: #272822">if</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> labels </span><span style="color: #66d9ef; text-decoration-color: #66d9ef; background-color: #272822">else</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> </span><span style="color: #66d9ef; text-decoration-color: #66d9ef; background-color: #272822">None</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">],</span><span style="background-color: #272822">                                                     </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">        }</span><span style="background-color: #272822">                                                                                                         </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">        self</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">.</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">wcon</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">.</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">insert(self</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">.</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">todos_table_name, data)</span><span style="background-color: #272822">                                                             </span>
<span style="background-color: #272822">                                                                                                                   </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">        </span><span style="color: #66d9ef; text-decoration-color: #66d9ef; background-color: #272822">return</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> self</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">.</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">get_todo(id</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">=</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">id)</span><span style="background-color: #272822">                                                                               </span>
<span style="background-color: #272822">                                                                                                                   </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">    </span><span style="color: #959077; text-decoration-color: #959077; background-color: #272822"># update record</span><span style="background-color: #272822">                                                                                               </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">    </span><span style="color: #66d9ef; text-decoration-color: #66d9ef; background-color: #272822">def</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> </span><span style="color: #a6e22e; text-decoration-color: #a6e22e; background-color: #272822">update_todo</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">(</span><span style="background-color: #272822">                                                                                              </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">        self,</span><span style="background-color: #272822">                                                                                                     </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">        id: str,</span><span style="background-color: #272822">                                                                                                  </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">        user_id: str,</span><span style="background-color: #272822">                                                                                             </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">        subject: str,</span><span style="background-color: #272822">                                                                                             </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">        body: str,</span><span style="background-color: #272822">                                                                                                </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">        priority: int </span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">=</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> </span><span style="color: #ae81ff; text-decoration-color: #ae81ff; background-color: #272822">100</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">,</span><span style="background-color: #272822">                                                                                      </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">        status: str </span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">=</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> </span><span style="color: #66d9ef; text-decoration-color: #66d9ef; background-color: #272822">None</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">,</span><span style="background-color: #272822">                                                                                       </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">        description: str </span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">=</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> </span><span style="color: #66d9ef; text-decoration-color: #66d9ef; background-color: #272822">None</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">,</span><span style="background-color: #272822">                                                                                  </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">        labels: list[str] </span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">=</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> </span><span style="color: #66d9ef; text-decoration-color: #66d9ef; background-color: #272822">None</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">,</span><span style="background-color: #272822">                                                                                 </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">    ):</span><span style="background-color: #272822">                                                                                                            </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">        </span><span style="color: #66d9ef; text-decoration-color: #66d9ef; background-color: #272822">if</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> </span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">not</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> self</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">.</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">contains_todo(id</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">=</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">id):</span><span style="background-color: #272822">                                                                         </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">            </span><span style="color: #66d9ef; text-decoration-color: #66d9ef; background-color: #272822">raise</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> </span><span style="color: #a6e22e; text-decoration-color: #a6e22e; background-color: #272822">ValueError</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">(</span><span style="color: #e6db74; text-decoration-color: #e6db74; background-color: #272822">f"todo {</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">id</span><span style="color: #e6db74; text-decoration-color: #e6db74; background-color: #272822">} does not exist"</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">)</span><span style="background-color: #272822">                                                         </span>
<span style="background-color: #272822">                                                                                                                   </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">        data </span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">=</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> {</span><span style="background-color: #272822">                                                                                                  </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">            </span><span style="color: #e6db74; text-decoration-color: #e6db74; background-color: #272822">"idx"</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">: [now()],</span><span style="background-color: #272822">                                                                                       </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">            </span><span style="color: #e6db74; text-decoration-color: #e6db74; background-color: #272822">"id"</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">: [id],</span><span style="background-color: #272822">                                                                                           </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">            </span><span style="color: #e6db74; text-decoration-color: #e6db74; background-color: #272822">"user_id"</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">: [user_id],</span><span style="background-color: #272822">                                                                                 </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">            </span><span style="color: #e6db74; text-decoration-color: #e6db74; background-color: #272822">"subject"</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">: [subject],</span><span style="background-color: #272822">                                                                                 </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">            </span><span style="color: #e6db74; text-decoration-color: #e6db74; background-color: #272822">"body"</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">: [body],</span><span style="background-color: #272822">                                                                                       </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">            </span><span style="color: #e6db74; text-decoration-color: #e6db74; background-color: #272822">"priority"</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">: [priority],</span><span style="background-color: #272822">                                                                               </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">            </span><span style="color: #e6db74; text-decoration-color: #e6db74; background-color: #272822">"status"</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">: [status],</span><span style="background-color: #272822">                                                                                   </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">            </span><span style="color: #e6db74; text-decoration-color: #e6db74; background-color: #272822">"description"</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">: [description],</span><span style="background-color: #272822">                                                                         </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">            </span><span style="color: #e6db74; text-decoration-color: #e6db74; background-color: #272822">"labels"</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">: [</span><span style="color: #e6db74; text-decoration-color: #e6db74; background-color: #272822">","</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">.</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">join(labels) </span><span style="color: #66d9ef; text-decoration-color: #66d9ef; background-color: #272822">if</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> labels </span><span style="color: #66d9ef; text-decoration-color: #66d9ef; background-color: #272822">else</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> </span><span style="color: #66d9ef; text-decoration-color: #66d9ef; background-color: #272822">None</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">],</span><span style="background-color: #272822">                                                     </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">        }</span><span style="background-color: #272822">                                                                                                         </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">        self</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">.</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">wcon</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">.</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">insert(self</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">.</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">todos_table_name, data)</span><span style="background-color: #272822">                                                             </span>
<span style="background-color: #272822">                                                                                                                   </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">        </span><span style="color: #66d9ef; text-decoration-color: #66d9ef; background-color: #272822">return</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> self</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">.</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">get_todo(id</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">=</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">id)</span><span style="background-color: #272822">                                                                               </span>
<span style="background-color: #272822">                                                                                                                   </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">    </span><span style="color: #959077; text-decoration-color: #959077; background-color: #272822"># aliases</span><span style="background-color: #272822">                                                                                                     </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">    </span><span style="color: #a6e22e; text-decoration-color: #a6e22e; background-color: #272822">__call__</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> </span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">=</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> get_todos</span><span style="background-color: #272822">                                                                                          </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">    t </span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">=</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> todos_t</span><span style="background-color: #272822">                                                                                                   </span>
<span style="background-color: #272822">                                                                                                                   
</span></pre>
</div>
</div>
<p>We have a simple, fast, performant todo list.</p>
</section>
<section id="dkdc-lake" class="level3">
<h3 class="anchored" data-anchor-id="dkdc-lake">dkdc-lake</h3>
<p>Let’s look at <a href="https://github.com/dkdc-io/dkdc-lake">dkdc-lake</a> as another example:</p>
<div id="2d7093bd" class="cell" data-execution_count="12">
<div class="sourceCode cell-code" id="cb17" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> dkdc_lake <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> Lake</span>
<span id="cb17-2"></span>
<span id="cb17-3">lake <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> Lake(dbpath<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"data.db"</span>)</span>
<span id="cb17-4">lake</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="12">
<pre><code>&lt;dkdc_lake.main.Lake at 0x114296b70&gt;</code></pre>
</div>
</div>
<p>We can again view the table/schema:</p>
<div id="86e224d4" class="cell" data-execution_count="13">
<div class="sourceCode cell-code" id="cb19" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1">lake.t()</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="13">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">┏━━━━━━━━━━━━━━┳━━━━━━━━┳━━━━━━━━━┳━━━━━━━━┳━━━━━━━━━━┳━━━━━━━━━━┳━━━━━━━━┳━━━━━━━━━┳━━━━━━━━┳━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃<span style="font-weight: bold"> idx          </span>┃<span style="font-weight: bold"> id     </span>┃<span style="font-weight: bold"> user_id </span>┃<span style="font-weight: bold"> path   </span>┃<span style="font-weight: bold"> filename </span>┃<span style="font-weight: bold"> filetype </span>┃<span style="font-weight: bold"> data   </span>┃<span style="font-weight: bold"> version </span>┃<span style="font-weight: bold"> status </span>┃<span style="font-weight: bold"> description </span>┃<span style="font-weight: bold"> labels        </span>┃
┡━━━━━━━━━━━━━━╇━━━━━━━━╇━━━━━━━━━╇━━━━━━━━╇━━━━━━━━━━╇━━━━━━━━━━╇━━━━━━━━╇━━━━━━━━━╇━━━━━━━━╇━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">timestamp(6)</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>  │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>   │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>   │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">binary</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">int64</span>   │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>      │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">array&lt;string&gt;</span> │
└──────────────┴────────┴─────────┴────────┴──────────┴──────────┴────────┴─────────┴────────┴─────────────┴───────────────┘
</pre>
</div>
</div>
<p>And append a record (representing a file) into it:</p>
<div id="8c4cab60" class="cell" data-execution_count="14">
<div class="sourceCode cell-code" id="cb20" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1">lake.append_file(</span>
<span id="cb20-2">    user_id<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">None</span>,</span>
<span id="cb20-3">    path<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">None</span>,</span>
<span id="cb20-4">    filename<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"test.txt"</span>,</span>
<span id="cb20-5">    filetype<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"txt"</span>,</span>
<span id="cb20-6">    data<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">b"hello world"</span>,</span>
<span id="cb20-7">)</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="14">
<pre><code>{'idx': datetime.datetime(2024, 11, 25, 17, 8, 43, 569924),
 'id': '173255452356992-bc5e9fe6',
 'user_id': None,
 'path': None,
 'filename': 'test.txt',
 'filetype': 'txt',
 'data': b'hello world',
 'version': None,
 'status': None,
 'description': None,
 'labels': None}</code></pre>
</div>
</div>
<p>Now, we see our record:</p>
<div id="67ba9ad4" class="cell" data-execution_count="15">
<div class="sourceCode cell-code" id="cb22" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1">lake.t()</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="15">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━┳━━━━━━━━┳━━━━━━━━━━┳━━━━━━━━━━┳━━━━━━━━━━━━━━━━┳━━━━━━━━━┳━━━━━━━━┳━━━━━━━━━━━━━┳━━━━━━━━┓
┃<span style="font-weight: bold"> idx                        </span>┃<span style="font-weight: bold"> id                       </span>┃<span style="font-weight: bold"> user_id </span>┃<span style="font-weight: bold"> path   </span>┃<span style="font-weight: bold"> filename </span>┃<span style="font-weight: bold"> filetype </span>┃<span style="font-weight: bold"> data           </span>┃<span style="font-weight: bold"> version </span>┃<span style="font-weight: bold"> status </span>┃<span style="font-weight: bold"> description </span>┃<span style="font-weight: bold"> labels </span>┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━╇━━━━━━━━╇━━━━━━━━━━╇━━━━━━━━━━╇━━━━━━━━━━━━━━━━╇━━━━━━━━━╇━━━━━━━━╇━━━━━━━━━━━━━╇━━━━━━━━┩
│ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">timestamp(6)</span>               │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>                   │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>  │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>   │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>   │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">binary</span>         │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">int64</span>   │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>      │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">array…</span> │
├────────────────────────────┼──────────────────────────┼─────────┼────────┼──────────┼──────────┼────────────────┼─────────┼────────┼─────────────┼────────┤
│ <span style="color: #800080; text-decoration-color: #800080">2024-11-25 17:08:43.569924</span> │ <span style="color: #008000; text-decoration-color: #008000">173255452356992-bc5e9fe6</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">NULL</span>    │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">NULL</span>   │ <span style="color: #008000; text-decoration-color: #008000">test.txt</span> │ <span style="color: #008000; text-decoration-color: #008000">txt     </span> │ <span style="color: #008000; text-decoration-color: #008000">b'hello world'</span> │    <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">NULL</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">NULL</span>   │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">NULL</span>        │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">NULL</span>   │
└────────────────────────────┴──────────────────────────┴─────────┴────────┴──────────┴──────────┴────────────────┴─────────┴────────┴─────────────┴────────┘
</pre>
</div>
</div>
<p>And like before can update it:</p>
<div id="e0c7d192" class="cell" data-execution_count="16">
<div class="sourceCode cell-code" id="cb23" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1">lake.update_file(</span>
<span id="cb23-2">    user_id<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">None</span>,</span>
<span id="cb23-3">    path<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">None</span>,</span>
<span id="cb23-4">    filename<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"test.txt"</span>,</span>
<span id="cb23-5">    filetype<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"txt"</span>,</span>
<span id="cb23-6">    data<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">b"hello world!"</span>,</span>
<span id="cb23-7">    version<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">None</span>,</span>
<span id="cb23-8">    status<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">None</span>,</span>
<span id="cb23-9">    description<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">None</span>,</span>
<span id="cb23-10">    labels<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">None</span>,</span>
<span id="cb23-11">)</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="16">
<pre><code>{'idx': datetime.datetime(2024, 11, 25, 17, 8, 43, 652484),
 'id': '173255452356992-bc5e9fe6',
 'user_id': None,
 'path': None,
 'filename': 'test.txt',
 'filetype': 'txt',
 'data': b'hello world!',
 'version': None,
 'status': None,
 'description': None,
 'labels': None}</code></pre>
</div>
</div>
<p>Showing only one row:</p>
<div id="645137f2" class="cell" data-execution_count="17">
<div class="sourceCode cell-code" id="cb25" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1">lake.t()</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="17">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━┳━━━━━━━━┳━━━━━━━━━━┳━━━━━━━━━━┳━━━━━━━━━━━━━━━━━┳━━━━━━━━━┳━━━━━━━━┳━━━━━━━━━━━━━┳━━━━━━━━┓
┃<span style="font-weight: bold"> idx                        </span>┃<span style="font-weight: bold"> id                       </span>┃<span style="font-weight: bold"> user_id </span>┃<span style="font-weight: bold"> path   </span>┃<span style="font-weight: bold"> filename </span>┃<span style="font-weight: bold"> filetype </span>┃<span style="font-weight: bold"> data            </span>┃<span style="font-weight: bold"> version </span>┃<span style="font-weight: bold"> status </span>┃<span style="font-weight: bold"> description </span>┃<span style="font-weight: bold"> labels </span>┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━╇━━━━━━━━╇━━━━━━━━━━╇━━━━━━━━━━╇━━━━━━━━━━━━━━━━━╇━━━━━━━━━╇━━━━━━━━╇━━━━━━━━━━━━━╇━━━━━━━━┩
│ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">timestamp(6)</span>               │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>                   │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>  │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>   │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>   │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">binary</span>          │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">int64</span>   │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>      │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">array…</span> │
├────────────────────────────┼──────────────────────────┼─────────┼────────┼──────────┼──────────┼─────────────────┼─────────┼────────┼─────────────┼────────┤
│ <span style="color: #800080; text-decoration-color: #800080">2024-11-25 17:08:43.652484</span> │ <span style="color: #008000; text-decoration-color: #008000">173255452356992-bc5e9fe6</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">NULL</span>    │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">NULL</span>   │ <span style="color: #008000; text-decoration-color: #008000">test.txt</span> │ <span style="color: #008000; text-decoration-color: #008000">txt     </span> │ <span style="color: #008000; text-decoration-color: #008000">b'hello world!'</span> │    <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">NULL</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">NULL</span>   │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">NULL</span>        │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">NULL</span>   │
└────────────────────────────┴──────────────────────────┴─────────┴────────┴──────────┴──────────┴─────────────────┴─────────┴────────┴─────────────┴────────┘
</pre>
</div>
</div>
<p>But again, there are two in the underlying SQLite table:</p>
<div id="fa6e6b70" class="cell" data-execution_count="18">
<div class="sourceCode cell-code" id="cb26" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1">lake.wcon.table(lake.lake_table_name)</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="18">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━┳━━━━━━━━┳━━━━━━━━━━┳━━━━━━━━━━┳━━━━━━━━━━━━━━━━━┳━━━━━━━━━┳━━━━━━━━┳━━━━━━━━━━━━━┳━━━━━━━━┓
┃<span style="font-weight: bold"> idx                        </span>┃<span style="font-weight: bold"> id                       </span>┃<span style="font-weight: bold"> user_id </span>┃<span style="font-weight: bold"> path   </span>┃<span style="font-weight: bold"> filename </span>┃<span style="font-weight: bold"> filetype </span>┃<span style="font-weight: bold"> data            </span>┃<span style="font-weight: bold"> version </span>┃<span style="font-weight: bold"> status </span>┃<span style="font-weight: bold"> description </span>┃<span style="font-weight: bold"> labels </span>┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━╇━━━━━━━━╇━━━━━━━━━━╇━━━━━━━━━━╇━━━━━━━━━━━━━━━━━╇━━━━━━━━━╇━━━━━━━━╇━━━━━━━━━━━━━╇━━━━━━━━┩
│ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">timestamp</span>                  │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>                   │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>  │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>   │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>   │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">binary</span>          │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">int64</span>   │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>      │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span> │
├────────────────────────────┼──────────────────────────┼─────────┼────────┼──────────┼──────────┼─────────────────┼─────────┼────────┼─────────────┼────────┤
│ <span style="color: #800080; text-decoration-color: #800080">2024-11-25 17:08:43.569924</span> │ <span style="color: #008000; text-decoration-color: #008000">173255452356992-bc5e9fe6</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">NULL</span>    │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">NULL</span>   │ <span style="color: #008000; text-decoration-color: #008000">test.txt</span> │ <span style="color: #008000; text-decoration-color: #008000">txt     </span> │ <span style="color: #008000; text-decoration-color: #008000">b'hello world'</span>  │    <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">NULL</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">NULL</span>   │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">NULL</span>        │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">NULL</span>   │
│ <span style="color: #800080; text-decoration-color: #800080">2024-11-25 17:08:43.652484</span> │ <span style="color: #008000; text-decoration-color: #008000">173255452356992-bc5e9fe6</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">NULL</span>    │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">NULL</span>   │ <span style="color: #008000; text-decoration-color: #008000">test.txt</span> │ <span style="color: #008000; text-decoration-color: #008000">txt     </span> │ <span style="color: #008000; text-decoration-color: #008000">b'hello world!'</span> │    <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">NULL</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">NULL</span>   │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">NULL</span>        │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">NULL</span>   │
└────────────────────────────┴──────────────────────────┴─────────┴────────┴──────────┴──────────┴─────────────────┴─────────┴────────┴─────────────┴────────┘
</pre>
</div>
</div>
<p>Our view above is using a window function over <code>idx</code> (a timestamp) to take only the latest version of the record:</p>
<div id="4db07a51" class="cell" data-execution_count="19">
<details class="code-fold">
<summary>Lake class code code</summary>
<div class="sourceCode cell-code" id="cb27" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1">get_class_source(Lake)</span></code></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="19">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace"><span style="background-color: #272822">                                                                                                                   
 </span><span style="color: #66d9ef; text-decoration-color: #66d9ef; background-color: #272822">class</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> </span><span style="color: #a6e22e; text-decoration-color: #a6e22e; background-color: #272822">Lake</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">(State):</span><span style="background-color: #272822">                                                                                                </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">    </span><span style="color: #66d9ef; text-decoration-color: #66d9ef; background-color: #272822">def</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> </span><span style="color: #a6e22e; text-decoration-color: #a6e22e; background-color: #272822">__init__</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">(self, dbpath: str </span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">=</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> </span><span style="color: #66d9ef; text-decoration-color: #66d9ef; background-color: #272822">None</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">):</span><span style="background-color: #272822">                                                                       </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">        </span><span style="color: #66d9ef; text-decoration-color: #66d9ef; background-color: #272822">if</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> dbpath </span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">is</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> </span><span style="color: #66d9ef; text-decoration-color: #66d9ef; background-color: #272822">None</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">:</span><span style="background-color: #272822">                                                                                        </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">            dbpath </span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">=</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> os</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">.</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">path</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">.</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">join(get_dkdc_dir(), </span><span style="color: #e6db74; text-decoration-color: #e6db74; background-color: #272822">"lake.db"</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">)</span><span style="background-color: #272822">                                                      </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">        super()</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">.</span><span style="color: #a6e22e; text-decoration-color: #a6e22e; background-color: #272822">__init__</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">(dbpath</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">=</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">dbpath)</span><span style="background-color: #272822">                                                                           </span>
<span style="background-color: #272822">                                                                                                                   </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">    </span><span style="color: #66d9ef; text-decoration-color: #66d9ef; background-color: #272822">def</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> </span><span style="color: #a6e22e; text-decoration-color: #a6e22e; background-color: #272822">_cons</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">(self) </span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">-&gt;</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> (ibis</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">.</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">BaseBackend, ibis</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">.</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">BaseBackend):</span><span style="background-color: #272822">                                                      </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">        </span><span style="color: #959077; text-decoration-color: #959077; background-color: #272822"># create write connection</span><span style="background-color: #272822">                                                                                 </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">        wcon </span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">=</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> ibis</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">.</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">sqlite</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">.</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">connect(self</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">.</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">dbpath)</span><span style="background-color: #272822">                                                                   </span>
<span style="background-color: #272822">                                                                                                                   </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">        </span><span style="color: #959077; text-decoration-color: #959077; background-color: #272822"># create tables in write connection</span><span style="background-color: #272822">                                                                       </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">        </span><span style="color: #959077; text-decoration-color: #959077; background-color: #272822">## lake data</span><span style="background-color: #272822">                                                                                              </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">        self</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">.</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">lake_table_name </span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">=</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> </span><span style="color: #e6db74; text-decoration-color: #e6db74; background-color: #272822">"lake"</span><span style="background-color: #272822">                                                                             </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">        schema </span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">=</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> ibis</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">.</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">schema(</span><span style="background-color: #272822">                                                                                     </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">            {</span><span style="background-color: #272822">                                                                                                     </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">                </span><span style="color: #e6db74; text-decoration-color: #e6db74; background-color: #272822">"idx"</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">: dt</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">.</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">timestamp,</span><span style="background-color: #272822">                                                                              </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">                </span><span style="color: #e6db74; text-decoration-color: #e6db74; background-color: #272822">"id"</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">: str,</span><span style="background-color: #272822">                                                                                        </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">                </span><span style="color: #e6db74; text-decoration-color: #e6db74; background-color: #272822">"user_id"</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">: str,</span><span style="background-color: #272822">                                                                                   </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">                </span><span style="color: #e6db74; text-decoration-color: #e6db74; background-color: #272822">"path"</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">: str,</span><span style="background-color: #272822">                                                                                      </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">                </span><span style="color: #e6db74; text-decoration-color: #e6db74; background-color: #272822">"filename"</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">: str,</span><span style="background-color: #272822">                                                                                  </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">                </span><span style="color: #e6db74; text-decoration-color: #e6db74; background-color: #272822">"filetype"</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">: str,</span><span style="background-color: #272822">                                                                                  </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">                </span><span style="color: #e6db74; text-decoration-color: #e6db74; background-color: #272822">"data"</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">: dt</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">.</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">binary,</span><span style="background-color: #272822">                                                                                </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">                </span><span style="color: #e6db74; text-decoration-color: #e6db74; background-color: #272822">"version"</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">: int,</span><span style="background-color: #272822">                                                                                   </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">                </span><span style="color: #e6db74; text-decoration-color: #e6db74; background-color: #272822">"status"</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">: str,</span><span style="background-color: #272822">                                                                                    </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">                </span><span style="color: #e6db74; text-decoration-color: #e6db74; background-color: #272822">"description"</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">: str,</span><span style="background-color: #272822">                                                                               </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">                </span><span style="color: #e6db74; text-decoration-color: #e6db74; background-color: #272822">"labels"</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">: str,  </span><span style="color: #959077; text-decoration-color: #959077; background-color: #272822"># comma-separated list of labels</span><span style="background-color: #272822">                                                  </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">            }</span><span style="background-color: #272822">                                                                                                     </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">        )</span><span style="background-color: #272822">                                                                                                         </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">        </span><span style="color: #66d9ef; text-decoration-color: #66d9ef; background-color: #272822">if</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> self</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">.</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">lake_table_name </span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">not</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> </span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">in</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> wcon</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">.</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">list_tables():</span><span style="background-color: #272822">                                                        </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">            wcon</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">.</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">create_table(self</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">.</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">lake_table_name, schema</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">=</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">schema)</span><span style="background-color: #272822">                                                </span>
<span style="background-color: #272822">                                                                                                                   </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">        </span><span style="color: #959077; text-decoration-color: #959077; background-color: #272822"># create read connection</span><span style="background-color: #272822">                                                                                  </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">        rcon </span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">=</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> ibis</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">.</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">duckdb</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">.</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">connect()</span><span style="background-color: #272822">                                                                              </span>
<span style="background-color: #272822">                                                                                                                   </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">        </span><span style="color: #959077; text-decoration-color: #959077; background-color: #272822"># create tables in read connection</span><span style="background-color: #272822">                                                                        </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">        </span><span style="color: #66d9ef; text-decoration-color: #66d9ef; background-color: #272822">for</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> table_name </span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">in</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> wcon</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">.</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">list_tables():</span><span style="background-color: #272822">                                                                     </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">            rcon</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">.</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">read_sqlite(self</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">.</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">dbpath, table_name</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">=</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">table_name)</span><span style="background-color: #272822">                                                  </span>
<span style="background-color: #272822">                                                                                                                   </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">        </span><span style="color: #66d9ef; text-decoration-color: #66d9ef; background-color: #272822">return</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> wcon, rcon</span><span style="background-color: #272822">                                                                                         </span>
<span style="background-color: #272822">                                                                                                                   </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">    </span><span style="color: #959077; text-decoration-color: #959077; background-color: #272822"># tables</span><span style="background-color: #272822">                                                                                                      </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">    </span><span style="color: #66d9ef; text-decoration-color: #66d9ef; background-color: #272822">def</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> </span><span style="color: #a6e22e; text-decoration-color: #a6e22e; background-color: #272822">lake_t</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">(self, user_id: str </span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">=</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> </span><span style="color: #66d9ef; text-decoration-color: #66d9ef; background-color: #272822">None</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">):</span><span style="background-color: #272822">                                                                        </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">        </span><span style="color: #959077; text-decoration-color: #959077; background-color: #272822"># get lake data</span><span style="background-color: #272822">                                                                                           </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">        t </span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">=</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> self</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">.</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">rcon</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">.</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">table(self</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">.</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">lake_table_name)</span><span style="background-color: #272822">                                                                 </span>
<span style="background-color: #272822">                                                                                                                   </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">        </span><span style="color: #959077; text-decoration-color: #959077; background-color: #272822"># filter by user_id</span><span style="background-color: #272822">                                                                                       </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">        </span><span style="color: #66d9ef; text-decoration-color: #66d9ef; background-color: #272822">if</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> user_id:</span><span style="background-color: #272822">                                                                                               </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">            t </span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">=</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> t</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">.</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">filter(t[</span><span style="color: #e6db74; text-decoration-color: #e6db74; background-color: #272822">"user_id"</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">] </span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">==</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> user_id)</span><span style="background-color: #272822">                                                                 </span>
<span style="background-color: #272822">                                                                                                                   </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">        </span><span style="color: #959077; text-decoration-color: #959077; background-color: #272822"># get only the latest metadata</span><span style="background-color: #272822">                                                                            </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">        t </span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">=</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> (</span><span style="background-color: #272822">                                                                                                     </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">            t</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">.</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">mutate(</span><span style="background-color: #272822">                                                                                             </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">                rank</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">=</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">ibis</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">.</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">row_number()</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">.</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">over(</span><span style="background-color: #272822">                                                                      </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">                    ibis</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">.</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">window(</span><span style="background-color: #272822">                                                                                  </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">                        group_by</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">=</span><span style="color: #e6db74; text-decoration-color: #e6db74; background-color: #272822">"id"</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">,</span><span style="background-color: #272822">                                                                            </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">                        order_by</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">=</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">ibis</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">.</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">desc(</span><span style="color: #e6db74; text-decoration-color: #e6db74; background-color: #272822">"idx"</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">),</span><span style="background-color: #272822">                                                                </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">                    )</span><span style="background-color: #272822">                                                                                             </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">                )</span><span style="background-color: #272822">                                                                                                 </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">            )</span><span style="background-color: #272822">                                                                                                     </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">            </span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">.</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">filter(ibis</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">.</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">_[</span><span style="color: #e6db74; text-decoration-color: #e6db74; background-color: #272822">"rank"</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">] </span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">==</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> </span><span style="color: #ae81ff; text-decoration-color: #ae81ff; background-color: #272822">0</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">)</span><span style="background-color: #272822">                                                                          </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">            </span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">.</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">drop(</span><span style="color: #e6db74; text-decoration-color: #e6db74; background-color: #272822">"rank"</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">)</span><span style="background-color: #272822">                                                                                         </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">        )</span><span style="background-color: #272822">                                                                                                         </span>
<span style="background-color: #272822">                                                                                                                   </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">        </span><span style="color: #959077; text-decoration-color: #959077; background-color: #272822"># comma-separated lists to arrays</span><span style="background-color: #272822">                                                                         </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">        t </span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">=</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> t</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">.</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">mutate(labels</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">=</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">t[</span><span style="color: #e6db74; text-decoration-color: #e6db74; background-color: #272822">"labels"</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">]</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">.</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">split(</span><span style="color: #e6db74; text-decoration-color: #e6db74; background-color: #272822">","</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">))</span><span style="background-color: #272822">                                                               </span>
<span style="background-color: #272822">                                                                                                                   </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">        </span><span style="color: #959077; text-decoration-color: #959077; background-color: #272822"># order</span><span style="background-color: #272822">                                                                                                   </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">        t </span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">=</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> t</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">.</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">order_by(ibis</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">.</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">desc(</span><span style="color: #e6db74; text-decoration-color: #e6db74; background-color: #272822">"idx"</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">))</span><span style="background-color: #272822">                                                                          </span>
<span style="background-color: #272822">                                                                                                                   </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">        </span><span style="color: #959077; text-decoration-color: #959077; background-color: #272822"># return the data</span><span style="background-color: #272822">                                                                                         </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">        </span><span style="color: #66d9ef; text-decoration-color: #66d9ef; background-color: #272822">return</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> t</span><span style="background-color: #272822">                                                                                                  </span>
<span style="background-color: #272822">                                                                                                                   </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">    </span><span style="color: #959077; text-decoration-color: #959077; background-color: #272822"># contains</span><span style="background-color: #272822">                                                                                                    </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">    </span><span style="color: #66d9ef; text-decoration-color: #66d9ef; background-color: #272822">def</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> </span><span style="color: #a6e22e; text-decoration-color: #a6e22e; background-color: #272822">contains_path</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">(self, path: str, user_id: str </span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">=</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> </span><span style="color: #66d9ef; text-decoration-color: #66d9ef; background-color: #272822">None</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">) </span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">-&gt;</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> bool:</span><span style="background-color: #272822">                                              </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">        t </span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">=</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> self</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">.</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">lake_t(user_id</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">=</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">user_id)</span><span style="background-color: #272822">                                                                          </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">        </span><span style="color: #66d9ef; text-decoration-color: #66d9ef; background-color: #272822">return</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> t</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">.</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">filter(t[</span><span style="color: #e6db74; text-decoration-color: #e6db74; background-color: #272822">"path"</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">] </span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">==</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> path)</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">.</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">count()</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">.</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">to_pyarrow()</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">.</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">as_py() </span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">&gt;</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> </span><span style="color: #ae81ff; text-decoration-color: #ae81ff; background-color: #272822">0</span><span style="background-color: #272822">                                       </span>
<span style="background-color: #272822">                                                                                                                   </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">    </span><span style="color: #66d9ef; text-decoration-color: #66d9ef; background-color: #272822">def</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> </span><span style="color: #a6e22e; text-decoration-color: #a6e22e; background-color: #272822">contains_file</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">(</span><span style="background-color: #272822">                                                                                            </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">        self, filename: str, path: str </span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">=</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> </span><span style="color: #66d9ef; text-decoration-color: #66d9ef; background-color: #272822">None</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">, user_id: str </span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">=</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> </span><span style="color: #66d9ef; text-decoration-color: #66d9ef; background-color: #272822">None</span><span style="background-color: #272822">                                                </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">    ) </span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">-&gt;</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> bool:</span><span style="background-color: #272822">                                                                                                    </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">        t </span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">=</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> self</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">.</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">lake_t(user_id</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">=</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">user_id)</span><span style="background-color: #272822">                                                                          </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">        </span><span style="color: #66d9ef; text-decoration-color: #66d9ef; background-color: #272822">return</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> (</span><span style="background-color: #272822">                                                                                                  </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">            t</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">.</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">filter((t[</span><span style="color: #e6db74; text-decoration-color: #e6db74; background-color: #272822">"path"</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">] </span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">==</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> path) </span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">&amp;</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> (t[</span><span style="color: #e6db74; text-decoration-color: #e6db74; background-color: #272822">"filename"</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">] </span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">==</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> filename))</span><span style="background-color: #272822">                                           </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">            </span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">.</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">count()</span><span style="background-color: #272822">                                                                                              </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">            </span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">.</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">to_pyarrow()</span><span style="background-color: #272822">                                                                                         </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">            </span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">.</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">as_py()</span><span style="background-color: #272822">                                                                                              </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">            </span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">&gt;</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> </span><span style="color: #ae81ff; text-decoration-color: #ae81ff; background-color: #272822">0</span><span style="background-color: #272822">                                                                                                   </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">        )</span><span style="background-color: #272822">                                                                                                         </span>
<span style="background-color: #272822">                                                                                                                   </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">    </span><span style="color: #959077; text-decoration-color: #959077; background-color: #272822"># get record</span><span style="background-color: #272822">                                                                                                  </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">    </span><span style="color: #66d9ef; text-decoration-color: #66d9ef; background-color: #272822">def</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> </span><span style="color: #a6e22e; text-decoration-color: #a6e22e; background-color: #272822">get_file</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">(self, filename: str, path: str </span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">=</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> </span><span style="color: #66d9ef; text-decoration-color: #66d9ef; background-color: #272822">None</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">, user_id: str </span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">=</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> </span><span style="color: #66d9ef; text-decoration-color: #66d9ef; background-color: #272822">None</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">):</span><span style="background-color: #272822">                                     </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">        </span><span style="color: #66d9ef; text-decoration-color: #66d9ef; background-color: #272822">if</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> </span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">not</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> self</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">.</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">contains_file(filename</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">=</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">filename, path</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">=</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">path, user_id</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">=</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">user_id):</span><span style="background-color: #272822">                                 </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">            </span><span style="color: #66d9ef; text-decoration-color: #66d9ef; background-color: #272822">raise</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> </span><span style="color: #a6e22e; text-decoration-color: #a6e22e; background-color: #272822">ValueError</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">(</span><span style="color: #e6db74; text-decoration-color: #e6db74; background-color: #272822">f"File {</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">filename</span><span style="color: #e6db74; text-decoration-color: #e6db74; background-color: #272822">} does not exist"</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">)</span><span style="background-color: #272822">                                                   </span>
<span style="background-color: #272822">                                                                                                                   </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">        t </span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">=</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> self</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">.</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">lake_t(user_id</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">=</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">user_id)</span><span style="background-color: #272822">                                                                          </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">        </span><span style="color: #66d9ef; text-decoration-color: #66d9ef; background-color: #272822">return</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> (</span><span style="background-color: #272822">                                                                                                  </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">            t</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">.</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">filter((t[</span><span style="color: #e6db74; text-decoration-color: #e6db74; background-color: #272822">"path"</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">] </span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">==</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> path) </span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">&amp;</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> (t[</span><span style="color: #e6db74; text-decoration-color: #e6db74; background-color: #272822">"filename"</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">] </span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">==</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> filename))</span><span style="background-color: #272822">                                           </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">            </span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">.</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">to_pyarrow()</span><span style="background-color: #272822">                                                                                         </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">            </span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">.</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">to_pylist()[</span><span style="color: #ae81ff; text-decoration-color: #ae81ff; background-color: #272822">0</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">]</span><span style="background-color: #272822">                                                                                       </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">        )</span><span style="background-color: #272822">                                                                                                         </span>
<span style="background-color: #272822">                                                                                                                   </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">    </span><span style="color: #959077; text-decoration-color: #959077; background-color: #272822"># append record</span><span style="background-color: #272822">                                                                                               </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">    </span><span style="color: #66d9ef; text-decoration-color: #66d9ef; background-color: #272822">def</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> </span><span style="color: #a6e22e; text-decoration-color: #a6e22e; background-color: #272822">append_file</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">(</span><span style="background-color: #272822">                                                                                              </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">        self,</span><span style="background-color: #272822">                                                                                                     </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">        user_id: str </span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">=</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> </span><span style="color: #66d9ef; text-decoration-color: #66d9ef; background-color: #272822">None</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">,</span><span style="background-color: #272822">                                                                                      </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">        path: str </span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">=</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> </span><span style="color: #66d9ef; text-decoration-color: #66d9ef; background-color: #272822">None</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">,</span><span style="background-color: #272822">                                                                                         </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">        filename: str </span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">=</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> </span><span style="color: #66d9ef; text-decoration-color: #66d9ef; background-color: #272822">None</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">,</span><span style="background-color: #272822">                                                                                     </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">        filetype: str </span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">=</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> </span><span style="color: #66d9ef; text-decoration-color: #66d9ef; background-color: #272822">None</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">,</span><span style="background-color: #272822">                                                                                     </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">        data: bytes </span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">=</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> </span><span style="color: #66d9ef; text-decoration-color: #66d9ef; background-color: #272822">None</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">,</span><span style="background-color: #272822">                                                                                       </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">        version: int </span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">=</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> </span><span style="color: #66d9ef; text-decoration-color: #66d9ef; background-color: #272822">None</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">,</span><span style="background-color: #272822">                                                                                      </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">        status: str </span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">=</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> </span><span style="color: #66d9ef; text-decoration-color: #66d9ef; background-color: #272822">None</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">,</span><span style="background-color: #272822">                                                                                       </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">        description: str </span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">=</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> </span><span style="color: #66d9ef; text-decoration-color: #66d9ef; background-color: #272822">None</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">,</span><span style="background-color: #272822">                                                                                  </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">        labels: list[str] </span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">=</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> </span><span style="color: #66d9ef; text-decoration-color: #66d9ef; background-color: #272822">None</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">,</span><span style="background-color: #272822">                                                                                 </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">    ):</span><span style="background-color: #272822">                                                                                                            </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">        </span><span style="color: #66d9ef; text-decoration-color: #66d9ef; background-color: #272822">assert</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> (filename </span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">is</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> </span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">not</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> </span><span style="color: #66d9ef; text-decoration-color: #66d9ef; background-color: #272822">None</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">) </span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">and</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> (</span><span style="background-color: #272822">                                                                       </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">            data </span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">is</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> </span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">not</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> </span><span style="color: #66d9ef; text-decoration-color: #66d9ef; background-color: #272822">None</span><span style="background-color: #272822">                                                                                      </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">        ), </span><span style="color: #e6db74; text-decoration-color: #e6db74; background-color: #272822">"user_id, filename, and data are required"</span><span style="background-color: #272822">                                                             </span>
<span style="background-color: #272822">                                                                                                                   </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">        </span><span style="color: #66d9ef; text-decoration-color: #66d9ef; background-color: #272822">if</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> self</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">.</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">contains_file(filename</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">=</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">filename, path</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">=</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">path, user_id</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">=</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">user_id):</span><span style="background-color: #272822">                                     </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">            </span><span style="color: #66d9ef; text-decoration-color: #66d9ef; background-color: #272822">raise</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> </span><span style="color: #a6e22e; text-decoration-color: #a6e22e; background-color: #272822">ValueError</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">(</span><span style="color: #e6db74; text-decoration-color: #e6db74; background-color: #272822">f"File {</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">filename</span><span style="color: #e6db74; text-decoration-color: #e6db74; background-color: #272822">} already exists"</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">)</span><span style="background-color: #272822">                                                   </span>
<span style="background-color: #272822">                                                                                                                   </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">        data </span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">=</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> {</span><span style="background-color: #272822">                                                                                                  </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">            </span><span style="color: #e6db74; text-decoration-color: #e6db74; background-color: #272822">"idx"</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">: [now()],</span><span style="background-color: #272822">                                                                                       </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">            </span><span style="color: #e6db74; text-decoration-color: #e6db74; background-color: #272822">"id"</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">: [uuid()],</span><span style="background-color: #272822">                                                                                       </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">            </span><span style="color: #e6db74; text-decoration-color: #e6db74; background-color: #272822">"user_id"</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">: [user_id],</span><span style="background-color: #272822">                                                                                 </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">            </span><span style="color: #e6db74; text-decoration-color: #e6db74; background-color: #272822">"path"</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">: [path],</span><span style="background-color: #272822">                                                                                       </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">            </span><span style="color: #e6db74; text-decoration-color: #e6db74; background-color: #272822">"filename"</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">: [filename],</span><span style="background-color: #272822">                                                                               </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">            </span><span style="color: #e6db74; text-decoration-color: #e6db74; background-color: #272822">"filetype"</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">: [filetype],</span><span style="background-color: #272822">                                                                               </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">            </span><span style="color: #e6db74; text-decoration-color: #e6db74; background-color: #272822">"data"</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">: [data],</span><span style="background-color: #272822">                                                                                       </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">            </span><span style="color: #e6db74; text-decoration-color: #e6db74; background-color: #272822">"version"</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">: [version],</span><span style="background-color: #272822">                                                                                 </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">            </span><span style="color: #e6db74; text-decoration-color: #e6db74; background-color: #272822">"status"</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">: [status],</span><span style="background-color: #272822">                                                                                   </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">            </span><span style="color: #e6db74; text-decoration-color: #e6db74; background-color: #272822">"description"</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">: [description],</span><span style="background-color: #272822">                                                                         </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">            </span><span style="color: #e6db74; text-decoration-color: #e6db74; background-color: #272822">"labels"</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">: [</span><span style="color: #e6db74; text-decoration-color: #e6db74; background-color: #272822">","</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">.</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">join(labels) </span><span style="color: #66d9ef; text-decoration-color: #66d9ef; background-color: #272822">if</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> labels </span><span style="color: #66d9ef; text-decoration-color: #66d9ef; background-color: #272822">else</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> </span><span style="color: #66d9ef; text-decoration-color: #66d9ef; background-color: #272822">None</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">],</span><span style="background-color: #272822">                                                     </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">        }</span><span style="background-color: #272822">                                                                                                         </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">        self</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">.</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">wcon</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">.</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">insert(self</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">.</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">lake_table_name, data)</span><span style="background-color: #272822">                                                              </span>
<span style="background-color: #272822">                                                                                                                   </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">        </span><span style="color: #66d9ef; text-decoration-color: #66d9ef; background-color: #272822">return</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> self</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">.</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">get_file(filename</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">=</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">filename, path</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">=</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">path, user_id</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">=</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">user_id)</span><span style="background-color: #272822">                                       </span>
<span style="background-color: #272822">                                                                                                                   </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">    </span><span style="color: #959077; text-decoration-color: #959077; background-color: #272822"># update record</span><span style="background-color: #272822">                                                                                               </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">    </span><span style="color: #66d9ef; text-decoration-color: #66d9ef; background-color: #272822">def</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> </span><span style="color: #a6e22e; text-decoration-color: #a6e22e; background-color: #272822">update_file</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">(</span><span style="background-color: #272822">                                                                                              </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">        self,</span><span style="background-color: #272822">                                                                                                     </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">        user_id: str,</span><span style="background-color: #272822">                                                                                             </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">        path: str,</span><span style="background-color: #272822">                                                                                                </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">        filename: str,</span><span style="background-color: #272822">                                                                                            </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">        filetype: str,</span><span style="background-color: #272822">                                                                                            </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">        data: bytes,</span><span style="background-color: #272822">                                                                                              </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">        version: int,</span><span style="background-color: #272822">                                                                                             </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">        status: str,</span><span style="background-color: #272822">                                                                                              </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">        description: str,</span><span style="background-color: #272822">                                                                                         </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">        labels: list[str] </span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">=</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> </span><span style="color: #66d9ef; text-decoration-color: #66d9ef; background-color: #272822">None</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">,</span><span style="background-color: #272822">                                                                                 </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">    ):</span><span style="background-color: #272822">                                                                                                            </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">        </span><span style="color: #66d9ef; text-decoration-color: #66d9ef; background-color: #272822">if</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> </span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">not</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> self</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">.</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">contains_file(filename</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">=</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">filename, path</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">=</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">path, user_id</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">=</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">user_id):</span><span style="background-color: #272822">                                 </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">            </span><span style="color: #66d9ef; text-decoration-color: #66d9ef; background-color: #272822">raise</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> </span><span style="color: #a6e22e; text-decoration-color: #a6e22e; background-color: #272822">ValueError</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">(</span><span style="color: #e6db74; text-decoration-color: #e6db74; background-color: #272822">f"File {</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">filename</span><span style="color: #e6db74; text-decoration-color: #e6db74; background-color: #272822">} does not exist"</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">)</span><span style="background-color: #272822">                                                   </span>
<span style="background-color: #272822">                                                                                                                   </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">        f </span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">=</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> self</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">.</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">get_file(filename</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">=</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">filename, path</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">=</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">path, user_id</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">=</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">user_id)</span><span style="background-color: #272822">                                          </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">        id </span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">=</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> f[</span><span style="color: #e6db74; text-decoration-color: #e6db74; background-color: #272822">"id"</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">]</span><span style="background-color: #272822">                                                                                              </span>
<span style="background-color: #272822">                                                                                                                   </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">        data </span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">=</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> {</span><span style="background-color: #272822">                                                                                                  </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">            </span><span style="color: #e6db74; text-decoration-color: #e6db74; background-color: #272822">"idx"</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">: [now()],</span><span style="background-color: #272822">                                                                                       </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">            </span><span style="color: #e6db74; text-decoration-color: #e6db74; background-color: #272822">"id"</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">: [id],</span><span style="background-color: #272822">                                                                                           </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">            </span><span style="color: #e6db74; text-decoration-color: #e6db74; background-color: #272822">"user_id"</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">: [user_id],</span><span style="background-color: #272822">                                                                                 </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">            </span><span style="color: #e6db74; text-decoration-color: #e6db74; background-color: #272822">"path"</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">: [path],</span><span style="background-color: #272822">                                                                                       </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">            </span><span style="color: #e6db74; text-decoration-color: #e6db74; background-color: #272822">"filename"</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">: [filename],</span><span style="background-color: #272822">                                                                               </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">            </span><span style="color: #e6db74; text-decoration-color: #e6db74; background-color: #272822">"filetype"</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">: [filetype],</span><span style="background-color: #272822">                                                                               </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">            </span><span style="color: #e6db74; text-decoration-color: #e6db74; background-color: #272822">"data"</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">: [data],</span><span style="background-color: #272822">                                                                                       </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">            </span><span style="color: #e6db74; text-decoration-color: #e6db74; background-color: #272822">"version"</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">: [version],</span><span style="background-color: #272822">                                                                                 </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">            </span><span style="color: #e6db74; text-decoration-color: #e6db74; background-color: #272822">"status"</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">: [status],</span><span style="background-color: #272822">                                                                                   </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">            </span><span style="color: #e6db74; text-decoration-color: #e6db74; background-color: #272822">"description"</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">: [description],</span><span style="background-color: #272822">                                                                         </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">            </span><span style="color: #e6db74; text-decoration-color: #e6db74; background-color: #272822">"labels"</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">: [</span><span style="color: #e6db74; text-decoration-color: #e6db74; background-color: #272822">","</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">.</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">join(labels) </span><span style="color: #66d9ef; text-decoration-color: #66d9ef; background-color: #272822">if</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> labels </span><span style="color: #66d9ef; text-decoration-color: #66d9ef; background-color: #272822">else</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> </span><span style="color: #66d9ef; text-decoration-color: #66d9ef; background-color: #272822">None</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">],</span><span style="background-color: #272822">                                                     </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">        }</span><span style="background-color: #272822">                                                                                                         </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">        self</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">.</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">wcon</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">.</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">insert(self</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">.</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">lake_table_name, data)</span><span style="background-color: #272822">                                                              </span>
<span style="background-color: #272822">                                                                                                                   </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">        </span><span style="color: #66d9ef; text-decoration-color: #66d9ef; background-color: #272822">return</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> self</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">.</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">get_file(filename</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">=</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">filename, path</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">=</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">path, user_id</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">=</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">user_id)</span><span style="background-color: #272822">                                       </span>
<span style="background-color: #272822">                                                                                                                   </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">    </span><span style="color: #959077; text-decoration-color: #959077; background-color: #272822"># aliases</span><span style="background-color: #272822">                                                                                                     </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">    </span><span style="color: #a6e22e; text-decoration-color: #a6e22e; background-color: #272822">__call__</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> </span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">=</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> get_file</span><span style="background-color: #272822">                                                                                           </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">    t </span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">=</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> lake_t</span><span style="background-color: #272822">                                                                                                    </span>
<span style="background-color: #272822">                                                                                                                   
</span></pre>
</div>
</div>
</section>
</section>
<section id="looking-ahead" class="level2">
<h2 class="anchored" data-anchor-id="looking-ahead">looking ahead</h2>
<p>I’m not <em>really</em> sure how well this works in practice at scale. I know I can process <a href="https://ibis-project.org/posts/1tbc">a few billion rows on my laptop</a> with DuckDB, though that was on Parquet files and not views on top of SQLite tables. I’m not sure how well concurrent users writing to the same SQLite database will work. But it should be fine?</p>
<div class="callout callout-style-default callout-caution callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Caution
</div>
</div>
<div class="callout-body-container callout-body">
<p>This code is early and not the best. It will likely be improved over time. Check the respective repositories!</p>
</div>
</div>
<p>Most importantly for dkdc-io, the user interface is simple and useful. The details can change behind the abstraction.</p>


</section>

<a onclick="window.scrollTo(0, 0); return false;" id="quarto-back-to-top"><i class="bi bi-arrow-up"></i> Back to top</a> ]]></description>
  <category>python</category>
  <guid>https://dkdc.io/posts/fast-simple-state/</guid>
  <pubDate>Tue, 26 Nov 2024 00:00:00 GMT</pubDate>
</item>
<item>
  <title>fast, full-stack Python (uv &amp; Docker)</title>
  <dc:creator>Cody </dc:creator>
  <link>https://dkdc.io/posts/fast-simple-python/</link>
  <description><![CDATA[ 




<p><strong><em>Using uv and Docker to develop and deploy simple, scalable, full-stack Python applications.</em></strong></p>
<hr>
<p>In this post, we’ll look at my <a href="https://github.com/dkdc-io/dkdc/tree/main/Dockerfile">Dockerfile</a>:</p>
<pre><code># dkdc Dockerfile
FROM ghcr.io/astral-sh/uv:latest AS uv
FROM python:3.12-slim
# set the environment variables
ENV PATH=/root/.local/bin:$PATH
# set the working directory
WORKDIR /app
# copy the files
COPY readme.md /app/readme.md
COPY pyproject.toml /app/pyproject.toml
COPY src /app/src
# install the Python packages
RUN --mount=type=cache,target=/root/.cache/uv \
    --mount=from=uv,source=/uv,target=./uv \
    ./uv pip install '.' --system --upgrade</code></pre>
<p>I use it to develop simple, scalable, full-stack Python applications built with:</p>
<ul>
<li><a href="https://typer.tiangolo.com">Typer</a>: CLI</li>
<li><a href="https://github.com/ibis-project/ibis">Ibis</a>: table management and queries
<ul>
<li><a href="https://github.com/sqlite/sqlite">SQLite</a> and/or <a href="https://github.com/postgres/postgres">Postgres</a>: OLTP database</li>
<li><a href="https://github.com/duckdb/duckdb">DuckDB</a>: OLAP database (views on top of the OLTP tables)</li>
</ul></li>
<li><a href="https://github.com/posit-dev/py-shiny">Shiny for Python</a>: GUI
<ul>
<li><a href="https://github.com/plotly/plotly.py">Plotly</a>: plots</li>
</ul></li>
</ul>
<p>Then, deploy them with ease (and minimal build times) locally, on a Raspberry Pi, and on a cloud VM. Of course, other open source software and Python packages are used along the way (and you can use whatever you like!).</p>
<p>Some miscellaneous notes:</p>
<ul>
<li><strong>order</strong>: the Dockefile is ordered so that frequently changing parts are toward the bottom</li>
<li><strong>cache</strong>: the big point is the caching line, which I stole from somewhere (<a href="https://github.com/astral-sh/uv/issues/4385">here?</a>)</li>
<li><strong>pyproject.toml</strong>: the <code>pyproject.toml</code> is needed as it defines the installation of the package (and CLI)</li>
<li><strong>readme.md</strong>: the <code>readme.md</code> is needed because it’s referenced in the <code>pyproject.toml</code></li>
<li><strong>src</strong>: this is the source code, in something like <code>src/my_package</code></li>
<li><strong>pinning verions</strong>: in general I’m not pinning (or using a <code>uv</code> lockfile), but I would obviously recommend doing so for production workloads and having a process for updating dependencies</li>
<li><strong>system installation</strong>: we use system Python instead of creating a Python virtual environment (which uv makes easy) because we’re already in a virtual container (often itself in a virtual machine)</li>
</ul>
<p>Combining this with a few <code>justfile</code> commands makes development and deployment very easy. The simplicity of Python and tools that cover the full stack (CLI, database, GUI) make it a great choice for rapidly prototyping scalable applications.</p>



<a onclick="window.scrollTo(0, 0); return false;" id="quarto-back-to-top"><i class="bi bi-arrow-up"></i> Back to top</a> ]]></description>
  <category>python</category>
  <guid>https://dkdc.io/posts/fast-simple-python/</guid>
  <pubDate>Mon, 25 Nov 2024 00:00:00 GMT</pubDate>
</item>
<item>
  <title>launching ‘dkdc-io’</title>
  <dc:creator>Cody </dc:creator>
  <link>https://dkdc.io/posts/what-is-dkdc/</link>
  <description><![CDATA[ 




<p><strong><em>A decade-long journey back home.</em></strong></p>
<p>Nearly a decade ago, I started “DKDC LLC” not far from where I am today.</p>
<section id="why-dkdc" class="level2">
<h2 class="anchored" data-anchor-id="why-dkdc">why “DKDC”?</h2>
<p>I didn’t need to start a company, but I wanted to. I was working with a local company to prototype a device for testing in a hospital. Ostensibly a limited liability company (LLC) would limit my liability, but there was effectively no risk in my work. The real appeal was in learning the process and being able to say “I started a company”.</p>
<blockquote class="blockquote">
<p>“I started a company!”</p>
<p>“Oh yeah? What’s it called?”</p>
<p>“DKDC LLC.”</p>
<p>“What does DKDC stand for?”</p>
<p>“Don’t know, don’t care.”</p>
</blockquote>
</section>
<section id="branding" class="level2">
<h2 class="anchored" data-anchor-id="branding">branding</h2>
<p>My full name is relatively common and I found “dkdc” to be a useful, unique suffix for online accounts. It’s bland, neutral, and doesn’t really mean anything. It was a good fit a decade ago for a company that didn’t really do anything and it’s been a good fit since for my usernames and personal branding since.</p>
<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-1-contents" aria-controls="callout-1" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Warning
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-1" class="callout-1-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>“dkdc” is very difficult to understand over the phone.</p>
</div>
</div>
</div>
</section>
<section id="starting-dkdc-io" class="level2">
<h2 class="anchored" data-anchor-id="starting-dkdc-io">starting “dkdc-io”</h2>
<blockquote class="blockquote">
<p>“reincarnated”</p>
</blockquote>
<p>As of publishing this post, “dkdc-io” is nothing more than an idea and a GitHub organization with some nascent code. It’s intended as a bland, neutral, and unassuming home for useful code that can do things for me (and perhaps others). Software for me. A startup in a box. A decade of learnings?</p>


</section>

<a onclick="window.scrollTo(0, 0); return false;" id="quarto-back-to-top"><i class="bi bi-arrow-up"></i> Back to top</a> ]]></description>
  <category>dkdc-io</category>
  <guid>https://dkdc.io/posts/what-is-dkdc/</guid>
  <pubDate>Sun, 24 Nov 2024 00:00:00 GMT</pubDate>
  <media:content url="https://dkdc.io/logo.png" medium="image" type="image/png" height="144" width="144"/>
</item>
</channel>
</rss>

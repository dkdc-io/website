<?xml version="1.0" encoding="UTF-8"?>
<rss  xmlns:atom="http://www.w3.org/2005/Atom" 
      xmlns:media="http://search.yahoo.com/mrss/" 
      xmlns:content="http://purl.org/rss/1.0/modules/content/" 
      xmlns:dc="http://purl.org/dc/elements/1.1/" 
      version="2.0">
<channel>
<title>dkdc.io</title>
<link>https://dkdc.io/posts.html</link>
<atom:link href="https://dkdc.io/posts.xml" rel="self" type="application/rss+xml"/>
<description>Code by Cody</description>
<generator>quarto-1.6.39</generator>
<lastBuildDate>Wed, 27 Nov 2024 00:00:00 GMT</lastBuildDate>
<item>
  <title>Python + Rust: a simple tutorial</title>
  <dc:creator>Cody </dc:creator>
  <link>https://dkdc.io/posts/pawz/</link>
  <description><![CDATA[ 




<p><strong><em>A Python interface to core functionality written in Rust.</em></strong></p>
<div class="callout callout-style-default callout-important callout-titled" title="Rehomed from https://dkdc.dev">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Rehomed from https://dkdc.dev
</div>
</div>
<div class="callout-body-container callout-body">
<p>This post was originally published on April 28th, 2024 on <a href="https://dkdc.dev">dkdc.dev</a>. It has been rehomed here as potentially useful technical content.</p>
<p>This post was originally written in a rush and I don’t love it, but the setup might still be useful.</p>
</div>
</div>
<hr>
<p>This post is intended to provide a simple demonstration of a Python package that relies on core functionality written in Rust. You can <a href="https://github.com/lostmygithubaccount/pawz">view the source code on GitHub</a>.</p>
<section id="tools" class="level2">
<h2 class="anchored" data-anchor-id="tools">Tools</h2>
<p>In addition to Python and Rust, we’ll use the following tools:</p>
<ul>
<li><a href="https://github.com">GitHub</a>: repository hosting</li>
<li><a href="https://cli.github.com">GitHub CLI</a>: interact with GitHub from the command line</li>
<li><a href="https://github.com/casey/just">just</a>: a command runner</li>
<li><a href="https://github.com/jdx/mise">mise</a>: a tool for managing dev environments (Python/Rust versions)</li>
</ul>
<p>For generating and using Rust code in Python, we’ll use <a href="https://pyo3.rs/">PyO3</a>.</p>
</section>
<section id="setting-up-the-project" class="level2">
<h2 class="anchored" data-anchor-id="setting-up-the-project">Setting up the project</h2>
<p>We’ll start with an overview of the project setup.</p>
<section id="picking-a-name" class="level3">
<h3 class="anchored" data-anchor-id="picking-a-name">Picking a name</h3>
<p>We need a good name for our project. Ideally, this can match how the package on PyPI. I chose <code>pawz</code> because it was not taken, is short, and leans into what the demo package will do.</p>
</section>
<section id="layout" class="level3">
<h3 class="anchored" data-anchor-id="layout">Layout</h3>
<p>Let’s start by looking at the file tree for <code>pawz</code>:</p>
<div class="sourceCode" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb1-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">venv</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">cody@dkdc</span> pawz % tree</span>
<span id="cb1-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">./</span></span>
<span id="cb1-3"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">├──</span> LICENSE</span>
<span id="cb1-4"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">├──</span> dev-requirements.txt</span>
<span id="cb1-5"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">├──</span> justfile</span>
<span id="cb1-6"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">├──</span> pyproject.toml</span>
<span id="cb1-7"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">├──</span> readme.md</span>
<span id="cb1-8"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">└──</span> src/</span>
<span id="cb1-9">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">├──</span> pawz/</span>
<span id="cb1-10">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">│&nbsp;&nbsp;</span> └── __init__.py</span>
<span id="cb1-11">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">└──</span> pawz-core/</span>
<span id="cb1-12">        <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">├──</span> Cargo.toml</span>
<span id="cb1-13">        <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">├──</span> pyproject.toml</span>
<span id="cb1-14">        <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">├──</span> readme.md</span>
<span id="cb1-15">        <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">└──</span> src/</span>
<span id="cb1-16">            <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">├──</span> lib.rs</span>
<span id="cb1-17">            <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">└──</span> main.rs</span>
<span id="cb1-18"></span>
<span id="cb1-19"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">5</span> directories, 11 files</span></code></pre></div>
<p>This setup is copied over from a private project, then modified to update the project name and reduce code to its minimal form.</p>
</section>
<section id="justfile" class="level3">
<h3 class="anchored" data-anchor-id="justfile">Justfile</h3>
<p>We can look at the <code>justfile</code> – <code>just</code> is a command runner – to get a sense of the things we will be doing:</p>
<div class="sourceCode" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode txt code-with-copy"><code class="sourceCode default"><span id="cb2-1"># Justfile</span>
<span id="cb2-2"></span>
<span id="cb2-3"># load environment variables</span>
<span id="cb2-4">set dotenv-load</span>
<span id="cb2-5"></span>
<span id="cb2-6"># aliases</span>
<span id="cb2-7">alias fmt:=format</span>
<span id="cb2-8"></span>
<span id="cb2-9"># list justfile recipes</span>
<span id="cb2-10">default:</span>
<span id="cb2-11">    just --list</span>
<span id="cb2-12"></span>
<span id="cb2-13"># setup</span>
<span id="cb2-14">setup:</span>
<span id="cb2-15">    @pip install -r dev-requirements.txt</span>
<span id="cb2-16"></span>
<span id="cb2-17"># build</span>
<span id="cb2-18">build:</span>
<span id="cb2-19">    just clean</span>
<span id="cb2-20">    @python -m build src/pawz-core</span>
<span id="cb2-21">    @python -m build</span>
<span id="cb2-22"></span>
<span id="cb2-23"># format</span>
<span id="cb2-24">format:</span>
<span id="cb2-25">    @cargo fmt --manifest-path src/pawz-core/Cargo.toml</span>
<span id="cb2-26">    @ruff format .</span>
<span id="cb2-27"></span>
<span id="cb2-28"># install</span>
<span id="cb2-29">install:</span>
<span id="cb2-30">    @maturin dev -m src/pawz-core/Cargo.toml</span>
<span id="cb2-31">    @pip install --upgrade -e '.[all]'</span>
<span id="cb2-32"></span>
<span id="cb2-33"># uninstall</span>
<span id="cb2-34">uninstall:</span>
<span id="cb2-35">    @pip uninstall pawz pawz-core -y</span>
<span id="cb2-36"></span>
<span id="cb2-37"># release-test</span>
<span id="cb2-38">release-test:</span>
<span id="cb2-39">    just build</span>
<span id="cb2-40">    @twine upload --repository testpypi src/pawz-core/dist/* -u __token__ -p ${PYPI_TEST_TOKEN}</span>
<span id="cb2-41">    @twine upload --repository testpypi dist/* -u __token__ -p ${PYPI_TEST_TOKEN}</span>
<span id="cb2-42"></span>
<span id="cb2-43"># release</span>
<span id="cb2-44">release:</span>
<span id="cb2-45">    just build</span>
<span id="cb2-46">    @twine upload src/pawz-core/dist/* -u __token__ -p ${PYPI_TOKEN}</span>
<span id="cb2-47">    @twine upload dist/* -u __token__ -p ${PYPI_TOKEN}</span>
<span id="cb2-48"></span>
<span id="cb2-49"># clean</span>
<span id="cb2-50">clean:</span>
<span id="cb2-51">    @rm -r src/pawz-core/target || True</span>
<span id="cb2-52">    @rm -rf src/pawz-core/dist || True</span>
<span id="cb2-53">    @rm -rf dist || True</span></code></pre></div>
</section>
<section id="python-and-rust-sub-projects" class="level3">
<h3 class="anchored" data-anchor-id="python-and-rust-sub-projects">Python and Rust sub-projects</h3>
<p>You may have already noticed above we’re building and publishing two Python packages – <code>pawz</code> is a pure Python package that depends on <code>pawz-core</code>, a pure Rust package with Python bindings.</p>
<p>You can see the package definitions in the respective <code>pyproject.toml</code>s:</p>
<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Important
</div>
</div>
<div class="callout-body-container callout-body">
<p>Due to the website’s exquisite theme, you may not be able to tell that below are two separate tabs.</p>
<p>(this is no longer true after rehoming the post, but I’ll leave it in for posterity)</p>
</div>
</div>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs"><li class="nav-item"><a class="nav-link active" id="tabset-1-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-1" aria-controls="tabset-1-1" aria-selected="true"><code>pawz</code>: pure Python</a></li><li class="nav-item"><a class="nav-link" id="tabset-1-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-2" aria-controls="tabset-1-2" aria-selected="false"><code>pawz-core</code>: pure Rust with Python bindings</a></li></ul>
<div class="tab-content">
<div id="tabset-1-1" class="tab-pane active" aria-labelledby="tabset-1-1-tab">
<div class="sourceCode" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode toml code-with-copy"><code class="sourceCode toml"><span id="cb3-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">[build-system]</span></span>
<span id="cb3-2"><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">requires</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">[</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"hatchling"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">]</span></span>
<span id="cb3-3"><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">build-backend</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"hatchling.build"</span></span>
<span id="cb3-4"></span>
<span id="cb3-5"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">[project]</span></span>
<span id="cb3-6"><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">name</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"pawz"</span></span>
<span id="cb3-7"><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">version</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"0.1.0"</span></span>
<span id="cb3-8"><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">authors</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">[{ </span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">name</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"> =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Cody"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">, </span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">email</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"> =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"cody@dkdc.dev"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"> }]</span></span>
<span id="cb3-9"><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">description</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"a demo of Python + Rust"</span></span>
<span id="cb3-10"><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">readme</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"readme.md"</span></span>
<span id="cb3-11"><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">requires-python</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"&gt;=3.11"</span></span>
<span id="cb3-12"><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">classifiers</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">[</span></span>
<span id="cb3-13">  <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Programming Language :: Python :: 3"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb3-14">  <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"License :: OSI Approved :: MIT License"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb3-15">  <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Operating System :: OS Independent"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb3-16"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">]</span></span>
<span id="cb3-17"><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">dependencies</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">[</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"pawz_core"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">]</span></span>
<span id="cb3-18"></span>
<span id="cb3-19"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">[project.urls]</span></span>
<span id="cb3-20"><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"Homepage"</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"https://github.com/lostmygithubaccount/pawz"</span></span>
<span id="cb3-21"><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"Bug Tracker"</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"https://github.com/lostmygithubaccount/pawz/issues"</span></span></code></pre></div>
</div>
<div id="tabset-1-2" class="tab-pane" aria-labelledby="tabset-1-2-tab">
<div class="sourceCode" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode toml code-with-copy"><code class="sourceCode toml"><span id="cb4-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">[build-system]</span></span>
<span id="cb4-2"><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">requires</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">[</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"maturin&gt;=1.5,&lt;2.0"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">]</span></span>
<span id="cb4-3"><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">build-backend</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"maturin"</span></span>
<span id="cb4-4"></span>
<span id="cb4-5"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">[project]</span></span>
<span id="cb4-6"><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">name</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"pawz_core"</span></span>
<span id="cb4-7"><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">dynamic</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">[</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"version"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">]</span></span>
<span id="cb4-8"><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">authors</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">[{ </span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">name</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"> =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Cody"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">, </span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">email</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"> =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"cody@dkdc.dev"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"> }]</span></span>
<span id="cb4-9"><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">description</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"pawz core functionality (Rust!)"</span></span>
<span id="cb4-10"><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">readme</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"readme.md"</span></span>
<span id="cb4-11"><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">requires-python</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"&gt;=3.11"</span></span>
<span id="cb4-12"><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">classifiers</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">[</span></span>
<span id="cb4-13">  <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Programming Language :: Python :: 3"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb4-14">  <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"License :: OSI Approved :: MIT License"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb4-15">  <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Operating System :: OS Independent"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb4-16"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">]</span></span>
<span id="cb4-17"><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">dependencies</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">[]</span></span>
<span id="cb4-18"></span>
<span id="cb4-19"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">[tool.maturin]</span></span>
<span id="cb4-20"><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">features</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">[</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"pyo3/extension-module"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">]</span></span>
<span id="cb4-21"></span>
<span id="cb4-22"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">[project.urls]</span></span>
<span id="cb4-23"><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"Homepage"</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"https://github.com/lostmygithubaccount/pawz"</span></span>
<span id="cb4-24"><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"Bug Tracker"</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"https://github.com/lostmygithubaccount/pawz/issues"</span></span></code></pre></div>
</div>
</div>
</div>
<p>You’ll notice the primary difference is the build tooling – <code>hatchling</code> for the pure-Python project versus <code>maturin</code> for the Rust project.</p>
<p>With <code>pawz-core</code>, the package version is specified in the <code>Cargo.toml</code> instead of the <code>pyproject.toml</code> – we’ll take a closer look at that later.</p>
</section>
<section id="pawz" class="level3">
<h3 class="anchored" data-anchor-id="pawz"><code>pawz</code></h3>
<p>Let’s setup our Python package <code>pawz</code> – to start, all you need is an <code>__init__.py</code> file in the correct subdirectory:</p>
<div class="sourceCode" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># imports</span></span>
<span id="cb5-2"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> pawz_core <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> pc</span>
<span id="cb5-3"></span>
<span id="cb5-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># exports</span></span>
<span id="cb5-5">__all__ <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> [<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"pc"</span>]</span></code></pre></div>
<p>All we’re doing at this point is making <code>pawz_core</code> available as a module from <code>pawz</code>. So, we can do something like:</p>
<div class="sourceCode" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> pawz <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> pz</span>
<span id="cb6-2"></span>
<span id="cb6-3">pz.pc.open_pawz()</span></code></pre></div>
<p>Where the <code>open_pawz()</code> method is defined in <code>pawz_core</code>. We haven’t done that yet, but will later.</p>
</section>
<section id="pawz-core" class="level3">
<h3 class="anchored" data-anchor-id="pawz-core"><code>pawz-core</code></h3>
<p>In addition to the <code>pyproject.toml</code> above, we need a <code>Cargo.toml</code> to define the Rust project:</p>
<div class="sourceCode" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode toml code-with-copy"><code class="sourceCode toml"><span id="cb7-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">[package]</span></span>
<span id="cb7-2"><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">name</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"pawz_core"</span></span>
<span id="cb7-3"><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">version</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"0.1.0"</span></span>
<span id="cb7-4"><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">edition</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"2021"</span></span>
<span id="cb7-5"></span>
<span id="cb7-6"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">[lib]</span></span>
<span id="cb7-7"><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">name</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"pawz_core"</span></span>
<span id="cb7-8"><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">crate-type</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">[</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"cdylib"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">]</span></span>
<span id="cb7-9"></span>
<span id="cb7-10"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">[dependencies]</span></span>
<span id="cb7-11"><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">pyo3</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"0.21.1"</span></span></code></pre></div>
<p>Notice the Python package’s version will match the version defined here.</p>
<p>We also need the <code>lib.rs</code> in the <code>src/</code> directory defining the functionality and exposing it through the Python bindings:</p>
<div class="sourceCode" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode rust code-with-copy"><code class="sourceCode rust"><span id="cb8-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">use</span> <span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">pyo3::prelude::</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*;</span></span>
<span id="cb8-2"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">//use pyo3::exceptions::PyValueError;</span></span>
<span id="cb8-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">//use pyo3::types::PyTuple;</span></span>
<span id="cb8-4"></span>
<span id="cb8-5"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/// A Python module implemented in Rust.</span></span>
<span id="cb8-6"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">#[</span>pymodule<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">]</span></span>
<span id="cb8-7"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">#[</span>allow<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">(</span>deprecated<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">)]</span></span>
<span id="cb8-8"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">fn</span> pawz_core(_py<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> Python<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> _m<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&amp;</span>PyModule) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span> PyResult<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>()<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb8-9">    <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">Ok</span>(())</span>
<span id="cb8-10"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span></code></pre></div>
<p>Notice there’s nothing defined yet and a few things are commented out and prepended with an underscore to avoid the compiler complaining. However at this point, everything is fully functional – you can build <code>pawz-core</code> and <code>pawz</code> and import them.</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-3-contents" aria-controls="callout-3" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
What about the <code>main.rs</code>?
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-3" class="callout-3-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>As of writing, the <code>main.rs</code> is a simple hello world:</p>
<div class="sourceCode" id="cb9" style="background: #f1f3f5;"><pre class="sourceCode rust code-with-copy"><code class="sourceCode rust"><span id="cb9-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">fn</span> main() <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb9-2">    <span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">println!</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Hello, world!"</span>)<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb9-3"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span></code></pre></div>
<p>You don’t need the file, but I find it useful to easily try things out in Rust. For instance, you can import things from <code>lib.rs</code> and run them.</p>
</div>
</div>
</div>
</section>
</section>
<section id="setup-the-python-environment" class="level2">
<h2 class="anchored" data-anchor-id="setup-the-python-environment">Setup the Python environment</h2>
<p>Let’s take a look at the <code>dev-requirements.txt</code>:</p>
<div class="sourceCode" id="cb10" style="background: #f1f3f5;"><pre class="sourceCode txt code-with-copy"><code class="sourceCode default"><span id="cb10-1"># python</span>
<span id="cb10-2">ruff</span>
<span id="cb10-3">build</span>
<span id="cb10-4">twine</span>
<span id="cb10-5"></span>
<span id="cb10-6"># rust</span>
<span id="cb10-7">maturin</span></code></pre></div>
<p><code>ruff</code> is to format Python code, <code>build</code> is to build the Python packages, <code>twine</code> is to upload them to PyPI, and <code>maturin</code> is to build the Rust package with Python bindings. You can see the use of these tools above in the <code>justfile</code>.</p>
<section id="setup-a-virtual-python-environment" class="level3">
<h3 class="anchored" data-anchor-id="setup-a-virtual-python-environment">Setup a virtual Python environment</h3>
<p>You should generally use one virtual environment per project. I use <code>mise</code> to manage Python (and Rust) versions, but you don’t have to. You can run:</p>
<div class="sourceCode" id="cb11" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb11-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">venv</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">cody@dkdc</span> pawz % python <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-m</span> venv venv</span>
<span id="cb11-2"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">venv</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">cody@dkdc</span> pawz % source venv/bin/activate</span></code></pre></div>
<p>to create your virtual environment. At this point if you’ve installed <code>just</code>, you can run:</p>
<div class="sourceCode" id="cb12" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb12-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">venv</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">cody@dkdc</span> pawz % just setup</span></code></pre></div>
<p>This will install the dev dependencies defined above.</p>
</section>
<section id="installing-pawz-and-pawz-core" class="level3">
<h3 class="anchored" data-anchor-id="installing-pawz-and-pawz-core">Installing <code>pawz</code> and <code>pawz-core</code></h3>
<p>You can install <code>pawz</code> and <code>pawz-core</code> in local developer mode with:</p>
<div class="sourceCode" id="cb13" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb13-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">venv</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">cody@dkdc</span> pawz % just install</span></code></pre></div>
<p>Now you’re able to <code>import pawz as pz</code>!</p>
</section>
</section>
<section id="uploading-to-github" class="level2">
<h2 class="anchored" data-anchor-id="uploading-to-github">Uploading to GitHub</h2>
<p>There are multiple ways to do this, but I prefer something like:</p>
<div class="sourceCode" id="cb14" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb14-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">venv</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">cody@dkdc</span> pawz % git init</span>
<span id="cb14-2"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">venv</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">cody@dkdc</span> pawz % gh repo create pawz <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--public</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--source</span> .</span>
<span id="cb14-3"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">venv</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">cody@dkdc</span> pawz % git checkout <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-b</span> main</span>
<span id="cb14-4"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">venv</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">cody@dkdc</span> pawz % git add .</span>
<span id="cb14-5"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">venv</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">cody@dkdc</span> pawz % git commit <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-m</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"initial commit"</span></span>
<span id="cb14-6"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">venv</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">cody@dkdc</span> pawz % git push <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--set-upstream</span> origin/main</span></code></pre></div>
<p>Now, your code should be up on GitHub!</p>
</section>
<section id="publishing-to-pypi" class="level2">
<h2 class="anchored" data-anchor-id="publishing-to-pypi">Publishing to PyPI</h2>
<p>Let’s publish <code>pawz</code> and <code>pawz-core</code> to PyPI. First, you need to generate and place PyPI tokens in a <code>.env</code> file:</p>
<div class="sourceCode" id="cb15" style="background: #f1f3f5;"><pre class="sourceCode txt code-with-copy"><code class="sourceCode default"><span id="cb15-1">PYPI_TOKEN = "pypi-XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX"</span>
<span id="cb15-2">PYPI_TEST_TOKEN = "pypi-XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX"</span></code></pre></div>
<p>Then run:</p>
<div class="sourceCode" id="cb16" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb16-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">venv</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">cody@dkdc</span> pawz % just release-test</span>
<span id="cb16-2"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">venv</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">cody@dkdc</span> pawz % just release</span></code></pre></div>
</section>
<section id="doing-something" class="level2">
<h2 class="anchored" data-anchor-id="doing-something">Doing something</h2>
<p>Now, let’s do something! We’ll write some core functionality in Rust. For this demonstration, we’ll just open up a hardcoded URL pointing to a YouTube video.</p>
<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Important
</div>
</div>
<div class="callout-body-container callout-body">
<p>In the <code>pyproject.toml</code> and <code>Cargo.toml</code> we should bump the version up so we can ship a new version later.</p>
</div>
</div>
</section>
<section id="rust-edits" class="level2">
<h2 class="anchored" data-anchor-id="rust-edits">Rust edits</h2>
<p>We need to add the <code>open</code> crate dependency in the <code>Cargo.toml</code>:</p>
<div class="sourceCode" id="cb17" style="background: #f1f3f5;"><pre class="sourceCode toml code-with-copy"><code class="sourceCode toml"><span id="cb17-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">[package]</span></span>
<span id="cb17-2"><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">name</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"pawz_core"</span></span>
<span id="cb17-3"><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">version</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"0.2.0"</span></span>
<span id="cb17-4"><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">edition</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"2021"</span></span>
<span id="cb17-5"></span>
<span id="cb17-6"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">[lib]</span></span>
<span id="cb17-7"><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">name</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"pawz_core"</span></span>
<span id="cb17-8"><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">crate-type</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">[</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"cdylib"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">]</span></span>
<span id="cb17-9"></span>
<span id="cb17-10"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">[dependencies]</span></span>
<span id="cb17-11"><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">pyo3</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"0.21.1"</span></span>
<span id="cb17-12"><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">open</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"5.1.2"</span></span></code></pre></div>
<p>Then edit <code>lib.rs</code> to create our function and add it to the Python module:</p>
<div class="sourceCode" id="cb18" style="background: #f1f3f5;"><pre class="sourceCode rust code-with-copy"><code class="sourceCode rust"><span id="cb18-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">use</span> open<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb18-2"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">use</span> <span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">pyo3::prelude::</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*;</span></span>
<span id="cb18-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">//use pyo3::exceptions::PyValueError;</span></span>
<span id="cb18-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">//use pyo3::types::PyTuple;</span></span>
<span id="cb18-5"></span>
<span id="cb18-6"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">#[</span>pyfunction<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">]</span></span>
<span id="cb18-7"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">fn</span> open_pawz() <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb18-8">    <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">let</span> url <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"https://www.youtube.com/watch?v=gJ6slhwPp6E"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb18-9">    <span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">open::</span>that(url)<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>unwrap()<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb18-10"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb18-11"></span>
<span id="cb18-12"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/// A Python module implemented in Rust.</span></span>
<span id="cb18-13"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">#[</span>pymodule<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">]</span></span>
<span id="cb18-14"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">#[</span>allow<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">(</span>deprecated<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">)]</span></span>
<span id="cb18-15"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">fn</span> pawz_core(_py<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> Python<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> m<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&amp;</span>PyModule) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span> PyResult<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>()<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb18-16">    m<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>add_function(<span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">wrap_pyfunction!</span>(open_pawz<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> m)<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">?</span>)<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">?;</span></span>
<span id="cb18-17">    <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">Ok</span>(())</span>
<span id="cb18-18"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span></code></pre></div>
<p>Now if you <code>import pawz_core</code>, you can run <code>pawz_core.open_pawz()</code> from Python!</p>
<section id="python-edits" class="level3">
<h3 class="anchored" data-anchor-id="python-edits">Python edits</h3>
<p>No edits to Python are needed – since <code>pawz_core</code> is available from <code>pawz</code>, we can just call <code>pawz.pawz_core.open_pawz()</code>. You might want something different, i.e.&nbsp;to abstract away the core library code, but this is fine for demonstration purposes.</p>
</section>
<section id="git-workflow" class="level3">
<h3 class="anchored" data-anchor-id="git-workflow">Git workflow</h3>
<p>First, we’ll check what we changed:</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>I changed a bit more when I actually did this, reflected in some of the output below.</p>
</div>
</div>
<div class="sourceCode" id="cb19" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb19-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">venv</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">cody@dkdc</span> pawz % git status</span>
<span id="cb19-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">On</span> branch main</span>
<span id="cb19-3"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Your</span> branch is up to date with <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'origin/main'</span>.</span>
<span id="cb19-4"></span>
<span id="cb19-5"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Changes</span> not staged for commit:</span>
<span id="cb19-6">  <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">use</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"git add &lt;file&gt;..."</span> to update what will be committed<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span></span>
<span id="cb19-7">  <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">use</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"git restore &lt;file&gt;..."</span> to discard changes in working directory<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span></span>
<span id="cb19-8">        <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">modified:</span>   pyproject.toml</span>
<span id="cb19-9">        <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">modified:</span>   src/pawz-core/Cargo.toml</span>
<span id="cb19-10">        <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">modified:</span>   src/pawz-core/src/lib.rs</span>
<span id="cb19-11">        <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">modified:</span>   src/pawz/__init__.py</span>
<span id="cb19-12"></span>
<span id="cb19-13"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">no</span> changes added to commit <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">use</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"git add"</span> and/or <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"git commit -a"</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span></span></code></pre></div>
<p>Checkout a branch to commit our changes to:</p>
<div class="sourceCode" id="cb20" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb20-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">venv</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">cody@dkdc</span> pawz % git checkout <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-b</span> add-something</span>
<span id="cb20-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Switched</span> to a new branch <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'add-something'</span></span></code></pre></div>
<p>Ensure we format our code (Rust and Python):</p>
<div class="sourceCode" id="cb21" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb21-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">venv</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">cody@dkdc</span> pawz % just fmt</span>
<span id="cb21-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">1</span> file left unchanged</span></code></pre></div>
<p>Add our changes and commit them:</p>
<div class="sourceCode" id="cb22" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb22-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">venv</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">cody@dkdc</span> pawz % git add .</span>
<span id="cb22-2"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">venv</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">cody@dkdc</span> pawz % git commit <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-m</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"add something"</span></span>
<span id="cb22-3"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[add-something</span> 3e8727d] add something</span>
<span id="cb22-4"> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">4</span> files changed, 17 insertions<span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">+</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">,</span> 5 deletions<span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">-</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span></span></code></pre></div>
<p>Then create a PR on GitHub:</p>
<div class="sourceCode" id="cb23" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb23-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">venv</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">cody@dkdc</span> pawz % gh pr create</span>
<span id="cb23-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">?</span> Where should we push the <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'add-something'</span> branch<span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">?</span> lostmygithubaccount/pawz</span>
<span id="cb23-3"></span>
<span id="cb23-4"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Creating</span> pull request for add-something into main in lostmygithubaccount/pawz</span>
<span id="cb23-5"></span>
<span id="cb23-6"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">?</span> Title add something</span>
<span id="cb23-7"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">?</span> Body <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>Received<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span></span>
<span id="cb23-8"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">?</span> What<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'s next? Submit</span></span>
<span id="cb23-9"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">remote:</span></span>
<span id="cb23-10"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">remote:</span></span>
<span id="cb23-11"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">To https://github.com/lostmygithubaccount/pawz.git</span></span>
<span id="cb23-12"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;"> * [new branch]      HEAD -&gt; add-something</span></span>
<span id="cb23-13"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">branch '</span>add-something<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">' set up to track '</span>origin/add-something<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'.</span></span>
<span id="cb23-14"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">https://github.com/lostmygithubaccount/pawz/pull/1</span></span></code></pre></div>
<p>And finally, merge the PR from the CLI:</p>
<div class="sourceCode" id="cb24" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb24-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">venv</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">cody@dkdc</span> pawz % gh pr merge</span>
<span id="cb24-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Merging</span> pull request lostmygithubaccount/pawz#1 <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">add</span> something<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span></span>
<span id="cb24-3"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">?</span> What merge method would you like to use<span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">?</span> Squash and merge</span>
<span id="cb24-4"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">?</span> Delete the branch locally and on GitHub<span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">?</span> Yes</span>
<span id="cb24-5"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">?</span> What<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'s next? Submit</span></span>
<span id="cb24-6"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">✓ Squashed and merged pull request lostmygithubaccount/pawz#1 (add something)</span></span>
<span id="cb24-7"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">remote: Enumerating objects: 19, done.</span></span>
<span id="cb24-8"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">remote: Counting objects: 100% (19/19), done.</span></span>
<span id="cb24-9"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">remote: Compressing objects: 100% (6/6), done.</span></span>
<span id="cb24-10"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">remote: Total 10 (delta 3), reused 9 (delta 3), pack-reused 0</span></span>
<span id="cb24-11"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">Unpacking objects: 100% (10/10), 1.72 KiB | 586.00 KiB/s, done.</span></span>
<span id="cb24-12"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">From https://github.com/lostmygithubaccount/pawz</span></span>
<span id="cb24-13"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;"> * branch            main       -&gt; FETCH_HEAD</span></span>
<span id="cb24-14"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">   a866fd3..318bd89  main       -&gt; origin/main</span></span>
<span id="cb24-15"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">Updating a866fd3..318bd89</span></span>
<span id="cb24-16"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">Fast-forward</span></span>
<span id="cb24-17"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;"> pyproject.toml           |  2 +-</span></span>
<span id="cb24-18"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;"> src/pawz-core/Cargo.toml |  3 ++-</span></span>
<span id="cb24-19"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;"> src/pawz-core/src/lib.rs | 10 +++++++++-</span></span>
<span id="cb24-20"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;"> src/pawz/__init__.py     |  7 +++++--</span></span>
<span id="cb24-21"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;"> 4 files changed, 17 insertions(+), 5 deletions(-)</span></span>
<span id="cb24-22"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">✓ Deleted local branch add-something and switched to branch main</span></span>
<span id="cb24-23"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">✓ Deleted remote branch add-something</span></span></code></pre></div>
<p>Now our source code is updated. You can <a href="https://github.com/lostmygithubaccount/pawz/pull/1">view this PR here, including the files changed</a>.</p>
</section>
</section>
<section id="updating-on-pypi" class="level2">
<h2 class="anchored" data-anchor-id="updating-on-pypi">Updating on PyPI</h2>
<p>With our code updated, we want to update our packages on PyPI. We simply run:</p>
<div class="sourceCode" id="cb25" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb25-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">venv</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">cody@dkdc</span> pawz % just release</span></code></pre></div>
<p>as before, shipping the new version that does something!</p>
</section>
<section id="conclusion" class="level2">
<h2 class="anchored" data-anchor-id="conclusion">Conclusion</h2>
<p>I hope this is helpful to someone setting up a Python package with core functionality written in Rust. Of course, there are many ways to do this but I find the above fairly clean.</p>


</section>

<a onclick="window.scrollTo(0, 0); return false;" id="quarto-back-to-top"><i class="bi bi-arrow-up"></i> Back to top</a> ]]></description>
  <category>python</category>
  <category>rust</category>
  <guid>https://dkdc.io/posts/pawz/</guid>
  <pubDate>Wed, 27 Nov 2024 00:00:00 GMT</pubDate>
  <media:content url="https://dkdc.io/posts/pawz/thumbnail.png" medium="image" type="image/png" height="130" width="144"/>
</item>
<item>
  <title>fast, simple, persistent state management with Python (Ibis)</title>
  <dc:creator>Cody </dc:creator>
  <link>https://dkdc.io/posts/fast-simple-state/</link>
  <description><![CDATA[ 




<p><strong><em>Using SQLite and DuckDB (via Ibis) to manage perisistent state in Python.</em></strong></p>
<section id="dkdc-state" class="level2">
<h2 class="anchored" data-anchor-id="dkdc-state">dkdc-state</h2>
<p>In this post, we’ll look at the what and why of <a href="https://github.com/dkdc-io/dkdc-state">dkdc-state</a>:</p>
<div id="459acbb8" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> dkdc_state <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> State, ibis</span>
<span id="cb1-2"></span>
<span id="cb1-3">ibis.options.interactive <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span></span>
<span id="cb1-4"></span>
<span id="cb1-5">state <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> State()</span>
<span id="cb1-6">state._clear() <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># for demonstration purposes, clear all tables</span></span>
<span id="cb1-7">state</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>&lt;dkdc_state.main.State at 0x114ca6ff0&gt;</code></pre>
</div>
</div>
<p>The State class itself isn’t very interesting, but we extend it to implement a number of other stateful Python libraries. Looking at the source code:</p>
<div id="2d5bdaf4" class="cell" data-execution_count="2">
<details class="code-fold">
<summary>State class code code</summary>
<div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> website.utils <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> get_class_source</span>
<span id="cb3-2"></span>
<span id="cb3-3">get_class_source(State)</span></code></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="2">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace"><span style="background-color: #272822">                                                                                                                   
 </span><span style="color: #66d9ef; text-decoration-color: #66d9ef; background-color: #272822">class</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> </span><span style="color: #a6e22e; text-decoration-color: #a6e22e; background-color: #272822">State</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">:</span><span style="background-color: #272822">                                                                                                      </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">    </span><span style="color: #959077; text-decoration-color: #959077; background-color: #272822"># initialization</span><span style="background-color: #272822">                                                                                              </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">    </span><span style="color: #66d9ef; text-decoration-color: #66d9ef; background-color: #272822">def</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> </span><span style="color: #a6e22e; text-decoration-color: #a6e22e; background-color: #272822">__init__</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">(self, dbpath: str </span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">=</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> </span><span style="color: #e6db74; text-decoration-color: #e6db74; background-color: #272822">"data.db"</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">):</span><span style="background-color: #272822">                                                                  </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">        self</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">.</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">dbpath </span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">=</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> dbpath</span><span style="background-color: #272822">                                                                                      </span>
<span style="background-color: #272822">                                                                                                                   </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">        self</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">.</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">wcon, self</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">.</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">rcon </span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">=</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> self</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">.</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">_cons()</span><span style="background-color: #272822">                                                                       </span>
<span style="background-color: #272822">                                                                                                                   </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">    </span><span style="color: #959077; text-decoration-color: #959077; background-color: #272822"># reference implementation -- to be overridden</span><span style="background-color: #272822">                                                                </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">    </span><span style="color: #66d9ef; text-decoration-color: #66d9ef; background-color: #272822">def</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> </span><span style="color: #a6e22e; text-decoration-color: #a6e22e; background-color: #272822">_cons</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">(self) </span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">-&gt;</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> (ibis</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">.</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">BaseBackend, ibis</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">.</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">BaseBackend):</span><span style="background-color: #272822">                                                      </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">        </span><span style="color: #959077; text-decoration-color: #959077; background-color: #272822"># create write connection</span><span style="background-color: #272822">                                                                                 </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">        wcon </span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">=</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> ibis</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">.</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">sqlite</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">.</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">connect(self</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">.</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">dbpath)</span><span style="background-color: #272822">                                                                   </span>
<span style="background-color: #272822">                                                                                                                   </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">        </span><span style="color: #959077; text-decoration-color: #959077; background-color: #272822"># create tables in write connection</span><span style="background-color: #272822">                                                                       </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">        </span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">...</span><span style="background-color: #272822">                                                                                                       </span>
<span style="background-color: #272822">                                                                                                                   </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">        </span><span style="color: #959077; text-decoration-color: #959077; background-color: #272822"># create read connection</span><span style="background-color: #272822">                                                                                  </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">        rcon </span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">=</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> ibis</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">.</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">duckdb</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">.</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">connect()</span><span style="background-color: #272822">                                                                              </span>
<span style="background-color: #272822">                                                                                                                   </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">        </span><span style="color: #959077; text-decoration-color: #959077; background-color: #272822"># create tables in read connection</span><span style="background-color: #272822">                                                                        </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">        </span><span style="color: #66d9ef; text-decoration-color: #66d9ef; background-color: #272822">for</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> table_name </span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">in</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> wcon</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">.</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">list_tables():</span><span style="background-color: #272822">                                                                     </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">            rcon</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">.</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">read_sqlite(self</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">.</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">dbpath, table_name</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">=</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">table_name)</span><span style="background-color: #272822">                                                  </span>
<span style="background-color: #272822">                                                                                                                   </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">        </span><span style="color: #959077; text-decoration-color: #959077; background-color: #272822"># return connections</span><span style="background-color: #272822">                                                                                      </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">        </span><span style="color: #66d9ef; text-decoration-color: #66d9ef; background-color: #272822">return</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> wcon, rcon</span><span style="background-color: #272822">                                                                                         </span>
<span style="background-color: #272822">                                                                                                                   </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">    </span><span style="color: #66d9ef; text-decoration-color: #66d9ef; background-color: #272822">def</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> </span><span style="color: #a6e22e; text-decoration-color: #a6e22e; background-color: #272822">_clear</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">(self, table_names: str </span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">|</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> list[str] </span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">=</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> </span><span style="color: #66d9ef; text-decoration-color: #66d9ef; background-color: #272822">None</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">):</span><span style="background-color: #272822">                                                        </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">        </span><span style="color: #959077; text-decoration-color: #959077; background-color: #272822"># if table_names is None, clear all tables</span><span style="background-color: #272822">                                                                </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">        table_names </span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">=</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> self</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">.</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">wcon</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">.</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">list_tables() </span><span style="color: #66d9ef; text-decoration-color: #66d9ef; background-color: #272822">if</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> table_names </span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">is</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> </span><span style="color: #66d9ef; text-decoration-color: #66d9ef; background-color: #272822">None</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> </span><span style="color: #66d9ef; text-decoration-color: #66d9ef; background-color: #272822">else</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> table_names</span><span style="background-color: #272822">                             </span>
<span style="background-color: #272822">                                                                                                                   </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">        </span><span style="color: #959077; text-decoration-color: #959077; background-color: #272822"># if table_names is a string, convert to a list</span><span style="background-color: #272822">                                                           </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">        </span><span style="color: #66d9ef; text-decoration-color: #66d9ef; background-color: #272822">if</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> isinstance(table_names, str):</span><span style="background-color: #272822">                                                                          </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">            table_names </span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">=</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> [table_names]</span><span style="background-color: #272822">                                                                           </span>
<span style="background-color: #272822">                                                                                                                   </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">        </span><span style="color: #959077; text-decoration-color: #959077; background-color: #272822"># drop views and tables</span><span style="background-color: #272822">                                                                                   </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">        </span><span style="color: #66d9ef; text-decoration-color: #66d9ef; background-color: #272822">for</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> table_name </span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">in</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> table_names:</span><span style="background-color: #272822">                                                                            </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">            self</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">.</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">rcon</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">.</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">drop_view(table_name)</span><span style="background-color: #272822">                                                                       </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">            self</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">.</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">wcon</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">.</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">drop_table(table_name)</span><span style="background-color: #272822">                                                                      </span>
<span style="background-color: #272822">                                                                                                                   </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">        </span><span style="color: #959077; text-decoration-color: #959077; background-color: #272822"># reset connections (recreate tables)</span><span style="background-color: #272822">                                                                     </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">        self</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">.</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">wcon, self</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">.</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">rcon </span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">=</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> self</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">.</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">_cons()</span><span style="background-color: #272822">                                                                       </span>
<span style="background-color: #272822">                                                                                                                   
</span></pre>
</div>
</div>
<p>We define a <code>__init__</code> method that calls a <code>_cons</code> method that sets up a write connection (SQLite) and read connection (DuckDB) with Ibis. A standard <code>_clear</code> method is defined to drop the tables (and corresponding views). That’s it!</p>
<p>To create a fast, simple, persistent state management system we simply need to extend the State class, implement the table creation in the <code>_cons</code> method, and add methods to interact with the state.</p>
<section id="dkdc-todo" class="level3">
<h3 class="anchored" data-anchor-id="dkdc-todo">dkdc-todo</h3>
<p>Let’s look at <a href="https://github.com/dkdc-io/dkdc-todo">dkdc-todo</a> as an example:</p>
<div id="da2a6d31" class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> dkdc_todo <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> Todo</span>
<span id="cb4-2"></span>
<span id="cb4-3">todo <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> Todo(dbpath<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"data.db"</span>)</span>
<span id="cb4-4">todo</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="3">
<pre><code>&lt;dkdc_todo.main.Todo at 0x111911730&gt;</code></pre>
</div>
</div>
<p>We can view the table (and thus the schema):</p>
<div id="9ed5d6b5" class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1">todo.t()</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="4">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">┏━━━━━━━━━━━━━━┳━━━━━━━━┳━━━━━━━━━┳━━━━━━━━━┳━━━━━━━━┳━━━━━━━━━━┳━━━━━━━━┳━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃<span style="font-weight: bold"> idx          </span>┃<span style="font-weight: bold"> id     </span>┃<span style="font-weight: bold"> user_id </span>┃<span style="font-weight: bold"> subject </span>┃<span style="font-weight: bold"> body   </span>┃<span style="font-weight: bold"> priority </span>┃<span style="font-weight: bold"> status </span>┃<span style="font-weight: bold"> description </span>┃<span style="font-weight: bold"> labels        </span>┃
┡━━━━━━━━━━━━━━╇━━━━━━━━╇━━━━━━━━━╇━━━━━━━━━╇━━━━━━━━╇━━━━━━━━━━╇━━━━━━━━╇━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">timestamp(6)</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>  │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>  │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">int64</span>    │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>      │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">array&lt;string&gt;</span> │
└──────────────┴────────┴─────────┴─────────┴────────┴──────────┴────────┴─────────────┴───────────────┘
</pre>
</div>
</div>
<p>Then append items to the table:</p>
<div id="05426f32" class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1">todo.append_todo(<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">id</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"test"</span>, user_id<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">None</span>, subject<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">None</span>, body<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"do your homework"</span>)</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="5">
<pre><code>{'idx': datetime.datetime(2024, 11, 27, 18, 2, 45, 321529),
 'id': 'test',
 'user_id': None,
 'subject': None,
 'body': 'do your homework',
 'priority': 100,
 'status': None,
 'description': None,
 'labels': None}</code></pre>
</div>
</div>
<p>At this point we see our record:</p>
<div id="5db87a1b" class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb9" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1">todo.t()</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="6">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━┳━━━━━━━━━┳━━━━━━━━━┳━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━┳━━━━━━━━┳━━━━━━━━━━━━━┳━━━━━━━━┓
┃<span style="font-weight: bold"> idx                        </span>┃<span style="font-weight: bold"> id     </span>┃<span style="font-weight: bold"> user_id </span>┃<span style="font-weight: bold"> subject </span>┃<span style="font-weight: bold"> body             </span>┃<span style="font-weight: bold"> priority </span>┃<span style="font-weight: bold"> status </span>┃<span style="font-weight: bold"> description </span>┃<span style="font-weight: bold"> labels </span>┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━╇━━━━━━━━━╇━━━━━━━━━╇━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━╇━━━━━━━━╇━━━━━━━━━━━━━╇━━━━━━━━┩
│ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">timestamp(6)</span>               │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>  │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>  │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>           │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">int64</span>    │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>      │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">array…</span> │
├────────────────────────────┼────────┼─────────┼─────────┼──────────────────┼──────────┼────────┼─────────────┼────────┤
│ <span style="color: #800080; text-decoration-color: #800080">2024-11-27 18:02:45.321529</span> │ <span style="color: #008000; text-decoration-color: #008000">test  </span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">NULL</span>    │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">NULL</span>    │ <span style="color: #008000; text-decoration-color: #008000">do your homework</span> │      <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">100</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">NULL</span>   │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">NULL</span>        │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">NULL</span>   │
└────────────────────────────┴────────┴─────────┴─────────┴──────────────────┴──────────┴────────┴─────────────┴────────┘
</pre>
</div>
</div>
<p>Importantly, dkdc-state tables are intended to be append-only. Once <code>append_*</code> (confusingly named here) is called, you must use <code>update_*</code> to update the record (with the same id).</p>
<p>To demonstrate this, let’s update that record:</p>
<div id="72314236" class="cell" data-execution_count="7">
<div class="sourceCode cell-code" id="cb10" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1">todo.update_todo(<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">id</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"test"</span>, user_id<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">None</span>, subject<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">None</span>, body<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"do your homework!"</span>)</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="7">
<pre><code>{'idx': datetime.datetime(2024, 11, 27, 18, 2, 45, 373844),
 'id': 'test',
 'user_id': None,
 'subject': None,
 'body': 'do your homework!',
 'priority': 100,
 'status': None,
 'description': None,
 'labels': None}</code></pre>
</div>
</div>
<p>Then view our table:</p>
<div id="1921679f" class="cell" data-execution_count="8">
<div class="sourceCode cell-code" id="cb12" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1">todo.t()</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="8">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━┳━━━━━━━━━┳━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━┳━━━━━━━━┳━━━━━━━━━━━━━┳━━━━━━━━┓
┃<span style="font-weight: bold"> idx                        </span>┃<span style="font-weight: bold"> id     </span>┃<span style="font-weight: bold"> user_id </span>┃<span style="font-weight: bold"> subject </span>┃<span style="font-weight: bold"> body              </span>┃<span style="font-weight: bold"> priority </span>┃<span style="font-weight: bold"> status </span>┃<span style="font-weight: bold"> description </span>┃<span style="font-weight: bold"> labels </span>┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━╇━━━━━━━━━╇━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━╇━━━━━━━━╇━━━━━━━━━━━━━╇━━━━━━━━┩
│ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">timestamp(6)</span>               │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>  │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>  │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>            │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">int64</span>    │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>      │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">array…</span> │
├────────────────────────────┼────────┼─────────┼─────────┼───────────────────┼──────────┼────────┼─────────────┼────────┤
│ <span style="color: #800080; text-decoration-color: #800080">2024-11-27 18:02:45.373844</span> │ <span style="color: #008000; text-decoration-color: #008000">test  </span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">NULL</span>    │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">NULL</span>    │ <span style="color: #008000; text-decoration-color: #008000">do your homework!</span> │      <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">100</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">NULL</span>   │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">NULL</span>        │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">NULL</span>   │
└────────────────────────────┴────────┴─────────┴─────────┴───────────────────┴──────────┴────────┴─────────────┴────────┘
</pre>
</div>
</div>
<p>There’s only 1 row! The second rows is in there, the table code is just set to only show the latest version of each record.</p>
<p>Let’s look at the underlying table:</p>
<div id="3b426339" class="cell" data-execution_count="9">
<div class="sourceCode cell-code" id="cb13" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1">todo.wcon.table(todo.todos_table_name)</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="9">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━┳━━━━━━━━━┳━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━┳━━━━━━━━┳━━━━━━━━━━━━━┳━━━━━━━━┓
┃<span style="font-weight: bold"> idx                        </span>┃<span style="font-weight: bold"> id     </span>┃<span style="font-weight: bold"> user_id </span>┃<span style="font-weight: bold"> subject </span>┃<span style="font-weight: bold"> body              </span>┃<span style="font-weight: bold"> priority </span>┃<span style="font-weight: bold"> status </span>┃<span style="font-weight: bold"> description </span>┃<span style="font-weight: bold"> labels </span>┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━╇━━━━━━━━━╇━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━╇━━━━━━━━╇━━━━━━━━━━━━━╇━━━━━━━━┩
│ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">timestamp</span>                  │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>  │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>  │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>            │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">int64</span>    │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>      │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span> │
├────────────────────────────┼────────┼─────────┼─────────┼───────────────────┼──────────┼────────┼─────────────┼────────┤
│ <span style="color: #800080; text-decoration-color: #800080">2024-11-27 18:02:45.321529</span> │ <span style="color: #008000; text-decoration-color: #008000">test  </span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">NULL</span>    │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">NULL</span>    │ <span style="color: #008000; text-decoration-color: #008000">do your homework </span> │      <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">100</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">NULL</span>   │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">NULL</span>        │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">NULL</span>   │
│ <span style="color: #800080; text-decoration-color: #800080">2024-11-27 18:02:45.373844</span> │ <span style="color: #008000; text-decoration-color: #008000">test  </span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">NULL</span>    │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">NULL</span>    │ <span style="color: #008000; text-decoration-color: #008000">do your homework!</span> │      <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">100</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">NULL</span>   │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">NULL</span>        │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">NULL</span>   │
└────────────────────────────┴────────┴─────────┴─────────┴───────────────────┴──────────┴────────┴─────────────┴────────┘
</pre>
</div>
</div>
<p>And we see both rows. You can add other convenience methods to the state class as needed:</p>
<div id="6e6db271" class="cell" data-execution_count="10">
<div class="sourceCode cell-code" id="cb14" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1">todo.get_todo(<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">id</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"test"</span>)</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="10">
<pre><code>{'idx': datetime.datetime(2024, 11, 27, 18, 2, 45, 373844),
 'id': 'test',
 'user_id': None,
 'subject': None,
 'body': 'do your homework!',
 'priority': 100,
 'status': None,
 'description': None,
 'labels': None}</code></pre>
</div>
</div>
<p>Taking a look at the source code:</p>
<div id="fa7423fc" class="cell" data-execution_count="11">
<details class="code-fold">
<summary>Todo class code code</summary>
<div class="sourceCode cell-code" id="cb16" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1">get_class_source(Todo)</span></code></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="11">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace"><span style="background-color: #272822">                                                                                                                   
 </span><span style="color: #66d9ef; text-decoration-color: #66d9ef; background-color: #272822">class</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> </span><span style="color: #a6e22e; text-decoration-color: #a6e22e; background-color: #272822">Todo</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">(State):</span><span style="background-color: #272822">                                                                                                </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">    </span><span style="color: #66d9ef; text-decoration-color: #66d9ef; background-color: #272822">def</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> </span><span style="color: #a6e22e; text-decoration-color: #a6e22e; background-color: #272822">__init__</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">(self, dbpath: str </span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">=</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> </span><span style="color: #66d9ef; text-decoration-color: #66d9ef; background-color: #272822">None</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">):</span><span style="background-color: #272822">                                                                       </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">        </span><span style="color: #66d9ef; text-decoration-color: #66d9ef; background-color: #272822">if</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> dbpath </span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">is</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> </span><span style="color: #66d9ef; text-decoration-color: #66d9ef; background-color: #272822">None</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">:</span><span style="background-color: #272822">                                                                                        </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">            dbpath </span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">=</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> os</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">.</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">path</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">.</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">join(get_dkdc_dir(), </span><span style="color: #e6db74; text-decoration-color: #e6db74; background-color: #272822">"todo.db"</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">)</span><span style="background-color: #272822">                                                      </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">        super()</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">.</span><span style="color: #a6e22e; text-decoration-color: #a6e22e; background-color: #272822">__init__</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">(dbpath</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">=</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">dbpath)</span><span style="background-color: #272822">                                                                           </span>
<span style="background-color: #272822">                                                                                                                   </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">    </span><span style="color: #66d9ef; text-decoration-color: #66d9ef; background-color: #272822">def</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> </span><span style="color: #a6e22e; text-decoration-color: #a6e22e; background-color: #272822">_cons</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">(self) </span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">-&gt;</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> (ibis</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">.</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">BaseBackend, ibis</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">.</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">BaseBackend):</span><span style="background-color: #272822">                                                      </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">        </span><span style="color: #959077; text-decoration-color: #959077; background-color: #272822"># create write connection</span><span style="background-color: #272822">                                                                                 </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">        wcon </span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">=</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> ibis</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">.</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">sqlite</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">.</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">connect(self</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">.</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">dbpath)</span><span style="background-color: #272822">                                                                   </span>
<span style="background-color: #272822">                                                                                                                   </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">        </span><span style="color: #959077; text-decoration-color: #959077; background-color: #272822"># create tables in write connection</span><span style="background-color: #272822">                                                                       </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">        </span><span style="color: #959077; text-decoration-color: #959077; background-color: #272822">## todos data</span><span style="background-color: #272822">                                                                                             </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">        self</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">.</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">todos_table_name </span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">=</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> </span><span style="color: #e6db74; text-decoration-color: #e6db74; background-color: #272822">"todos"</span><span style="background-color: #272822">                                                                           </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">        schema </span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">=</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> ibis</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">.</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">schema(</span><span style="background-color: #272822">                                                                                     </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">            {</span><span style="background-color: #272822">                                                                                                     </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">                </span><span style="color: #e6db74; text-decoration-color: #e6db74; background-color: #272822">"idx"</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">: dt</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">.</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">timestamp,</span><span style="background-color: #272822">                                                                              </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">                </span><span style="color: #e6db74; text-decoration-color: #e6db74; background-color: #272822">"id"</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">: str,</span><span style="background-color: #272822">                                                                                        </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">                </span><span style="color: #e6db74; text-decoration-color: #e6db74; background-color: #272822">"user_id"</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">: str,</span><span style="background-color: #272822">                                                                                   </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">                </span><span style="color: #e6db74; text-decoration-color: #e6db74; background-color: #272822">"subject"</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">: str,</span><span style="background-color: #272822">                                                                                   </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">                </span><span style="color: #e6db74; text-decoration-color: #e6db74; background-color: #272822">"body"</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">: str,</span><span style="background-color: #272822">                                                                                      </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">                </span><span style="color: #e6db74; text-decoration-color: #e6db74; background-color: #272822">"priority"</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">: int,</span><span style="background-color: #272822">                                                                                  </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">                </span><span style="color: #e6db74; text-decoration-color: #e6db74; background-color: #272822">"status"</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">: str,</span><span style="background-color: #272822">                                                                                    </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">                </span><span style="color: #e6db74; text-decoration-color: #e6db74; background-color: #272822">"description"</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">: str,</span><span style="background-color: #272822">                                                                               </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">                </span><span style="color: #e6db74; text-decoration-color: #e6db74; background-color: #272822">"labels"</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">: str,  </span><span style="color: #959077; text-decoration-color: #959077; background-color: #272822"># comma-separated list of labels</span><span style="background-color: #272822">                                                  </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">            }</span><span style="background-color: #272822">                                                                                                     </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">        )</span><span style="background-color: #272822">                                                                                                         </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">        </span><span style="color: #66d9ef; text-decoration-color: #66d9ef; background-color: #272822">if</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> self</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">.</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">todos_table_name </span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">not</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> </span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">in</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> wcon</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">.</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">list_tables():</span><span style="background-color: #272822">                                                       </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">            wcon</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">.</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">create_table(self</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">.</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">todos_table_name, schema</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">=</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">schema)</span><span style="background-color: #272822">                                               </span>
<span style="background-color: #272822">                                                                                                                   </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">        </span><span style="color: #959077; text-decoration-color: #959077; background-color: #272822"># create read connection</span><span style="background-color: #272822">                                                                                  </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">        rcon </span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">=</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> ibis</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">.</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">duckdb</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">.</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">connect()</span><span style="background-color: #272822">                                                                              </span>
<span style="background-color: #272822">                                                                                                                   </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">        </span><span style="color: #959077; text-decoration-color: #959077; background-color: #272822"># create tables in read connection</span><span style="background-color: #272822">                                                                        </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">        </span><span style="color: #66d9ef; text-decoration-color: #66d9ef; background-color: #272822">for</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> table_name </span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">in</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> wcon</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">.</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">list_tables():</span><span style="background-color: #272822">                                                                     </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">            rcon</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">.</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">read_sqlite(self</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">.</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">dbpath, table_name</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">=</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">table_name)</span><span style="background-color: #272822">                                                  </span>
<span style="background-color: #272822">                                                                                                                   </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">        </span><span style="color: #66d9ef; text-decoration-color: #66d9ef; background-color: #272822">return</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> wcon, rcon</span><span style="background-color: #272822">                                                                                         </span>
<span style="background-color: #272822">                                                                                                                   </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">    </span><span style="color: #959077; text-decoration-color: #959077; background-color: #272822"># tables</span><span style="background-color: #272822">                                                                                                      </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">    </span><span style="color: #66d9ef; text-decoration-color: #66d9ef; background-color: #272822">def</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> </span><span style="color: #a6e22e; text-decoration-color: #a6e22e; background-color: #272822">todos_t</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">(self, user_id: str </span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">=</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> </span><span style="color: #66d9ef; text-decoration-color: #66d9ef; background-color: #272822">None</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">):</span><span style="background-color: #272822">                                                                       </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">        </span><span style="color: #959077; text-decoration-color: #959077; background-color: #272822"># get todos data</span><span style="background-color: #272822">                                                                                          </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">        t </span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">=</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> self</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">.</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">rcon</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">.</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">table(self</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">.</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">todos_table_name)</span><span style="background-color: #272822">                                                                </span>
<span style="background-color: #272822">                                                                                                                   </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">        </span><span style="color: #959077; text-decoration-color: #959077; background-color: #272822"># filter by user_id</span><span style="background-color: #272822">                                                                                       </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">        </span><span style="color: #66d9ef; text-decoration-color: #66d9ef; background-color: #272822">if</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> user_id:</span><span style="background-color: #272822">                                                                                               </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">            t </span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">=</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> t</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">.</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">filter(t[</span><span style="color: #e6db74; text-decoration-color: #e6db74; background-color: #272822">"user_id"</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">] </span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">==</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> user_id)</span><span style="background-color: #272822">                                                                 </span>
<span style="background-color: #272822">                                                                                                                   </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">        </span><span style="color: #959077; text-decoration-color: #959077; background-color: #272822"># get only the latest metadata</span><span style="background-color: #272822">                                                                            </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">        t </span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">=</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> (</span><span style="background-color: #272822">                                                                                                     </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">            t</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">.</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">mutate(</span><span style="background-color: #272822">                                                                                             </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">                rank</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">=</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">ibis</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">.</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">row_number()</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">.</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">over(</span><span style="background-color: #272822">                                                                      </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">                    ibis</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">.</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">window(</span><span style="background-color: #272822">                                                                                  </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">                        group_by</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">=</span><span style="color: #e6db74; text-decoration-color: #e6db74; background-color: #272822">"id"</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">,</span><span style="background-color: #272822">                                                                            </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">                        order_by</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">=</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">ibis</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">.</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">desc(</span><span style="color: #e6db74; text-decoration-color: #e6db74; background-color: #272822">"idx"</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">),</span><span style="background-color: #272822">                                                                </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">                    )</span><span style="background-color: #272822">                                                                                             </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">                )</span><span style="background-color: #272822">                                                                                                 </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">            )</span><span style="background-color: #272822">                                                                                                     </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">            </span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">.</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">filter(ibis</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">.</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">_[</span><span style="color: #e6db74; text-decoration-color: #e6db74; background-color: #272822">"rank"</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">] </span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">==</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> </span><span style="color: #ae81ff; text-decoration-color: #ae81ff; background-color: #272822">0</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">)</span><span style="background-color: #272822">                                                                          </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">            </span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">.</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">drop(</span><span style="color: #e6db74; text-decoration-color: #e6db74; background-color: #272822">"rank"</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">)</span><span style="background-color: #272822">                                                                                         </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">        )</span><span style="background-color: #272822">                                                                                                         </span>
<span style="background-color: #272822">                                                                                                                   </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">        </span><span style="color: #959077; text-decoration-color: #959077; background-color: #272822"># comma-separated lists to arrays</span><span style="background-color: #272822">                                                                         </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">        t </span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">=</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> t</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">.</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">mutate(labels</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">=</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">t[</span><span style="color: #e6db74; text-decoration-color: #e6db74; background-color: #272822">"labels"</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">]</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">.</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">split(</span><span style="color: #e6db74; text-decoration-color: #e6db74; background-color: #272822">","</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">))</span><span style="background-color: #272822">                                                               </span>
<span style="background-color: #272822">                                                                                                                   </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">        </span><span style="color: #959077; text-decoration-color: #959077; background-color: #272822"># order</span><span style="background-color: #272822">                                                                                                   </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">        t </span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">=</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> t</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">.</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">order_by(ibis</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">.</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">asc(</span><span style="color: #e6db74; text-decoration-color: #e6db74; background-color: #272822">"priority"</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">), ibis</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">.</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">desc(</span><span style="color: #e6db74; text-decoration-color: #e6db74; background-color: #272822">"idx"</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">))</span><span style="background-color: #272822">                                                    </span>
<span style="background-color: #272822">                                                                                                                   </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">        </span><span style="color: #959077; text-decoration-color: #959077; background-color: #272822"># return the data</span><span style="background-color: #272822">                                                                                         </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">        </span><span style="color: #66d9ef; text-decoration-color: #66d9ef; background-color: #272822">return</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> t</span><span style="background-color: #272822">                                                                                                  </span>
<span style="background-color: #272822">                                                                                                                   </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">    </span><span style="color: #959077; text-decoration-color: #959077; background-color: #272822"># contains</span><span style="background-color: #272822">                                                                                                    </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">    </span><span style="color: #66d9ef; text-decoration-color: #66d9ef; background-color: #272822">def</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> </span><span style="color: #a6e22e; text-decoration-color: #a6e22e; background-color: #272822">contains_todo</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">(self, id: str, user_id: str </span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">=</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> </span><span style="color: #66d9ef; text-decoration-color: #66d9ef; background-color: #272822">None</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">) </span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">-&gt;</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> bool:</span><span style="background-color: #272822">                                                </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">        t </span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">=</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> self</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">.</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">todos_t(user_id</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">=</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">user_id)</span><span style="background-color: #272822">                                                                         </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">        </span><span style="color: #66d9ef; text-decoration-color: #66d9ef; background-color: #272822">return</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> t</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">.</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">filter(t[</span><span style="color: #e6db74; text-decoration-color: #e6db74; background-color: #272822">"id"</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">] </span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">==</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> id)</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">.</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">count()</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">.</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">to_pyarrow()</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">.</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">as_py() </span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">&gt;</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> </span><span style="color: #ae81ff; text-decoration-color: #ae81ff; background-color: #272822">0</span><span style="background-color: #272822">                                           </span>
<span style="background-color: #272822">                                                                                                                   </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">    </span><span style="color: #959077; text-decoration-color: #959077; background-color: #272822"># get record</span><span style="background-color: #272822">                                                                                                  </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">    </span><span style="color: #66d9ef; text-decoration-color: #66d9ef; background-color: #272822">def</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> </span><span style="color: #a6e22e; text-decoration-color: #a6e22e; background-color: #272822">get_todos</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">(self, user_id: str </span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">=</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> </span><span style="color: #66d9ef; text-decoration-color: #66d9ef; background-color: #272822">None</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">):</span><span style="background-color: #272822">                                                                     </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">        t </span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">=</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> self</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">.</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">todos_t(user_id</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">=</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">user_id)</span><span style="background-color: #272822">                                                                         </span>
<span style="background-color: #272822">                                                                                                                   </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">        </span><span style="color: #66d9ef; text-decoration-color: #66d9ef; background-color: #272822">return</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> t</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">.</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">to_pyarrow()</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">.</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">to_pylist()</span><span style="background-color: #272822">                                                                         </span>
<span style="background-color: #272822">                                                                                                                   </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">    </span><span style="color: #66d9ef; text-decoration-color: #66d9ef; background-color: #272822">def</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> </span><span style="color: #a6e22e; text-decoration-color: #a6e22e; background-color: #272822">get_todo</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">(self, id: str, user_id: str </span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">=</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> </span><span style="color: #66d9ef; text-decoration-color: #66d9ef; background-color: #272822">None</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">):</span><span style="background-color: #272822">                                                             </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">        t </span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">=</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> self</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">.</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">todos_t(user_id</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">=</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">user_id)</span><span style="background-color: #272822">                                                                         </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">        </span><span style="color: #66d9ef; text-decoration-color: #66d9ef; background-color: #272822">return</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> t</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">.</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">filter(t[</span><span style="color: #e6db74; text-decoration-color: #e6db74; background-color: #272822">"id"</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">] </span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">==</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> id)</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">.</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">to_pyarrow()</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">.</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">to_pylist()[</span><span style="color: #ae81ff; text-decoration-color: #ae81ff; background-color: #272822">0</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">]</span><span style="background-color: #272822">                                                </span>
<span style="background-color: #272822">                                                                                                                   </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">    </span><span style="color: #959077; text-decoration-color: #959077; background-color: #272822"># append record</span><span style="background-color: #272822">                                                                                               </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">    </span><span style="color: #66d9ef; text-decoration-color: #66d9ef; background-color: #272822">def</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> </span><span style="color: #a6e22e; text-decoration-color: #a6e22e; background-color: #272822">append_todo</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">(</span><span style="background-color: #272822">                                                                                              </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">        self,</span><span style="background-color: #272822">                                                                                                     </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">        id: str,</span><span style="background-color: #272822">                                                                                                  </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">        user_id: str,</span><span style="background-color: #272822">                                                                                             </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">        subject: str,</span><span style="background-color: #272822">                                                                                             </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">        body: str,</span><span style="background-color: #272822">                                                                                                </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">        priority: int </span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">=</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> </span><span style="color: #ae81ff; text-decoration-color: #ae81ff; background-color: #272822">100</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">,</span><span style="background-color: #272822">                                                                                      </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">        status: str </span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">=</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> </span><span style="color: #66d9ef; text-decoration-color: #66d9ef; background-color: #272822">None</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">,</span><span style="background-color: #272822">                                                                                       </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">        description: str </span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">=</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> </span><span style="color: #66d9ef; text-decoration-color: #66d9ef; background-color: #272822">None</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">,</span><span style="background-color: #272822">                                                                                  </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">        labels: list[str] </span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">=</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> </span><span style="color: #66d9ef; text-decoration-color: #66d9ef; background-color: #272822">None</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">,</span><span style="background-color: #272822">                                                                                 </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">    ):</span><span style="background-color: #272822">                                                                                                            </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">        </span><span style="color: #66d9ef; text-decoration-color: #66d9ef; background-color: #272822">if</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> self</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">.</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">contains_todo(id</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">=</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">id):</span><span style="background-color: #272822">                                                                             </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">            </span><span style="color: #66d9ef; text-decoration-color: #66d9ef; background-color: #272822">raise</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> </span><span style="color: #a6e22e; text-decoration-color: #a6e22e; background-color: #272822">ValueError</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">(</span><span style="color: #e6db74; text-decoration-color: #e6db74; background-color: #272822">f"todo {</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">id</span><span style="color: #e6db74; text-decoration-color: #e6db74; background-color: #272822">} already exists"</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">)</span><span style="background-color: #272822">                                                         </span>
<span style="background-color: #272822">                                                                                                                   </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">        data </span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">=</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> {</span><span style="background-color: #272822">                                                                                                  </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">            </span><span style="color: #e6db74; text-decoration-color: #e6db74; background-color: #272822">"idx"</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">: [now()],</span><span style="background-color: #272822">                                                                                       </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">            </span><span style="color: #e6db74; text-decoration-color: #e6db74; background-color: #272822">"id"</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">: [id],</span><span style="background-color: #272822">                                                                                           </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">            </span><span style="color: #e6db74; text-decoration-color: #e6db74; background-color: #272822">"user_id"</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">: [user_id],</span><span style="background-color: #272822">                                                                                 </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">            </span><span style="color: #e6db74; text-decoration-color: #e6db74; background-color: #272822">"subject"</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">: [subject],</span><span style="background-color: #272822">                                                                                 </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">            </span><span style="color: #e6db74; text-decoration-color: #e6db74; background-color: #272822">"body"</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">: [body],</span><span style="background-color: #272822">                                                                                       </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">            </span><span style="color: #e6db74; text-decoration-color: #e6db74; background-color: #272822">"priority"</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">: [priority],</span><span style="background-color: #272822">                                                                               </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">            </span><span style="color: #e6db74; text-decoration-color: #e6db74; background-color: #272822">"status"</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">: [status],</span><span style="background-color: #272822">                                                                                   </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">            </span><span style="color: #e6db74; text-decoration-color: #e6db74; background-color: #272822">"description"</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">: [description],</span><span style="background-color: #272822">                                                                         </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">            </span><span style="color: #e6db74; text-decoration-color: #e6db74; background-color: #272822">"labels"</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">: [</span><span style="color: #e6db74; text-decoration-color: #e6db74; background-color: #272822">","</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">.</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">join(labels) </span><span style="color: #66d9ef; text-decoration-color: #66d9ef; background-color: #272822">if</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> labels </span><span style="color: #66d9ef; text-decoration-color: #66d9ef; background-color: #272822">else</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> </span><span style="color: #66d9ef; text-decoration-color: #66d9ef; background-color: #272822">None</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">],</span><span style="background-color: #272822">                                                     </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">        }</span><span style="background-color: #272822">                                                                                                         </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">        self</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">.</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">wcon</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">.</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">insert(self</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">.</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">todos_table_name, data)</span><span style="background-color: #272822">                                                             </span>
<span style="background-color: #272822">                                                                                                                   </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">        </span><span style="color: #66d9ef; text-decoration-color: #66d9ef; background-color: #272822">return</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> self</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">.</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">get_todo(id</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">=</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">id)</span><span style="background-color: #272822">                                                                               </span>
<span style="background-color: #272822">                                                                                                                   </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">    </span><span style="color: #959077; text-decoration-color: #959077; background-color: #272822"># update record</span><span style="background-color: #272822">                                                                                               </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">    </span><span style="color: #66d9ef; text-decoration-color: #66d9ef; background-color: #272822">def</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> </span><span style="color: #a6e22e; text-decoration-color: #a6e22e; background-color: #272822">update_todo</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">(</span><span style="background-color: #272822">                                                                                              </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">        self,</span><span style="background-color: #272822">                                                                                                     </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">        id: str,</span><span style="background-color: #272822">                                                                                                  </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">        user_id: str,</span><span style="background-color: #272822">                                                                                             </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">        subject: str,</span><span style="background-color: #272822">                                                                                             </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">        body: str,</span><span style="background-color: #272822">                                                                                                </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">        priority: int </span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">=</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> </span><span style="color: #ae81ff; text-decoration-color: #ae81ff; background-color: #272822">100</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">,</span><span style="background-color: #272822">                                                                                      </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">        status: str </span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">=</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> </span><span style="color: #66d9ef; text-decoration-color: #66d9ef; background-color: #272822">None</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">,</span><span style="background-color: #272822">                                                                                       </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">        description: str </span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">=</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> </span><span style="color: #66d9ef; text-decoration-color: #66d9ef; background-color: #272822">None</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">,</span><span style="background-color: #272822">                                                                                  </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">        labels: list[str] </span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">=</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> </span><span style="color: #66d9ef; text-decoration-color: #66d9ef; background-color: #272822">None</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">,</span><span style="background-color: #272822">                                                                                 </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">    ):</span><span style="background-color: #272822">                                                                                                            </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">        </span><span style="color: #66d9ef; text-decoration-color: #66d9ef; background-color: #272822">if</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> </span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">not</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> self</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">.</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">contains_todo(id</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">=</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">id):</span><span style="background-color: #272822">                                                                         </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">            </span><span style="color: #66d9ef; text-decoration-color: #66d9ef; background-color: #272822">raise</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> </span><span style="color: #a6e22e; text-decoration-color: #a6e22e; background-color: #272822">ValueError</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">(</span><span style="color: #e6db74; text-decoration-color: #e6db74; background-color: #272822">f"todo {</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">id</span><span style="color: #e6db74; text-decoration-color: #e6db74; background-color: #272822">} does not exist"</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">)</span><span style="background-color: #272822">                                                         </span>
<span style="background-color: #272822">                                                                                                                   </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">        data </span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">=</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> {</span><span style="background-color: #272822">                                                                                                  </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">            </span><span style="color: #e6db74; text-decoration-color: #e6db74; background-color: #272822">"idx"</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">: [now()],</span><span style="background-color: #272822">                                                                                       </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">            </span><span style="color: #e6db74; text-decoration-color: #e6db74; background-color: #272822">"id"</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">: [id],</span><span style="background-color: #272822">                                                                                           </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">            </span><span style="color: #e6db74; text-decoration-color: #e6db74; background-color: #272822">"user_id"</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">: [user_id],</span><span style="background-color: #272822">                                                                                 </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">            </span><span style="color: #e6db74; text-decoration-color: #e6db74; background-color: #272822">"subject"</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">: [subject],</span><span style="background-color: #272822">                                                                                 </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">            </span><span style="color: #e6db74; text-decoration-color: #e6db74; background-color: #272822">"body"</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">: [body],</span><span style="background-color: #272822">                                                                                       </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">            </span><span style="color: #e6db74; text-decoration-color: #e6db74; background-color: #272822">"priority"</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">: [priority],</span><span style="background-color: #272822">                                                                               </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">            </span><span style="color: #e6db74; text-decoration-color: #e6db74; background-color: #272822">"status"</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">: [status],</span><span style="background-color: #272822">                                                                                   </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">            </span><span style="color: #e6db74; text-decoration-color: #e6db74; background-color: #272822">"description"</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">: [description],</span><span style="background-color: #272822">                                                                         </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">            </span><span style="color: #e6db74; text-decoration-color: #e6db74; background-color: #272822">"labels"</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">: [</span><span style="color: #e6db74; text-decoration-color: #e6db74; background-color: #272822">","</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">.</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">join(labels) </span><span style="color: #66d9ef; text-decoration-color: #66d9ef; background-color: #272822">if</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> labels </span><span style="color: #66d9ef; text-decoration-color: #66d9ef; background-color: #272822">else</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> </span><span style="color: #66d9ef; text-decoration-color: #66d9ef; background-color: #272822">None</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">],</span><span style="background-color: #272822">                                                     </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">        }</span><span style="background-color: #272822">                                                                                                         </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">        self</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">.</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">wcon</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">.</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">insert(self</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">.</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">todos_table_name, data)</span><span style="background-color: #272822">                                                             </span>
<span style="background-color: #272822">                                                                                                                   </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">        </span><span style="color: #66d9ef; text-decoration-color: #66d9ef; background-color: #272822">return</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> self</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">.</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">get_todo(id</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">=</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">id)</span><span style="background-color: #272822">                                                                               </span>
<span style="background-color: #272822">                                                                                                                   </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">    </span><span style="color: #959077; text-decoration-color: #959077; background-color: #272822"># aliases</span><span style="background-color: #272822">                                                                                                     </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">    </span><span style="color: #a6e22e; text-decoration-color: #a6e22e; background-color: #272822">__call__</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> </span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">=</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> get_todos</span><span style="background-color: #272822">                                                                                          </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">    t </span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">=</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> todos_t</span><span style="background-color: #272822">                                                                                                   </span>
<span style="background-color: #272822">                                                                                                                   
</span></pre>
</div>
</div>
<p>We have a simple, fast, performant todo list.</p>
</section>
<section id="dkdc-lake" class="level3">
<h3 class="anchored" data-anchor-id="dkdc-lake">dkdc-lake</h3>
<p>Let’s look at <a href="https://github.com/dkdc-io/dkdc-lake">dkdc-lake</a> as another example:</p>
<div id="e1cae023" class="cell" data-execution_count="12">
<div class="sourceCode cell-code" id="cb17" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> dkdc_lake <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> Lake</span>
<span id="cb17-2"></span>
<span id="cb17-3">lake <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> Lake(dbpath<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"data.db"</span>)</span>
<span id="cb17-4">lake</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="12">
<pre><code>&lt;dkdc_lake.main.Lake at 0x122fdc1d0&gt;</code></pre>
</div>
</div>
<p>We can again view the table/schema:</p>
<div id="08f3dc86" class="cell" data-execution_count="13">
<div class="sourceCode cell-code" id="cb19" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1">lake.t()</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="13">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">┏━━━━━━━━━━━━━━┳━━━━━━━━┳━━━━━━━━━┳━━━━━━━━┳━━━━━━━━━━┳━━━━━━━━━━┳━━━━━━━━┳━━━━━━━━━┳━━━━━━━━┳━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃<span style="font-weight: bold"> idx          </span>┃<span style="font-weight: bold"> id     </span>┃<span style="font-weight: bold"> user_id </span>┃<span style="font-weight: bold"> path   </span>┃<span style="font-weight: bold"> filename </span>┃<span style="font-weight: bold"> filetype </span>┃<span style="font-weight: bold"> data   </span>┃<span style="font-weight: bold"> version </span>┃<span style="font-weight: bold"> status </span>┃<span style="font-weight: bold"> description </span>┃<span style="font-weight: bold"> labels        </span>┃
┡━━━━━━━━━━━━━━╇━━━━━━━━╇━━━━━━━━━╇━━━━━━━━╇━━━━━━━━━━╇━━━━━━━━━━╇━━━━━━━━╇━━━━━━━━━╇━━━━━━━━╇━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">timestamp(6)</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>  │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>   │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>   │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">binary</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">int64</span>   │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>      │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">array&lt;string&gt;</span> │
└──────────────┴────────┴─────────┴────────┴──────────┴──────────┴────────┴─────────┴────────┴─────────────┴───────────────┘
</pre>
</div>
</div>
<p>And append a record (representing a file) into it:</p>
<div id="64a2208f" class="cell" data-execution_count="14">
<div class="sourceCode cell-code" id="cb20" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1">lake.append_file(</span>
<span id="cb20-2">    user_id<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">None</span>,</span>
<span id="cb20-3">    path<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">None</span>,</span>
<span id="cb20-4">    filename<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"test.txt"</span>,</span>
<span id="cb20-5">    filetype<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"txt"</span>,</span>
<span id="cb20-6">    data<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">b"hello world"</span>,</span>
<span id="cb20-7">)</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="14">
<pre><code>{'idx': datetime.datetime(2024, 11, 27, 18, 2, 45, 505331),
 'id': '173273056550533-f0d929c0',
 'user_id': None,
 'path': None,
 'filename': 'test.txt',
 'filetype': 'txt',
 'data': b'hello world',
 'version': None,
 'status': None,
 'description': None,
 'labels': None}</code></pre>
</div>
</div>
<p>Now, we see our record:</p>
<div id="5644751f" class="cell" data-execution_count="15">
<div class="sourceCode cell-code" id="cb22" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1">lake.t()</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="15">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━┳━━━━━━━━┳━━━━━━━━━━┳━━━━━━━━━━┳━━━━━━━━━━━━━━━━┳━━━━━━━━━┳━━━━━━━━┳━━━━━━━━━━━━━┳━━━━━━━━┓
┃<span style="font-weight: bold"> idx                        </span>┃<span style="font-weight: bold"> id                       </span>┃<span style="font-weight: bold"> user_id </span>┃<span style="font-weight: bold"> path   </span>┃<span style="font-weight: bold"> filename </span>┃<span style="font-weight: bold"> filetype </span>┃<span style="font-weight: bold"> data           </span>┃<span style="font-weight: bold"> version </span>┃<span style="font-weight: bold"> status </span>┃<span style="font-weight: bold"> description </span>┃<span style="font-weight: bold"> labels </span>┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━╇━━━━━━━━╇━━━━━━━━━━╇━━━━━━━━━━╇━━━━━━━━━━━━━━━━╇━━━━━━━━━╇━━━━━━━━╇━━━━━━━━━━━━━╇━━━━━━━━┩
│ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">timestamp(6)</span>               │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>                   │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>  │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>   │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>   │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">binary</span>         │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">int64</span>   │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>      │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">array…</span> │
├────────────────────────────┼──────────────────────────┼─────────┼────────┼──────────┼──────────┼────────────────┼─────────┼────────┼─────────────┼────────┤
│ <span style="color: #800080; text-decoration-color: #800080">2024-11-27 18:02:45.505331</span> │ <span style="color: #008000; text-decoration-color: #008000">173273056550533-f0d929c0</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">NULL</span>    │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">NULL</span>   │ <span style="color: #008000; text-decoration-color: #008000">test.txt</span> │ <span style="color: #008000; text-decoration-color: #008000">txt     </span> │ <span style="color: #008000; text-decoration-color: #008000">b'hello world'</span> │    <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">NULL</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">NULL</span>   │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">NULL</span>        │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">NULL</span>   │
└────────────────────────────┴──────────────────────────┴─────────┴────────┴──────────┴──────────┴────────────────┴─────────┴────────┴─────────────┴────────┘
</pre>
</div>
</div>
<p>And like before can update it:</p>
<div id="27fa7889" class="cell" data-execution_count="16">
<div class="sourceCode cell-code" id="cb23" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1">lake.update_file(</span>
<span id="cb23-2">    user_id<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">None</span>,</span>
<span id="cb23-3">    path<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">None</span>,</span>
<span id="cb23-4">    filename<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"test.txt"</span>,</span>
<span id="cb23-5">    filetype<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"txt"</span>,</span>
<span id="cb23-6">    data<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">b"hello world!"</span>,</span>
<span id="cb23-7">    version<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">None</span>,</span>
<span id="cb23-8">    status<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">None</span>,</span>
<span id="cb23-9">    description<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">None</span>,</span>
<span id="cb23-10">    labels<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">None</span>,</span>
<span id="cb23-11">)</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="16">
<pre><code>{'idx': datetime.datetime(2024, 11, 27, 18, 2, 45, 586443),
 'id': '173273056550533-f0d929c0',
 'user_id': None,
 'path': None,
 'filename': 'test.txt',
 'filetype': 'txt',
 'data': b'hello world!',
 'version': None,
 'status': None,
 'description': None,
 'labels': None}</code></pre>
</div>
</div>
<p>Showing only one row:</p>
<div id="d6720fa5" class="cell" data-execution_count="17">
<div class="sourceCode cell-code" id="cb25" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1">lake.t()</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="17">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━┳━━━━━━━━┳━━━━━━━━━━┳━━━━━━━━━━┳━━━━━━━━━━━━━━━━━┳━━━━━━━━━┳━━━━━━━━┳━━━━━━━━━━━━━┳━━━━━━━━┓
┃<span style="font-weight: bold"> idx                        </span>┃<span style="font-weight: bold"> id                       </span>┃<span style="font-weight: bold"> user_id </span>┃<span style="font-weight: bold"> path   </span>┃<span style="font-weight: bold"> filename </span>┃<span style="font-weight: bold"> filetype </span>┃<span style="font-weight: bold"> data            </span>┃<span style="font-weight: bold"> version </span>┃<span style="font-weight: bold"> status </span>┃<span style="font-weight: bold"> description </span>┃<span style="font-weight: bold"> labels </span>┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━╇━━━━━━━━╇━━━━━━━━━━╇━━━━━━━━━━╇━━━━━━━━━━━━━━━━━╇━━━━━━━━━╇━━━━━━━━╇━━━━━━━━━━━━━╇━━━━━━━━┩
│ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">timestamp(6)</span>               │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>                   │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>  │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>   │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>   │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">binary</span>          │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">int64</span>   │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>      │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">array…</span> │
├────────────────────────────┼──────────────────────────┼─────────┼────────┼──────────┼──────────┼─────────────────┼─────────┼────────┼─────────────┼────────┤
│ <span style="color: #800080; text-decoration-color: #800080">2024-11-27 18:02:45.586443</span> │ <span style="color: #008000; text-decoration-color: #008000">173273056550533-f0d929c0</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">NULL</span>    │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">NULL</span>   │ <span style="color: #008000; text-decoration-color: #008000">test.txt</span> │ <span style="color: #008000; text-decoration-color: #008000">txt     </span> │ <span style="color: #008000; text-decoration-color: #008000">b'hello world!'</span> │    <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">NULL</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">NULL</span>   │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">NULL</span>        │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">NULL</span>   │
└────────────────────────────┴──────────────────────────┴─────────┴────────┴──────────┴──────────┴─────────────────┴─────────┴────────┴─────────────┴────────┘
</pre>
</div>
</div>
<p>But again, there are two in the underlying SQLite table:</p>
<div id="e2e37190" class="cell" data-execution_count="18">
<div class="sourceCode cell-code" id="cb26" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1">lake.wcon.table(lake.lake_table_name)</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="18">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━┳━━━━━━━━┳━━━━━━━━━━┳━━━━━━━━━━┳━━━━━━━━━━━━━━━━━┳━━━━━━━━━┳━━━━━━━━┳━━━━━━━━━━━━━┳━━━━━━━━┓
┃<span style="font-weight: bold"> idx                        </span>┃<span style="font-weight: bold"> id                       </span>┃<span style="font-weight: bold"> user_id </span>┃<span style="font-weight: bold"> path   </span>┃<span style="font-weight: bold"> filename </span>┃<span style="font-weight: bold"> filetype </span>┃<span style="font-weight: bold"> data            </span>┃<span style="font-weight: bold"> version </span>┃<span style="font-weight: bold"> status </span>┃<span style="font-weight: bold"> description </span>┃<span style="font-weight: bold"> labels </span>┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━╇━━━━━━━━╇━━━━━━━━━━╇━━━━━━━━━━╇━━━━━━━━━━━━━━━━━╇━━━━━━━━━╇━━━━━━━━╇━━━━━━━━━━━━━╇━━━━━━━━┩
│ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">timestamp</span>                  │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>                   │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>  │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>   │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>   │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">binary</span>          │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">int64</span>   │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>      │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span> │
├────────────────────────────┼──────────────────────────┼─────────┼────────┼──────────┼──────────┼─────────────────┼─────────┼────────┼─────────────┼────────┤
│ <span style="color: #800080; text-decoration-color: #800080">2024-11-27 18:02:45.505331</span> │ <span style="color: #008000; text-decoration-color: #008000">173273056550533-f0d929c0</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">NULL</span>    │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">NULL</span>   │ <span style="color: #008000; text-decoration-color: #008000">test.txt</span> │ <span style="color: #008000; text-decoration-color: #008000">txt     </span> │ <span style="color: #008000; text-decoration-color: #008000">b'hello world'</span>  │    <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">NULL</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">NULL</span>   │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">NULL</span>        │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">NULL</span>   │
│ <span style="color: #800080; text-decoration-color: #800080">2024-11-27 18:02:45.586443</span> │ <span style="color: #008000; text-decoration-color: #008000">173273056550533-f0d929c0</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">NULL</span>    │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">NULL</span>   │ <span style="color: #008000; text-decoration-color: #008000">test.txt</span> │ <span style="color: #008000; text-decoration-color: #008000">txt     </span> │ <span style="color: #008000; text-decoration-color: #008000">b'hello world!'</span> │    <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">NULL</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">NULL</span>   │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">NULL</span>        │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">NULL</span>   │
└────────────────────────────┴──────────────────────────┴─────────┴────────┴──────────┴──────────┴─────────────────┴─────────┴────────┴─────────────┴────────┘
</pre>
</div>
</div>
<p>Our view above is using a window function over <code>idx</code> (a timestamp) to take only the latest version of the record:</p>
<div id="131c4ade" class="cell" data-execution_count="19">
<details class="code-fold">
<summary>Lake class code code</summary>
<div class="sourceCode cell-code" id="cb27" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1">get_class_source(Lake)</span></code></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="19">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace"><span style="background-color: #272822">                                                                                                                   
 </span><span style="color: #66d9ef; text-decoration-color: #66d9ef; background-color: #272822">class</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> </span><span style="color: #a6e22e; text-decoration-color: #a6e22e; background-color: #272822">Lake</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">(State):</span><span style="background-color: #272822">                                                                                                </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">    </span><span style="color: #66d9ef; text-decoration-color: #66d9ef; background-color: #272822">def</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> </span><span style="color: #a6e22e; text-decoration-color: #a6e22e; background-color: #272822">__init__</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">(self, dbpath: str </span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">=</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> </span><span style="color: #66d9ef; text-decoration-color: #66d9ef; background-color: #272822">None</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">):</span><span style="background-color: #272822">                                                                       </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">        </span><span style="color: #66d9ef; text-decoration-color: #66d9ef; background-color: #272822">if</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> dbpath </span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">is</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> </span><span style="color: #66d9ef; text-decoration-color: #66d9ef; background-color: #272822">None</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">:</span><span style="background-color: #272822">                                                                                        </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">            dbpath </span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">=</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> os</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">.</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">path</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">.</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">join(get_dkdc_dir(), </span><span style="color: #e6db74; text-decoration-color: #e6db74; background-color: #272822">"lake.db"</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">)</span><span style="background-color: #272822">                                                      </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">        super()</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">.</span><span style="color: #a6e22e; text-decoration-color: #a6e22e; background-color: #272822">__init__</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">(dbpath</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">=</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">dbpath)</span><span style="background-color: #272822">                                                                           </span>
<span style="background-color: #272822">                                                                                                                   </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">    </span><span style="color: #66d9ef; text-decoration-color: #66d9ef; background-color: #272822">def</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> </span><span style="color: #a6e22e; text-decoration-color: #a6e22e; background-color: #272822">_cons</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">(self) </span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">-&gt;</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> (ibis</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">.</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">BaseBackend, ibis</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">.</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">BaseBackend):</span><span style="background-color: #272822">                                                      </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">        </span><span style="color: #959077; text-decoration-color: #959077; background-color: #272822"># create write connection</span><span style="background-color: #272822">                                                                                 </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">        wcon </span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">=</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> ibis</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">.</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">sqlite</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">.</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">connect(self</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">.</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">dbpath)</span><span style="background-color: #272822">                                                                   </span>
<span style="background-color: #272822">                                                                                                                   </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">        </span><span style="color: #959077; text-decoration-color: #959077; background-color: #272822"># create tables in write connection</span><span style="background-color: #272822">                                                                       </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">        </span><span style="color: #959077; text-decoration-color: #959077; background-color: #272822">## lake data</span><span style="background-color: #272822">                                                                                              </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">        self</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">.</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">lake_table_name </span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">=</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> </span><span style="color: #e6db74; text-decoration-color: #e6db74; background-color: #272822">"lake"</span><span style="background-color: #272822">                                                                             </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">        schema </span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">=</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> ibis</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">.</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">schema(</span><span style="background-color: #272822">                                                                                     </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">            {</span><span style="background-color: #272822">                                                                                                     </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">                </span><span style="color: #e6db74; text-decoration-color: #e6db74; background-color: #272822">"idx"</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">: dt</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">.</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">timestamp,</span><span style="background-color: #272822">                                                                              </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">                </span><span style="color: #e6db74; text-decoration-color: #e6db74; background-color: #272822">"id"</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">: str,</span><span style="background-color: #272822">                                                                                        </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">                </span><span style="color: #e6db74; text-decoration-color: #e6db74; background-color: #272822">"user_id"</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">: str,</span><span style="background-color: #272822">                                                                                   </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">                </span><span style="color: #e6db74; text-decoration-color: #e6db74; background-color: #272822">"path"</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">: str,</span><span style="background-color: #272822">                                                                                      </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">                </span><span style="color: #e6db74; text-decoration-color: #e6db74; background-color: #272822">"filename"</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">: str,</span><span style="background-color: #272822">                                                                                  </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">                </span><span style="color: #e6db74; text-decoration-color: #e6db74; background-color: #272822">"filetype"</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">: str,</span><span style="background-color: #272822">                                                                                  </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">                </span><span style="color: #e6db74; text-decoration-color: #e6db74; background-color: #272822">"data"</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">: dt</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">.</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">binary,</span><span style="background-color: #272822">                                                                                </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">                </span><span style="color: #e6db74; text-decoration-color: #e6db74; background-color: #272822">"version"</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">: int,</span><span style="background-color: #272822">                                                                                   </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">                </span><span style="color: #e6db74; text-decoration-color: #e6db74; background-color: #272822">"status"</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">: str,</span><span style="background-color: #272822">                                                                                    </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">                </span><span style="color: #e6db74; text-decoration-color: #e6db74; background-color: #272822">"description"</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">: str,</span><span style="background-color: #272822">                                                                               </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">                </span><span style="color: #e6db74; text-decoration-color: #e6db74; background-color: #272822">"labels"</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">: str,  </span><span style="color: #959077; text-decoration-color: #959077; background-color: #272822"># comma-separated list of labels</span><span style="background-color: #272822">                                                  </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">            }</span><span style="background-color: #272822">                                                                                                     </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">        )</span><span style="background-color: #272822">                                                                                                         </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">        </span><span style="color: #66d9ef; text-decoration-color: #66d9ef; background-color: #272822">if</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> self</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">.</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">lake_table_name </span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">not</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> </span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">in</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> wcon</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">.</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">list_tables():</span><span style="background-color: #272822">                                                        </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">            wcon</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">.</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">create_table(self</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">.</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">lake_table_name, schema</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">=</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">schema)</span><span style="background-color: #272822">                                                </span>
<span style="background-color: #272822">                                                                                                                   </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">        </span><span style="color: #959077; text-decoration-color: #959077; background-color: #272822"># create read connection</span><span style="background-color: #272822">                                                                                  </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">        rcon </span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">=</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> ibis</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">.</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">duckdb</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">.</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">connect()</span><span style="background-color: #272822">                                                                              </span>
<span style="background-color: #272822">                                                                                                                   </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">        </span><span style="color: #959077; text-decoration-color: #959077; background-color: #272822"># create tables in read connection</span><span style="background-color: #272822">                                                                        </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">        </span><span style="color: #66d9ef; text-decoration-color: #66d9ef; background-color: #272822">for</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> table_name </span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">in</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> wcon</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">.</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">list_tables():</span><span style="background-color: #272822">                                                                     </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">            rcon</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">.</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">read_sqlite(self</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">.</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">dbpath, table_name</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">=</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">table_name)</span><span style="background-color: #272822">                                                  </span>
<span style="background-color: #272822">                                                                                                                   </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">        </span><span style="color: #66d9ef; text-decoration-color: #66d9ef; background-color: #272822">return</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> wcon, rcon</span><span style="background-color: #272822">                                                                                         </span>
<span style="background-color: #272822">                                                                                                                   </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">    </span><span style="color: #959077; text-decoration-color: #959077; background-color: #272822"># tables</span><span style="background-color: #272822">                                                                                                      </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">    </span><span style="color: #66d9ef; text-decoration-color: #66d9ef; background-color: #272822">def</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> </span><span style="color: #a6e22e; text-decoration-color: #a6e22e; background-color: #272822">lake_t</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">(self, user_id: str </span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">=</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> </span><span style="color: #66d9ef; text-decoration-color: #66d9ef; background-color: #272822">None</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">):</span><span style="background-color: #272822">                                                                        </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">        </span><span style="color: #959077; text-decoration-color: #959077; background-color: #272822"># get lake data</span><span style="background-color: #272822">                                                                                           </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">        t </span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">=</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> self</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">.</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">rcon</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">.</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">table(self</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">.</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">lake_table_name)</span><span style="background-color: #272822">                                                                 </span>
<span style="background-color: #272822">                                                                                                                   </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">        </span><span style="color: #959077; text-decoration-color: #959077; background-color: #272822"># filter by user_id</span><span style="background-color: #272822">                                                                                       </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">        </span><span style="color: #66d9ef; text-decoration-color: #66d9ef; background-color: #272822">if</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> user_id:</span><span style="background-color: #272822">                                                                                               </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">            t </span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">=</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> t</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">.</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">filter(t[</span><span style="color: #e6db74; text-decoration-color: #e6db74; background-color: #272822">"user_id"</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">] </span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">==</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> user_id)</span><span style="background-color: #272822">                                                                 </span>
<span style="background-color: #272822">                                                                                                                   </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">        </span><span style="color: #959077; text-decoration-color: #959077; background-color: #272822"># get only the latest metadata</span><span style="background-color: #272822">                                                                            </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">        t </span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">=</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> (</span><span style="background-color: #272822">                                                                                                     </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">            t</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">.</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">mutate(</span><span style="background-color: #272822">                                                                                             </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">                rank</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">=</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">ibis</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">.</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">row_number()</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">.</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">over(</span><span style="background-color: #272822">                                                                      </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">                    ibis</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">.</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">window(</span><span style="background-color: #272822">                                                                                  </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">                        group_by</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">=</span><span style="color: #e6db74; text-decoration-color: #e6db74; background-color: #272822">"id"</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">,</span><span style="background-color: #272822">                                                                            </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">                        order_by</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">=</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">ibis</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">.</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">desc(</span><span style="color: #e6db74; text-decoration-color: #e6db74; background-color: #272822">"idx"</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">),</span><span style="background-color: #272822">                                                                </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">                    )</span><span style="background-color: #272822">                                                                                             </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">                )</span><span style="background-color: #272822">                                                                                                 </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">            )</span><span style="background-color: #272822">                                                                                                     </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">            </span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">.</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">filter(ibis</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">.</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">_[</span><span style="color: #e6db74; text-decoration-color: #e6db74; background-color: #272822">"rank"</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">] </span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">==</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> </span><span style="color: #ae81ff; text-decoration-color: #ae81ff; background-color: #272822">0</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">)</span><span style="background-color: #272822">                                                                          </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">            </span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">.</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">drop(</span><span style="color: #e6db74; text-decoration-color: #e6db74; background-color: #272822">"rank"</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">)</span><span style="background-color: #272822">                                                                                         </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">        )</span><span style="background-color: #272822">                                                                                                         </span>
<span style="background-color: #272822">                                                                                                                   </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">        </span><span style="color: #959077; text-decoration-color: #959077; background-color: #272822"># comma-separated lists to arrays</span><span style="background-color: #272822">                                                                         </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">        t </span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">=</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> t</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">.</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">mutate(labels</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">=</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">t[</span><span style="color: #e6db74; text-decoration-color: #e6db74; background-color: #272822">"labels"</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">]</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">.</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">split(</span><span style="color: #e6db74; text-decoration-color: #e6db74; background-color: #272822">","</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">))</span><span style="background-color: #272822">                                                               </span>
<span style="background-color: #272822">                                                                                                                   </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">        </span><span style="color: #959077; text-decoration-color: #959077; background-color: #272822"># order</span><span style="background-color: #272822">                                                                                                   </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">        t </span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">=</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> t</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">.</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">order_by(ibis</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">.</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">desc(</span><span style="color: #e6db74; text-decoration-color: #e6db74; background-color: #272822">"idx"</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">))</span><span style="background-color: #272822">                                                                          </span>
<span style="background-color: #272822">                                                                                                                   </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">        </span><span style="color: #959077; text-decoration-color: #959077; background-color: #272822"># return the data</span><span style="background-color: #272822">                                                                                         </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">        </span><span style="color: #66d9ef; text-decoration-color: #66d9ef; background-color: #272822">return</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> t</span><span style="background-color: #272822">                                                                                                  </span>
<span style="background-color: #272822">                                                                                                                   </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">    </span><span style="color: #959077; text-decoration-color: #959077; background-color: #272822"># contains</span><span style="background-color: #272822">                                                                                                    </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">    </span><span style="color: #66d9ef; text-decoration-color: #66d9ef; background-color: #272822">def</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> </span><span style="color: #a6e22e; text-decoration-color: #a6e22e; background-color: #272822">contains_path</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">(self, path: str, user_id: str </span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">=</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> </span><span style="color: #66d9ef; text-decoration-color: #66d9ef; background-color: #272822">None</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">) </span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">-&gt;</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> bool:</span><span style="background-color: #272822">                                              </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">        t </span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">=</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> self</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">.</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">lake_t(user_id</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">=</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">user_id)</span><span style="background-color: #272822">                                                                          </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">        </span><span style="color: #66d9ef; text-decoration-color: #66d9ef; background-color: #272822">return</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> t</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">.</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">filter(t[</span><span style="color: #e6db74; text-decoration-color: #e6db74; background-color: #272822">"path"</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">] </span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">==</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> path)</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">.</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">count()</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">.</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">to_pyarrow()</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">.</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">as_py() </span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">&gt;</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> </span><span style="color: #ae81ff; text-decoration-color: #ae81ff; background-color: #272822">0</span><span style="background-color: #272822">                                       </span>
<span style="background-color: #272822">                                                                                                                   </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">    </span><span style="color: #66d9ef; text-decoration-color: #66d9ef; background-color: #272822">def</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> </span><span style="color: #a6e22e; text-decoration-color: #a6e22e; background-color: #272822">contains_file</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">(</span><span style="background-color: #272822">                                                                                            </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">        self, filename: str, path: str </span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">=</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> </span><span style="color: #66d9ef; text-decoration-color: #66d9ef; background-color: #272822">None</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">, user_id: str </span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">=</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> </span><span style="color: #66d9ef; text-decoration-color: #66d9ef; background-color: #272822">None</span><span style="background-color: #272822">                                                </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">    ) </span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">-&gt;</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> bool:</span><span style="background-color: #272822">                                                                                                    </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">        t </span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">=</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> self</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">.</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">lake_t(user_id</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">=</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">user_id)</span><span style="background-color: #272822">                                                                          </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">        </span><span style="color: #66d9ef; text-decoration-color: #66d9ef; background-color: #272822">return</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> (</span><span style="background-color: #272822">                                                                                                  </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">            t</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">.</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">filter((t[</span><span style="color: #e6db74; text-decoration-color: #e6db74; background-color: #272822">"path"</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">] </span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">==</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> path) </span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">&amp;</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> (t[</span><span style="color: #e6db74; text-decoration-color: #e6db74; background-color: #272822">"filename"</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">] </span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">==</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> filename))</span><span style="background-color: #272822">                                           </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">            </span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">.</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">count()</span><span style="background-color: #272822">                                                                                              </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">            </span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">.</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">to_pyarrow()</span><span style="background-color: #272822">                                                                                         </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">            </span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">.</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">as_py()</span><span style="background-color: #272822">                                                                                              </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">            </span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">&gt;</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> </span><span style="color: #ae81ff; text-decoration-color: #ae81ff; background-color: #272822">0</span><span style="background-color: #272822">                                                                                                   </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">        )</span><span style="background-color: #272822">                                                                                                         </span>
<span style="background-color: #272822">                                                                                                                   </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">    </span><span style="color: #959077; text-decoration-color: #959077; background-color: #272822"># get record</span><span style="background-color: #272822">                                                                                                  </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">    </span><span style="color: #66d9ef; text-decoration-color: #66d9ef; background-color: #272822">def</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> </span><span style="color: #a6e22e; text-decoration-color: #a6e22e; background-color: #272822">get_file</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">(self, filename: str, path: str </span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">=</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> </span><span style="color: #66d9ef; text-decoration-color: #66d9ef; background-color: #272822">None</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">, user_id: str </span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">=</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> </span><span style="color: #66d9ef; text-decoration-color: #66d9ef; background-color: #272822">None</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">):</span><span style="background-color: #272822">                                     </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">        </span><span style="color: #66d9ef; text-decoration-color: #66d9ef; background-color: #272822">if</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> </span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">not</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> self</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">.</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">contains_file(filename</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">=</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">filename, path</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">=</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">path, user_id</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">=</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">user_id):</span><span style="background-color: #272822">                                 </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">            </span><span style="color: #66d9ef; text-decoration-color: #66d9ef; background-color: #272822">raise</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> </span><span style="color: #a6e22e; text-decoration-color: #a6e22e; background-color: #272822">ValueError</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">(</span><span style="color: #e6db74; text-decoration-color: #e6db74; background-color: #272822">f"File {</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">filename</span><span style="color: #e6db74; text-decoration-color: #e6db74; background-color: #272822">} does not exist"</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">)</span><span style="background-color: #272822">                                                   </span>
<span style="background-color: #272822">                                                                                                                   </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">        t </span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">=</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> self</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">.</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">lake_t(user_id</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">=</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">user_id)</span><span style="background-color: #272822">                                                                          </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">        </span><span style="color: #66d9ef; text-decoration-color: #66d9ef; background-color: #272822">return</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> (</span><span style="background-color: #272822">                                                                                                  </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">            t</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">.</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">filter((t[</span><span style="color: #e6db74; text-decoration-color: #e6db74; background-color: #272822">"path"</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">] </span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">==</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> path) </span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">&amp;</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> (t[</span><span style="color: #e6db74; text-decoration-color: #e6db74; background-color: #272822">"filename"</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">] </span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">==</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> filename))</span><span style="background-color: #272822">                                           </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">            </span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">.</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">to_pyarrow()</span><span style="background-color: #272822">                                                                                         </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">            </span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">.</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">to_pylist()[</span><span style="color: #ae81ff; text-decoration-color: #ae81ff; background-color: #272822">0</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">]</span><span style="background-color: #272822">                                                                                       </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">        )</span><span style="background-color: #272822">                                                                                                         </span>
<span style="background-color: #272822">                                                                                                                   </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">    </span><span style="color: #959077; text-decoration-color: #959077; background-color: #272822"># append record</span><span style="background-color: #272822">                                                                                               </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">    </span><span style="color: #66d9ef; text-decoration-color: #66d9ef; background-color: #272822">def</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> </span><span style="color: #a6e22e; text-decoration-color: #a6e22e; background-color: #272822">append_file</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">(</span><span style="background-color: #272822">                                                                                              </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">        self,</span><span style="background-color: #272822">                                                                                                     </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">        user_id: str </span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">=</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> </span><span style="color: #66d9ef; text-decoration-color: #66d9ef; background-color: #272822">None</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">,</span><span style="background-color: #272822">                                                                                      </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">        path: str </span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">=</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> </span><span style="color: #66d9ef; text-decoration-color: #66d9ef; background-color: #272822">None</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">,</span><span style="background-color: #272822">                                                                                         </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">        filename: str </span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">=</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> </span><span style="color: #66d9ef; text-decoration-color: #66d9ef; background-color: #272822">None</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">,</span><span style="background-color: #272822">                                                                                     </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">        filetype: str </span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">=</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> </span><span style="color: #66d9ef; text-decoration-color: #66d9ef; background-color: #272822">None</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">,</span><span style="background-color: #272822">                                                                                     </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">        data: bytes </span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">=</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> </span><span style="color: #66d9ef; text-decoration-color: #66d9ef; background-color: #272822">None</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">,</span><span style="background-color: #272822">                                                                                       </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">        version: int </span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">=</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> </span><span style="color: #66d9ef; text-decoration-color: #66d9ef; background-color: #272822">None</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">,</span><span style="background-color: #272822">                                                                                      </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">        status: str </span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">=</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> </span><span style="color: #66d9ef; text-decoration-color: #66d9ef; background-color: #272822">None</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">,</span><span style="background-color: #272822">                                                                                       </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">        description: str </span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">=</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> </span><span style="color: #66d9ef; text-decoration-color: #66d9ef; background-color: #272822">None</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">,</span><span style="background-color: #272822">                                                                                  </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">        labels: list[str] </span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">=</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> </span><span style="color: #66d9ef; text-decoration-color: #66d9ef; background-color: #272822">None</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">,</span><span style="background-color: #272822">                                                                                 </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">    ):</span><span style="background-color: #272822">                                                                                                            </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">        </span><span style="color: #66d9ef; text-decoration-color: #66d9ef; background-color: #272822">assert</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> (filename </span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">is</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> </span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">not</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> </span><span style="color: #66d9ef; text-decoration-color: #66d9ef; background-color: #272822">None</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">) </span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">and</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> (</span><span style="background-color: #272822">                                                                       </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">            data </span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">is</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> </span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">not</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> </span><span style="color: #66d9ef; text-decoration-color: #66d9ef; background-color: #272822">None</span><span style="background-color: #272822">                                                                                      </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">        ), </span><span style="color: #e6db74; text-decoration-color: #e6db74; background-color: #272822">"user_id, filename, and data are required"</span><span style="background-color: #272822">                                                             </span>
<span style="background-color: #272822">                                                                                                                   </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">        </span><span style="color: #66d9ef; text-decoration-color: #66d9ef; background-color: #272822">if</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> self</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">.</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">contains_file(filename</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">=</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">filename, path</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">=</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">path, user_id</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">=</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">user_id):</span><span style="background-color: #272822">                                     </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">            </span><span style="color: #66d9ef; text-decoration-color: #66d9ef; background-color: #272822">raise</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> </span><span style="color: #a6e22e; text-decoration-color: #a6e22e; background-color: #272822">ValueError</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">(</span><span style="color: #e6db74; text-decoration-color: #e6db74; background-color: #272822">f"File {</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">filename</span><span style="color: #e6db74; text-decoration-color: #e6db74; background-color: #272822">} already exists"</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">)</span><span style="background-color: #272822">                                                   </span>
<span style="background-color: #272822">                                                                                                                   </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">        data </span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">=</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> {</span><span style="background-color: #272822">                                                                                                  </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">            </span><span style="color: #e6db74; text-decoration-color: #e6db74; background-color: #272822">"idx"</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">: [now()],</span><span style="background-color: #272822">                                                                                       </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">            </span><span style="color: #e6db74; text-decoration-color: #e6db74; background-color: #272822">"id"</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">: [uuid()],</span><span style="background-color: #272822">                                                                                       </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">            </span><span style="color: #e6db74; text-decoration-color: #e6db74; background-color: #272822">"user_id"</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">: [user_id],</span><span style="background-color: #272822">                                                                                 </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">            </span><span style="color: #e6db74; text-decoration-color: #e6db74; background-color: #272822">"path"</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">: [path],</span><span style="background-color: #272822">                                                                                       </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">            </span><span style="color: #e6db74; text-decoration-color: #e6db74; background-color: #272822">"filename"</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">: [filename],</span><span style="background-color: #272822">                                                                               </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">            </span><span style="color: #e6db74; text-decoration-color: #e6db74; background-color: #272822">"filetype"</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">: [filetype],</span><span style="background-color: #272822">                                                                               </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">            </span><span style="color: #e6db74; text-decoration-color: #e6db74; background-color: #272822">"data"</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">: [data],</span><span style="background-color: #272822">                                                                                       </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">            </span><span style="color: #e6db74; text-decoration-color: #e6db74; background-color: #272822">"version"</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">: [version],</span><span style="background-color: #272822">                                                                                 </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">            </span><span style="color: #e6db74; text-decoration-color: #e6db74; background-color: #272822">"status"</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">: [status],</span><span style="background-color: #272822">                                                                                   </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">            </span><span style="color: #e6db74; text-decoration-color: #e6db74; background-color: #272822">"description"</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">: [description],</span><span style="background-color: #272822">                                                                         </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">            </span><span style="color: #e6db74; text-decoration-color: #e6db74; background-color: #272822">"labels"</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">: [</span><span style="color: #e6db74; text-decoration-color: #e6db74; background-color: #272822">","</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">.</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">join(labels) </span><span style="color: #66d9ef; text-decoration-color: #66d9ef; background-color: #272822">if</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> labels </span><span style="color: #66d9ef; text-decoration-color: #66d9ef; background-color: #272822">else</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> </span><span style="color: #66d9ef; text-decoration-color: #66d9ef; background-color: #272822">None</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">],</span><span style="background-color: #272822">                                                     </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">        }</span><span style="background-color: #272822">                                                                                                         </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">        self</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">.</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">wcon</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">.</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">insert(self</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">.</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">lake_table_name, data)</span><span style="background-color: #272822">                                                              </span>
<span style="background-color: #272822">                                                                                                                   </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">        </span><span style="color: #66d9ef; text-decoration-color: #66d9ef; background-color: #272822">return</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> self</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">.</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">get_file(filename</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">=</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">filename, path</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">=</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">path, user_id</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">=</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">user_id)</span><span style="background-color: #272822">                                       </span>
<span style="background-color: #272822">                                                                                                                   </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">    </span><span style="color: #959077; text-decoration-color: #959077; background-color: #272822"># update record</span><span style="background-color: #272822">                                                                                               </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">    </span><span style="color: #66d9ef; text-decoration-color: #66d9ef; background-color: #272822">def</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> </span><span style="color: #a6e22e; text-decoration-color: #a6e22e; background-color: #272822">update_file</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">(</span><span style="background-color: #272822">                                                                                              </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">        self,</span><span style="background-color: #272822">                                                                                                     </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">        user_id: str,</span><span style="background-color: #272822">                                                                                             </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">        path: str,</span><span style="background-color: #272822">                                                                                                </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">        filename: str,</span><span style="background-color: #272822">                                                                                            </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">        filetype: str,</span><span style="background-color: #272822">                                                                                            </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">        data: bytes,</span><span style="background-color: #272822">                                                                                              </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">        version: int,</span><span style="background-color: #272822">                                                                                             </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">        status: str,</span><span style="background-color: #272822">                                                                                              </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">        description: str,</span><span style="background-color: #272822">                                                                                         </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">        labels: list[str] </span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">=</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> </span><span style="color: #66d9ef; text-decoration-color: #66d9ef; background-color: #272822">None</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">,</span><span style="background-color: #272822">                                                                                 </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">    ):</span><span style="background-color: #272822">                                                                                                            </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">        </span><span style="color: #66d9ef; text-decoration-color: #66d9ef; background-color: #272822">if</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> </span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">not</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> self</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">.</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">contains_file(filename</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">=</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">filename, path</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">=</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">path, user_id</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">=</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">user_id):</span><span style="background-color: #272822">                                 </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">            </span><span style="color: #66d9ef; text-decoration-color: #66d9ef; background-color: #272822">raise</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> </span><span style="color: #a6e22e; text-decoration-color: #a6e22e; background-color: #272822">ValueError</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">(</span><span style="color: #e6db74; text-decoration-color: #e6db74; background-color: #272822">f"File {</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">filename</span><span style="color: #e6db74; text-decoration-color: #e6db74; background-color: #272822">} does not exist"</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">)</span><span style="background-color: #272822">                                                   </span>
<span style="background-color: #272822">                                                                                                                   </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">        f </span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">=</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> self</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">.</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">get_file(filename</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">=</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">filename, path</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">=</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">path, user_id</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">=</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">user_id)</span><span style="background-color: #272822">                                          </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">        id </span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">=</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> f[</span><span style="color: #e6db74; text-decoration-color: #e6db74; background-color: #272822">"id"</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">]</span><span style="background-color: #272822">                                                                                              </span>
<span style="background-color: #272822">                                                                                                                   </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">        data </span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">=</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> {</span><span style="background-color: #272822">                                                                                                  </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">            </span><span style="color: #e6db74; text-decoration-color: #e6db74; background-color: #272822">"idx"</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">: [now()],</span><span style="background-color: #272822">                                                                                       </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">            </span><span style="color: #e6db74; text-decoration-color: #e6db74; background-color: #272822">"id"</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">: [id],</span><span style="background-color: #272822">                                                                                           </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">            </span><span style="color: #e6db74; text-decoration-color: #e6db74; background-color: #272822">"user_id"</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">: [user_id],</span><span style="background-color: #272822">                                                                                 </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">            </span><span style="color: #e6db74; text-decoration-color: #e6db74; background-color: #272822">"path"</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">: [path],</span><span style="background-color: #272822">                                                                                       </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">            </span><span style="color: #e6db74; text-decoration-color: #e6db74; background-color: #272822">"filename"</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">: [filename],</span><span style="background-color: #272822">                                                                               </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">            </span><span style="color: #e6db74; text-decoration-color: #e6db74; background-color: #272822">"filetype"</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">: [filetype],</span><span style="background-color: #272822">                                                                               </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">            </span><span style="color: #e6db74; text-decoration-color: #e6db74; background-color: #272822">"data"</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">: [data],</span><span style="background-color: #272822">                                                                                       </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">            </span><span style="color: #e6db74; text-decoration-color: #e6db74; background-color: #272822">"version"</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">: [version],</span><span style="background-color: #272822">                                                                                 </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">            </span><span style="color: #e6db74; text-decoration-color: #e6db74; background-color: #272822">"status"</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">: [status],</span><span style="background-color: #272822">                                                                                   </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">            </span><span style="color: #e6db74; text-decoration-color: #e6db74; background-color: #272822">"description"</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">: [description],</span><span style="background-color: #272822">                                                                         </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">            </span><span style="color: #e6db74; text-decoration-color: #e6db74; background-color: #272822">"labels"</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">: [</span><span style="color: #e6db74; text-decoration-color: #e6db74; background-color: #272822">","</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">.</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">join(labels) </span><span style="color: #66d9ef; text-decoration-color: #66d9ef; background-color: #272822">if</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> labels </span><span style="color: #66d9ef; text-decoration-color: #66d9ef; background-color: #272822">else</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> </span><span style="color: #66d9ef; text-decoration-color: #66d9ef; background-color: #272822">None</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">],</span><span style="background-color: #272822">                                                     </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">        }</span><span style="background-color: #272822">                                                                                                         </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">        self</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">.</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">wcon</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">.</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">insert(self</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">.</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">lake_table_name, data)</span><span style="background-color: #272822">                                                              </span>
<span style="background-color: #272822">                                                                                                                   </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">        </span><span style="color: #66d9ef; text-decoration-color: #66d9ef; background-color: #272822">return</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> self</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">.</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">get_file(filename</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">=</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">filename, path</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">=</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">path, user_id</span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">=</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">user_id)</span><span style="background-color: #272822">                                       </span>
<span style="background-color: #272822">                                                                                                                   </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">    </span><span style="color: #959077; text-decoration-color: #959077; background-color: #272822"># aliases</span><span style="background-color: #272822">                                                                                                     </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">    </span><span style="color: #a6e22e; text-decoration-color: #a6e22e; background-color: #272822">__call__</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> </span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">=</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> get_file</span><span style="background-color: #272822">                                                                                           </span>
<span style="background-color: #272822"> </span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822">    t </span><span style="color: #ff4689; text-decoration-color: #ff4689; background-color: #272822">=</span><span style="color: #f8f8f2; text-decoration-color: #f8f8f2; background-color: #272822"> lake_t</span><span style="background-color: #272822">                                                                                                    </span>
<span style="background-color: #272822">                                                                                                                   
</span></pre>
</div>
</div>
</section>
</section>
<section id="looking-ahead" class="level2">
<h2 class="anchored" data-anchor-id="looking-ahead">looking ahead</h2>
<p>I’m not <em>really</em> sure how well this works in practice at scale. I know I can process <a href="https://ibis-project.org/posts/1tbc">a few billion rows on my laptop</a> with DuckDB, though that was on Parquet files and not views on top of SQLite tables. I’m not sure how well concurrent users writing to the same SQLite database will work. But it should be fine?</p>
<div class="callout callout-style-default callout-caution callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Caution
</div>
</div>
<div class="callout-body-container callout-body">
<p>This code is early and not the best. It will likely be improved over time. Check the respective repositories!</p>
</div>
</div>
<p>Most importantly for dkdc-io, the user interface is simple and useful. The details can change behind the abstraction.</p>


</section>

<a onclick="window.scrollTo(0, 0); return false;" id="quarto-back-to-top"><i class="bi bi-arrow-up"></i> Back to top</a> ]]></description>
  <category>python</category>
  <category>ibis</category>
  <category>sqlite</category>
  <category>duckdb</category>
  <guid>https://dkdc.io/posts/fast-simple-state/</guid>
  <pubDate>Tue, 26 Nov 2024 00:00:00 GMT</pubDate>
</item>
<item>
  <title>fast, full-stack Python (uv &amp; Docker)</title>
  <dc:creator>Cody </dc:creator>
  <link>https://dkdc.io/posts/fast-simple-python/</link>
  <description><![CDATA[ 




<p><strong><em>Using uv and Docker to develop and deploy simple, scalable, full-stack Python applications.</em></strong></p>
<hr>
<p>In this post, we’ll look at my <a href="https://github.com/dkdc-io/dkdc/tree/main/Dockerfile">Dockerfile</a>:</p>
<pre><code># dkdc Dockerfile
FROM ghcr.io/astral-sh/uv:latest AS uv
FROM python:3.12-slim
# set the environment variables
ENV PATH=/root/.local/bin:$PATH
# set the working directory
WORKDIR /app
# copy the files
COPY readme.md /app/readme.md
COPY pyproject.toml /app/pyproject.toml
COPY src /app/src
# install the Python packages
RUN --mount=type=cache,target=/root/.cache/uv \
    --mount=from=uv,source=/uv,target=./uv \
    ./uv pip install '.' --system --upgrade</code></pre>
<p>I use it to develop simple, scalable, full-stack Python applications built with:</p>
<ul>
<li><a href="https://typer.tiangolo.com">Typer</a>: CLI</li>
<li><a href="https://github.com/ibis-project/ibis">Ibis</a>: table management and queries
<ul>
<li><a href="https://github.com/sqlite/sqlite">SQLite</a> and/or <a href="https://github.com/postgres/postgres">Postgres</a>: OLTP database</li>
<li><a href="https://github.com/duckdb/duckdb">DuckDB</a>: OLAP database (views on top of the OLTP tables)</li>
</ul></li>
<li><a href="https://github.com/posit-dev/py-shiny">Shiny for Python</a>: GUI
<ul>
<li><a href="https://github.com/plotly/plotly.py">Plotly</a>: plots</li>
</ul></li>
</ul>
<p>Then, deploy them with ease (and minimal build times) locally, on a Raspberry Pi, and on a cloud VM. Of course, other open source software and Python packages are used along the way (and you can use whatever you like!).</p>
<p>Some miscellaneous notes:</p>
<ul>
<li><strong>order</strong>: the Dockefile is ordered so that frequently changing parts are toward the bottom</li>
<li><strong>cache</strong>: the big point is the caching line, which I stole from somewhere (<a href="https://github.com/astral-sh/uv/issues/4385">here?</a>)</li>
<li><strong>pyproject.toml</strong>: the <code>pyproject.toml</code> is needed as it defines the installation of the package (and CLI)</li>
<li><strong>readme.md</strong>: the <code>readme.md</code> is needed because it’s referenced in the <code>pyproject.toml</code></li>
<li><strong>src</strong>: this is the source code, in something like <code>src/my_package</code></li>
<li><strong>pinning verions</strong>: in general I’m not pinning (or using a <code>uv</code> lockfile), but I would obviously recommend doing so for production workloads and having a process for updating dependencies</li>
<li><strong>system installation</strong>: we use system Python instead of creating a Python virtual environment (which uv makes easy) because we’re already in a virtual container (often itself in a virtual machine)</li>
</ul>
<p>Combining this with a few <code>justfile</code> commands makes development and deployment very easy. The simplicity of Python and tools that cover the full stack (CLI, database, GUI) make it a great choice for rapidly prototyping scalable applications.</p>



<a onclick="window.scrollTo(0, 0); return false;" id="quarto-back-to-top"><i class="bi bi-arrow-up"></i> Back to top</a> ]]></description>
  <category>python</category>
  <category>docker</category>
  <category>uv</category>
  <guid>https://dkdc.io/posts/fast-simple-python/</guid>
  <pubDate>Mon, 25 Nov 2024 00:00:00 GMT</pubDate>
</item>
<item>
  <title>launching ‘dkdc-io’</title>
  <dc:creator>Cody </dc:creator>
  <link>https://dkdc.io/posts/what-is-dkdc/</link>
  <description><![CDATA[ 




<p><strong><em>A decade-long journey back home.</em></strong></p>
<p>Nearly a decade ago, I started “DKDC LLC” not far from where I am today.</p>
<section id="why-dkdc" class="level2">
<h2 class="anchored" data-anchor-id="why-dkdc">why “DKDC”?</h2>
<p>I didn’t need to start a company, but I wanted to. I was working with a local company to prototype a device for testing in a hospital. Ostensibly a limited liability company (LLC) would limit my liability, but there was effectively no risk in my work. The real appeal was in learning the process and being able to say “I started a company”.</p>
<blockquote class="blockquote">
<p>“I started a company!”</p>
<p>“Oh yeah? What’s it called?”</p>
<p>“DKDC LLC.”</p>
<p>“What does DKDC stand for?”</p>
<p>“Don’t know, don’t care.”</p>
</blockquote>
</section>
<section id="branding" class="level2">
<h2 class="anchored" data-anchor-id="branding">branding</h2>
<p>My full name is relatively common and I found “dkdc” to be a useful, unique suffix for online accounts. It’s bland, neutral, and doesn’t really mean anything. It was a good fit a decade ago for a company that didn’t really do anything and it’s been a good fit since for my usernames and personal branding since.</p>
<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-1-contents" aria-controls="callout-1" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Warning
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-1" class="callout-1-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>“dkdc” is very difficult to understand over the phone.</p>
</div>
</div>
</div>
</section>
<section id="starting-dkdc-io" class="level2">
<h2 class="anchored" data-anchor-id="starting-dkdc-io">starting “dkdc-io”</h2>
<blockquote class="blockquote">
<p>“reincarnated”</p>
</blockquote>
<p>As of publishing this post, “dkdc-io” is nothing more than an idea and a GitHub organization with some nascent code. It’s intended as a bland, neutral, and unassuming home for useful code that can do things for me (and perhaps others). Software for me. A startup in a box. A decade of learnings?</p>


</section>

<a onclick="window.scrollTo(0, 0); return false;" id="quarto-back-to-top"><i class="bi bi-arrow-up"></i> Back to top</a> ]]></description>
  <category>dkdc-io</category>
  <guid>https://dkdc.io/posts/what-is-dkdc/</guid>
  <pubDate>Sun, 24 Nov 2024 00:00:00 GMT</pubDate>
  <media:content url="https://dkdc.io/logo.png" medium="image" type="image/png" height="144" width="144"/>
</item>
</channel>
</rss>
